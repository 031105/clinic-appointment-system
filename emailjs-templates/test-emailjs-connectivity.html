<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmailJS Connectivity Test</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
            width: 200px;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìß EmailJS Connectivity Test</h1>
        <p>Test EmailJS configuration and connectivity for clinic appointment system</p>

        <!-- Configuration Section -->
        <div class="test-section">
            <h2>üîß Configuration</h2>
            <div>
                <label>Service ID:</label>
                <select id="serviceId">
                    <option value="service_q237ahi">service_q237ahi (Old)</option>
                    <option value="service_zdk8m9i" selected>service_zdk8m9i (New)</option>
                </select>
            </div>
            <div>
                <label>Public Key:</label>
                <input type="text" id="publicKey" value="M0mQX4l49-XmuzBLw" readonly>
            </div>
            <div>
                <label>Test Email:</label>
                <input type="email" id="testEmail" value="test@example.com" placeholder="Enter your test email">
            </div>
            <button onclick="initializeEmailJS()">üîÑ Initialize EmailJS</button>
            <div id="initStatus"></div>
        </div>

        <!-- Template Tests -->
        <div class="test-section">
            <h2>üé® Template Tests</h2>
            <p>Test each of the 4 email scenarios using 2 multi-purpose templates:</p>
            
            <h3>Template 1 (template_hzt5pok) - Purple Theme</h3>
            <button onclick="testEmailVerification()">‚úâÔ∏è Test Email Verification</button>
            <button onclick="testSystemNotification()">üîî Test System Notification</button>
            
            <h3>Template 2 (template_01nl5co) - Blue Theme</h3>
            <button onclick="testPasswordReset()">üîê Test Password Reset</button>
            <button onclick="testAppointmentNotification()">üìÖ Test Appointment Notification</button>
            
            <div id="testResults"></div>
        </div>

        <!-- Connectivity Check -->
        <div class="test-section">
            <h2>üîå Connectivity Check</h2>
            <button onclick="checkConnectivity()">üß™ Test Connection</button>
            <button onclick="validateConfiguration()">üìã Validate All Config</button>
            <div id="connectivityResults"></div>
        </div>

        <!-- Status Log -->
        <div class="test-section">
            <h2>üìä Status Log</h2>
            <button onclick="clearLog()">üóëÔ∏è Clear Log</button>
            <div id="statusLog"></div>
        </div>

        <!-- Instructions -->
        <div class="test-section">
            <h2>üìù Instructions</h2>
            <div class="code-block">
Required EmailJS Templates:
1. template_hzt5pok (Multi-purpose Template 1)
   - Purple gradient theme
   - Handles: Email verification + System notifications
   
2. template_01nl5co (Multi-purpose Template 2)  
   - Blue gradient theme
   - Handles: Password reset + Appointment notifications

Environment Variables:
- NEXT_PUBLIC_EMAILJS_SERVICE_ID=service_zdk8m9i
- NEXT_PUBLIC_EMAILJS_PUBLIC_KEY=M0mQX4l49-XmuzBLw
            </div>
        </div>
    </div>

    <script>
        let isInitialized = false;
        
        function log(message, type = 'info') {
            const statusLog = document.getElementById('statusLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `status ${type}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            statusLog.appendChild(logEntry);
            statusLog.scrollTop = statusLog.scrollHeight;
        }

        function clearLog() {
            document.getElementById('statusLog').innerHTML = '';
        }

        function initializeEmailJS() {
            const serviceId = document.getElementById('serviceId').value;
            const publicKey = document.getElementById('publicKey').value;
            const initStatus = document.getElementById('initStatus');
            
            try {
                emailjs.init(publicKey);
                isInitialized = true;
                initStatus.innerHTML = '<div class="status success">‚úÖ EmailJS initialized successfully</div>';
                log(`EmailJS initialized with service: ${serviceId}`, 'success');
            } catch (error) {
                isInitialized = false;
                initStatus.innerHTML = `<div class="status error">‚ùå Failed to initialize: ${error.message}</div>`;
                log(`Failed to initialize EmailJS: ${error.message}`, 'error');
            }
        }

        function getTestData() {
            return {
                to_email: document.getElementById('testEmail').value,
                to_name: 'Test User',
                serviceId: document.getElementById('serviceId').value
            };
        }

        async function testEmailVerification() {
            if (!isInitialized) {
                log('Please initialize EmailJS first', 'warning');
                return;
            }

            const testData = getTestData();
            log('Testing email verification...', 'info');

            try {
                const result = await emailjs.send(
                    testData.serviceId,
                    'template_hzt5pok',
                    {
                        to_email: testData.to_email,
                        to_name: testData.to_name,
                        subject: 'Test Email Verification',
                        email_title: 'Email Verification Test',
                        main_message: 'This is a test of the email verification template.',
                        show_verification: 'block',
                        show_notification: 'none',
                        show_action_button: 'inline-block',
                        otp_code: '123456',
                        action_link: 'http://localhost:3000/verify-email',
                        action_button_text: 'Verify Email',
                        instruction_1: 'This is a test verification email',
                        instruction_2: 'No action needed',
                        instruction_3: 'Contact support if needed',
                        security_message: 'This is a test email',
                        notification_type_label: '',
                        notification_title: '',
                        notification_message: '',
                        notification_date: '',
                        portal_link: 'http://localhost:3000/user-dashboard',
                        contact_link: 'http://localhost:3000/contact',
                        privacy_link: 'http://localhost:3000/privacy-policy',
                        unsubscribe_link: 'http://localhost:3000/notifications/unsubscribe'
                    }
                );
                log('‚úÖ Email verification test successful!', 'success');
                updateTestResults('verification', true, result);
            } catch (error) {
                log(`‚ùå Email verification test failed: ${error.message}`, 'error');
                updateTestResults('verification', false, error);
            }
        }

        async function testSystemNotification() {
            if (!isInitialized) {
                log('Please initialize EmailJS first', 'warning');
                return;
            }

            const testData = getTestData();
            log('Testing system notification...', 'info');

            try {
                const result = await emailjs.send(
                    testData.serviceId,
                    'template_hzt5pok',
                    {
                        to_email: testData.to_email,
                        to_name: testData.to_name,
                        subject: 'Test System Notification',
                        email_title: 'System Notification Test',
                        main_message: 'This is a test of the system notification template.',
                        show_verification: 'none',
                        show_notification: 'block',
                        show_action_button: 'inline-block',
                        otp_code: '',
                        notification_type_label: 'System Notification',
                        notification_title: 'Test Notification',
                        notification_message: 'This is a test system notification message.',
                        notification_date: new Date().toLocaleDateString(),
                        action_link: 'http://localhost:3000/user-dashboard',
                        action_button_text: 'View Dashboard',
                        instruction_1: 'This is a test notification',
                        instruction_2: 'No action needed',
                        instruction_3: 'Contact support if needed',
                        security_message: 'This is a test notification',
                        portal_link: 'http://localhost:3000/user-dashboard',
                        contact_link: 'http://localhost:3000/contact',
                        privacy_link: 'http://localhost:3000/privacy-policy',
                        unsubscribe_link: 'http://localhost:3000/notifications/unsubscribe'
                    }
                );
                log('‚úÖ System notification test successful!', 'success');
                updateTestResults('notification', true, result);
            } catch (error) {
                log(`‚ùå System notification test failed: ${error.message}`, 'error');
                updateTestResults('notification', false, error);
            }
        }

        async function testPasswordReset() {
            if (!isInitialized) {
                log('Please initialize EmailJS first', 'warning');
                return;
            }

            const testData = getTestData();
            log('Testing password reset...', 'info');

            try {
                const result = await emailjs.send(
                    testData.serviceId,
                    'template_01nl5co',
                    {
                        to_email: testData.to_email,
                        to_name: testData.to_name,
                        subject: 'Test Password Reset',
                        email_title: 'Password Reset Test',
                        main_message: 'This is a test of the password reset template.',
                        show_password: 'block',
                        show_appointment: 'none',
                        show_secondary_action: 'none',
                        show_appointment_notes: 'none',
                        temp_password: 'TempPass123!',
                        important_message: 'This is a test password reset email',
                        primary_action_link: 'http://localhost:3000/login',
                        primary_action_text: 'Login Now',
                        secondary_action_link: '',
                        secondary_action_text: '',
                        instruction_1: 'This is a test password reset',
                        instruction_2: 'No action needed',
                        instruction_3: 'Contact support if needed',
                        clinic_phone: '+1 (555) 123-4567',
                        notification_type_label: '',
                        appointment_date: '',
                        appointment_time: '',
                        doctor_name: '',
                        department: '',
                        appointment_id: '',
                        additional_notes: '',
                        portal_link: 'http://localhost:3000/user-dashboard',
                        manage_appointment_link: 'http://localhost:3000/appointments/history',
                        contact_link: 'http://localhost:3000/contact',
                        directions_link: 'http://localhost:3000/directions'
                    }
                );
                log('‚úÖ Password reset test successful!', 'success');
                updateTestResults('password', true, result);
            } catch (error) {
                log(`‚ùå Password reset test failed: ${error.message}`, 'error');
                updateTestResults('password', false, error);
            }
        }

        async function testAppointmentNotification() {
            if (!isInitialized) {
                log('Please initialize EmailJS first', 'warning');
                return;
            }

            const testData = getTestData();
            log('Testing appointment notification...', 'info');

            try {
                const result = await emailjs.send(
                    testData.serviceId,
                    'template_01nl5co',
                    {
                        to_email: testData.to_email,
                        to_name: testData.to_name,
                        subject: 'Test Appointment Notification',
                        email_title: 'Appointment Confirmed',
                        main_message: 'This is a test of the appointment notification template.',
                        show_password: 'none',
                        show_appointment: 'block',
                        show_secondary_action: 'inline-block',
                        show_appointment_notes: 'block',
                        temp_password: '',
                        notification_type_label: 'Appointment Confirmed',
                        appointment_date: '2024-12-20',
                        appointment_time: '10:00 AM',
                        doctor_name: 'Dr. Test',
                        department: 'Test Department',
                        appointment_id: 'TEST123456',
                        additional_notes: 'This is a test appointment notification.',
                        important_message: 'This is a test appointment confirmation',
                        primary_action_link: 'http://localhost:3000/appointments/history',
                        primary_action_text: 'View Appointment',
                        secondary_action_link: 'http://localhost:3000/appointments/reschedule/TEST123456',
                        secondary_action_text: 'Reschedule',
                        instruction_1: 'This is a test appointment',
                        instruction_2: 'No action needed',
                        instruction_3: 'Contact support if needed',
                        clinic_phone: '+1 (555) 123-4567',
                        portal_link: 'http://localhost:3000/user-dashboard',
                        manage_appointment_link: 'http://localhost:3000/appointments/history',
                        contact_link: 'http://localhost:3000/contact',
                        directions_link: 'http://localhost:3000/directions'
                    }
                );
                log('‚úÖ Appointment notification test successful!', 'success');
                updateTestResults('appointment', true, result);
            } catch (error) {
                log(`‚ùå Appointment notification test failed: ${error.message}`, 'error');
                updateTestResults('appointment', false, error);
            }
        }

        function updateTestResults(testType, success, result) {
            const testResults = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `status ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `
                <strong>${testType.toUpperCase()}</strong>: ${success ? '‚úÖ PASSED' : '‚ùå FAILED'}
                ${success ? `<br>Response: ${result.text}` : `<br>Error: ${result.message || result}`}
            `;
            testResults.appendChild(resultDiv);
        }

        function checkConnectivity() {
            log('Checking EmailJS connectivity...', 'info');
            const serviceId = document.getElementById('serviceId').value;
            const publicKey = document.getElementById('publicKey').value;
            
            const connectivityResults = document.getElementById('connectivityResults');
            
            if (typeof emailjs === 'undefined') {
                connectivityResults.innerHTML = '<div class="status error">‚ùå EmailJS library not loaded</div>';
                log('EmailJS library not loaded', 'error');
                return;
            }
            
            try {
                emailjs.init(publicKey);
                connectivityResults.innerHTML = `
                    <div class="status success">‚úÖ EmailJS connectivity OK</div>
                    <div class="status info">Service ID: ${serviceId}</div>
                    <div class="status info">Public Key: ${publicKey}</div>
                `;
                log('EmailJS connectivity check passed', 'success');
                isInitialized = true;
            } catch (error) {
                connectivityResults.innerHTML = `<div class="status error">‚ùå Connectivity failed: ${error.message}</div>`;
                log(`Connectivity check failed: ${error.message}`, 'error');
                isInitialized = false;
            }
        }

        function validateConfiguration() {
            log('Validating EmailJS configuration...', 'info');
            
            const requiredTemplates = ['template_hzt5pok', 'template_01nl5co'];
            const serviceId = document.getElementById('serviceId').value;
            const publicKey = document.getElementById('publicKey').value;
            
            let validationHTML = '<h3>üìã Configuration Validation</h3>';
            
            // Check service ID
            if (serviceId) {
                validationHTML += '<div class="status success">‚úÖ Service ID configured</div>';
            } else {
                validationHTML += '<div class="status error">‚ùå Service ID missing</div>';
            }
            
            // Check public key
            if (publicKey) {
                validationHTML += '<div class="status success">‚úÖ Public Key configured</div>';
            } else {
                validationHTML += '<div class="status error">‚ùå Public Key missing</div>';
            }
            
            // Template requirements
            validationHTML += '<div class="status info">üìß Required Templates:</div>';
            requiredTemplates.forEach(template => {
                validationHTML += `<div class="status info">‚Ä¢ ${template}</div>`;
            });
            
            document.getElementById('connectivityResults').innerHTML = validationHTML;
            log('Configuration validation completed', 'info');
        }

        // Auto-initialize on page load
        window.addEventListener('load', function() {
            log('EmailJS Connectivity Test loaded', 'info');
            log('Click "Initialize EmailJS" to begin testing', 'info');
        });
    </script>
</body>
</html> 