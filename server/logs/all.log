2025-05-16 20:49:06:496 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-16 20:49:06:496 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-16 20:49:06:496 [32minfo[39m: [32mEnvironment: development[39m
2025-05-16 20:49:22:4922 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 20:49:22:4922 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-16 20:49:22:4922 [37mdebug[39m: [37mQuery completed in 18ms, returned 1 rows[39m
2025-05-16 20:49:22:4922 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:49:22:4922 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-16 20:49:22:4922 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-16 20:55:08:558 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-16 20:55:08:558 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-16 20:55:08:558 [32minfo[39m: [32mEnvironment: development[39m
2025-05-16 20:55:26:5526 [31merror[39m: [31mAuthentication error: jwt malformed[39m
2025-05-16 20:55:26:5526 [31merror[39m: [31mAuthentication error: jwt malformed[39m
2025-05-16 20:55:26:5526 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 20:55:26:5526 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 20:55:26:5526 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 20:55:26:5526 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 20:55:26:5526 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 20:55:26:5526 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 20:55:26:5526 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 20:55:26:5526 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 20:55:26:5526 [37mdebug[39m: [37mQuery completed in 43ms, returned 9 rows[39m
2025-05-16 20:55:26:5526 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 20:55:26:5526 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 20:55:26:5526 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 20:55:26:5526 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-16 20:55:26:5526 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 20:55:27:5527 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:27:5527 [37mdebug[39m: [37mQuery params: ["1"][39m
2025-05-16 20:55:27:5527 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:27:5527 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-16 20:55:27:5527 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-16 20:55:27:5527 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:27:5527 [37mdebug[39m: [37mQuery params: ["1"][39m
2025-05-16 20:55:27:5527 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-16 20:55:27:5527 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mQuery params: ["2"][39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mQuery params: ["2"][39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mQuery params: ["8"][39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-16 20:55:30:5530 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-16 20:55:31:5531 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:31:5531 [37mdebug[39m: [37mQuery params: ["4"][39m
2025-05-16 20:55:31:5531 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:31:5531 [37mdebug[39m: [37mQuery params: ["4"][39m
2025-05-16 20:55:31:5531 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-16 20:55:31:5531 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-16 20:55:32:5532 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:32:5532 [37mdebug[39m: [37mQuery params: ["5"][39m
2025-05-16 20:55:32:5532 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:32:5532 [37mdebug[39m: [37mQuery params: ["5"][39m
2025-05-16 20:55:32:5532 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-16 20:55:32:5532 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mQuery params: ["4"][39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mQuery params: ["4"][39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mQuery params: ["8"][39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-16 20:55:34:5534 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-16 20:55:35:5535 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:35:5535 [37mdebug[39m: [37mQuery params: ["1"][39m
2025-05-16 20:55:35:5535 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:35:5535 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-16 20:55:35:5535 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-16 20:55:35:5535 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:35:5535 [37mdebug[39m: [37mQuery params: ["1"][39m
2025-05-16 20:55:35:5535 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-16 20:55:35:5535 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-16 20:55:36:5536 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:36:5536 [37mdebug[39m: [37mQuery params: ["2"][39m
2025-05-16 20:55:36:5536 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:36:5536 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-16 20:55:36:5536 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-16 20:55:36:5536 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-16 20:55:36:5536 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:36:5536 [37mdebug[39m: [37mQuery params: ["2"][39m
2025-05-16 20:55:36:5536 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-16 20:55:37:5537 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:37:5537 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-16 20:55:37:5537 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:37:5537 [37mdebug[39m: [37mQuery params: ["8"][39m
2025-05-16 20:55:37:5537 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-16 20:55:37:5537 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-16 20:55:37:5537 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:37:5537 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-16 20:55:37:5537 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-16 20:55:39:5539 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:39:5539 [37mdebug[39m: [37mQuery params: ["4"][39m
2025-05-16 20:55:39:5539 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-16 20:55:39:5539 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:39:5539 [37mdebug[39m: [37mQuery params: ["4"][39m
2025-05-16 20:55:39:5539 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-16 20:55:43:5543 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:43:5543 [37mdebug[39m: [37mQuery params: ["5"][39m
2025-05-16 20:55:43:5543 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-16 20:55:43:5543 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:55:43:5543 [37mdebug[39m: [37mQuery params: ["5"][39m
2025-05-16 20:55:43:5543 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mQuery params: ["8"][39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mQuery params: ["2"][39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mQuery params: ["2"][39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-16 20:56:05:565 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-16 21:09:40:940 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-16 21:09:41:941 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-16 21:09:41:941 [32minfo[39m: [32mEnvironment: development[39m
2025-05-16 21:10:04:104 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 21:10:04:104 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-16 21:10:04:104 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-16 21:10:04:104 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 21:10:04:104 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-16 21:10:04:104 [37mdebug[39m: [37mQuery completed in 10ms, returned 1 rows[39m
2025-05-16 21:10:05:105 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:10:05:105 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:10:05:105 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:10:05:105 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:10:05:105 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:10:05:105 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:10:05:105 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:10:05:105 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:10:05:105 [37mdebug[39m: [37mQuery completed in 36ms, returned 9 rows[39m
2025-05-16 21:10:05:105 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:10:05:105 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:10:05:105 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:10:05:105 [37mdebug[39m: [37mQuery completed in 8ms, returned 9 rows[39m
2025-05-16 21:10:05:105 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:14:07:147 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:14:07:147 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:14:07:147 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:14:07:147 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:14:07:147 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:14:07:147 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:14:07:147 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:14:07:147 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:14:07:147 [37mdebug[39m: [37mQuery completed in 47ms, returned 9 rows[39m
2025-05-16 21:14:07:147 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:14:07:147 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:14:07:147 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:14:07:147 [37mdebug[39m: [37mQuery completed in 7ms, returned 9 rows[39m
2025-05-16 21:14:07:147 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:32:39:3239 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-16 21:32:39:3239 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-16 21:32:39:3239 [32minfo[39m: [32mEnvironment: development[39m
2025-05-16 21:33:18:3318 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:33:18:3318 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:33:18:3318 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:33:18:3318 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:33:18:3318 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:33:18:3318 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:33:18:3318 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:33:18:3318 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:33:18:3318 [37mdebug[39m: [37mQuery completed in 38ms, returned 9 rows[39m
2025-05-16 21:33:18:3318 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:33:18:3318 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:33:18:3318 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:33:19:3319 [37mdebug[39m: [37mQuery completed in 18ms, returned 9 rows[39m
2025-05-16 21:33:19:3319 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:33:35:3335 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 21:33:35:3335 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-16 21:33:35:3335 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-16 21:33:36:3336 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 21:33:36:3336 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-16 21:33:36:3336 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-16 21:33:36:3336 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:33:36:3336 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:33:36:3336 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:33:36:3336 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:33:36:3336 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:33:36:3336 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:33:36:3336 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:33:36:3336 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:33:36:3336 [37mdebug[39m: [37mQuery completed in 16ms, returned 9 rows[39m
2025-05-16 21:33:36:3336 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:33:36:3336 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:33:36:3336 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:33:36:3336 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-16 21:33:36:3336 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:37:10:3710 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:37:10:3710 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:37:10:3710 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:37:10:3710 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:37:10:3710 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:37:10:3710 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:37:10:3710 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:37:10:3710 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:37:10:3710 [37mdebug[39m: [37mQuery completed in 154ms, returned 9 rows[39m
2025-05-16 21:37:10:3710 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:37:10:3710 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:37:10:3710 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:37:10:3710 [37mdebug[39m: [37mQuery completed in 47ms, returned 9 rows[39m
2025-05-16 21:37:10:3710 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:37:33:3733 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 21:37:33:3733 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-16 21:37:33:3733 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-16 21:37:33:3733 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 21:37:33:3733 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-16 21:37:33:3733 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-16 21:37:34:3734 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:37:34:3734 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:37:34:3734 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:37:34:3734 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:37:34:3734 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:37:34:3734 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:37:34:3734 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:37:34:3734 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:37:34:3734 [37mdebug[39m: [37mQuery completed in 16ms, returned 9 rows[39m
2025-05-16 21:37:34:3734 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:37:34:3734 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:37:34:3734 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:37:34:3734 [37mdebug[39m: [37mQuery completed in 18ms, returned 9 rows[39m
2025-05-16 21:37:34:3734 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:39:24:3924 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 21:39:24:3924 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-16 21:39:24:3924 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-16 21:39:24:3924 [31merror[39m: [31mError: Invalid credentials[39m
2025-05-16 21:39:54:3954 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-16 21:39:54:3954 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-16 21:39:54:3954 [32minfo[39m: [32mEnvironment: development[39m
2025-05-16 21:40:13:4013 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 21:40:13:4013 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-16 21:40:13:4013 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-16 21:40:13:4013 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 21:40:13:4013 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-16 21:40:13:4013 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-16 21:40:14:4014 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:40:14:4014 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:40:14:4014 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:40:14:4014 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:40:14:4014 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:40:14:4014 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:40:14:4014 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:40:14:4014 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:40:14:4014 [37mdebug[39m: [37mQuery completed in 17ms, returned 9 rows[39m
2025-05-16 21:40:14:4014 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:40:14:4014 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:40:14:4014 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:40:14:4014 [37mdebug[39m: [37mQuery completed in 40ms, returned 9 rows[39m
2025-05-16 21:40:14:4014 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:44:23:4423 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 21:44:23:4423 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-16 21:44:23:4423 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-16 21:44:23:4423 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 21:44:23:4423 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-16 21:44:23:4423 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-16 21:44:23:4423 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:44:23:4423 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:44:23:4423 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:44:23:4423 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:44:23:4423 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:44:23:4423 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:44:23:4423 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:44:23:4423 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:44:23:4423 [37mdebug[39m: [37mQuery completed in 18ms, returned 9 rows[39m
2025-05-16 21:44:23:4423 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:44:24:4424 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:44:24:4424 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:44:24:4424 [37mdebug[39m: [37mQuery completed in 17ms, returned 9 rows[39m
2025-05-16 21:44:24:4424 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:45:38:4538 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:45:38:4538 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:45:38:4538 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:45:38:4538 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mQuery completed in 11ms, returned 9 rows[39m
2025-05-16 21:45:38:4538 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:45:38:4538 [37mdebug[39m: [37mQuery completed in 12ms, returned 9 rows[39m
2025-05-16 21:45:38:4538 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:45:38:4538 [31merror[39m: [31mAuthentication error: jwt malformed[39m
2025-05-16 21:45:38:4538 [31merror[39m: [31mAuthentication error: jwt malformed[39m
2025-05-16 21:50:46:5046 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 21:50:46:5046 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-16 21:50:46:5046 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-16 21:50:46:5046 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 21:50:46:5046 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-16 21:50:46:5046 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-16 21:50:47:5047 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:50:47:5047 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:50:47:5047 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:50:47:5047 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 21:50:47:5047 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 21:50:47:5047 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 21:50:47:5047 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:50:47:5047 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:50:47:5047 [37mdebug[39m: [37mQuery completed in 115ms, returned 9 rows[39m
2025-05-16 21:50:47:5047 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 21:50:47:5047 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 21:50:47:5047 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 21:50:47:5047 [31merror[39m: [31mAuthentication error: jwt malformed[39m
2025-05-16 21:50:47:5047 [37mdebug[39m: [37mQuery completed in 72ms, returned 9 rows[39m
2025-05-16 21:50:47:5047 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 22:01:13:113 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-16 22:01:13:113 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-16 22:01:13:113 [32minfo[39m: [32mEnvironment: development[39m
2025-05-16 22:04:58:458 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 22:04:58:458 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-16 22:04:58:458 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-16 22:04:58:458 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 22:04:58:458 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-16 22:04:58:458 [37mdebug[39m: [37mQuery completed in 24ms, returned 1 rows[39m
2025-05-16 22:05:08:58 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 22:05:08:58 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-16 22:05:08:58 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-16 22:05:08:58 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 22:05:08:58 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-16 22:05:08:58 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-16 22:21:14:2114 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-16 22:21:14:2114 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-16 22:21:14:2114 [32minfo[39m: [32mEnvironment: development[39m
2025-05-16 22:21:31:2131 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 22:21:31:2131 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-16 22:21:32:2132 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-16 22:21:32:2132 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 22:21:32:2132 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-16 22:21:32:2132 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-16 22:21:32:2132 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 22:21:32:2132 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 22:21:32:2132 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 22:21:32:2132 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.image_url as "imageUrl",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 22:21:32:2132 [31merror[39m: [31mQuery error: column d.image_url does not exist[39m
2025-05-16 22:21:32:2132 [31merror[39m: [31mError in getDepartments: column d.image_url does not exist[39m
2025-05-16 22:21:32:2132 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 22:21:32:2132 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 22:21:33:2133 [37mdebug[39m: [37mQuery completed in 119ms, returned 9 rows[39m
2025-05-16 22:21:33:2133 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 22:21:33:2133 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 22:21:33:2133 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 22:21:33:2133 [37mdebug[39m: [37mQuery completed in 11ms, returned 9 rows[39m
2025-05-16 22:21:33:2133 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 22:21:33:2133 [31merror[39m: [31mAuthentication error: jwt malformed[39m
2025-05-16 22:21:33:2133 [31merror[39m: [31mAuthentication error: jwt malformed[39m
2025-05-16 22:21:48:2148 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 22:21:48:2148 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-16 22:21:48:2148 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-16 22:21:48:2148 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 22:21:48:2148 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-16 22:21:48:2148 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-16 22:21:59:2159 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 22:21:59:2159 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-16 22:21:59:2159 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-16 22:21:59:2159 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 22:21:59:2159 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-16 22:21:59:2159 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-16 22:36:41:3641 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-16 22:36:41:3641 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-16 22:36:41:3641 [32minfo[39m: [32mEnvironment: development[39m
2025-05-16 22:37:06:376 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-16 22:37:07:377 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-16 22:37:07:377 [32minfo[39m: [32mEnvironment: development[39m
2025-05-16 22:37:12:3712 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 22:37:12:3712 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-16 22:37:12:3712 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-16 22:37:12:3712 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 22:37:12:3712 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-16 22:37:12:3712 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mQuery completed in 45ms, returned 6 rows[39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 22:37:24:3724 [37mdebug[39m: [37mQuery completed in 42ms, returned 9 rows[39m
2025-05-16 22:37:24:3724 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 22:37:25:3725 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-16 22:37:25:3725 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-16 22:37:25:3725 [37mdebug[39m: [37mQuery completed in 26ms, returned 9 rows[39m
2025-05-16 22:37:25:3725 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-16 22:37:25:3725 [31merror[39m: [31mAuthentication error: jwt expired[39m
2025-05-16 22:37:25:3725 [31merror[39m: [31mAuthentication error: jwt expired[39m
2025-05-17 11:03:20:320 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 11:03:21:321 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 11:03:21:321 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 11:03:38:338 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 11:03:39:339 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 11:03:39:339 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 11:08:40:840 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 11:08:40:840 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 11:08:40:840 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 11:09:26:926 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 11:09:26:926 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 11:09:26:926 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 11:09:43:943 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 11:09:43:943 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-17 11:09:43:943 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-17 11:09:43:943 [31merror[39m: [31mError: Invalid credentials[39m
2025-05-17 11:09:49:949 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 11:09:49:949 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-17 11:09:49:949 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 11:09:49:949 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 11:09:49:949 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-17 11:09:49:949 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-17 11:09:59:959 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 11:09:59:959 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-17 11:09:59:959 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 11:09:59:959 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 11:09:59:959 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-17 11:09:59:959 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery completed in 13ms, returned 6 rows[39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery completed in 54ms, returned 9 rows[39m
2025-05-17 11:10:09:109 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery completed in 7ms, returned 9 rows[39m
2025-05-17 11:10:09:109 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery completed in 20ms, returned 0 rows[39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 11:10:09:109 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-17 12:28:02:282 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 12:28:02:282 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 12:28:02:282 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 12:28:15:2815 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 12:28:15:2815 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 12:28:15:2815 [37mdebug[39m: [37mQuery completed in 24ms, returned 1 rows[39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mQuery completed in 21ms, returned 1 rows[39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 12:28:16:2816 [31merror[39m: [31mQuery error: column d.emoji_icon does not exist[39m
2025-05-17 12:28:16:2816 [31merror[39m: [31mError in getDepartments: column d.emoji_icon does not exist[39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 12:28:16:2816 [31merror[39m: [31mQuery error: column d.emoji_icon does not exist[39m
2025-05-17 12:28:16:2816 [31merror[39m: [31mError in getDepartments: column d.emoji_icon does not exist[39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mQuery completed in 63ms, returned 9 rows[39m
2025-05-17 12:28:16:2816 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mQuery completed in 12ms, returned 9 rows[39m
2025-05-17 12:28:16:2816 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mQuery completed in 7ms, returned 0 rows[39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 12:28:16:2816 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 12:31:34:3134 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 12:31:34:3134 [31merror[39m: [31mQuery error: column d.emoji_icon does not exist[39m
2025-05-17 12:31:34:3134 [31merror[39m: [31mError in getDepartments: column d.emoji_icon does not exist[39m
2025-05-17 12:31:34:3134 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 12:31:34:3134 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 12:31:34:3134 [37mdebug[39m: [37mQuery completed in 61ms, returned 9 rows[39m
2025-05-17 12:31:34:3134 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 12:31:34:3134 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 12:31:34:3134 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 12:31:34:3134 [37mdebug[39m: [37mQuery completed in 5ms, returned 0 rows[39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 12:31:47:3147 [31merror[39m: [31mQuery error: column d.emoji_icon does not exist[39m
2025-05-17 12:31:47:3147 [31merror[39m: [31mError in getDepartments: column d.emoji_icon does not exist[39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 12:31:47:3147 [31merror[39m: [31mQuery error: column d.emoji_icon does not exist[39m
2025-05-17 12:31:47:3147 [31merror[39m: [31mError in getDepartments: column d.emoji_icon does not exist[39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mQuery completed in 7ms, returned 9 rows[39m
2025-05-17 12:31:47:3147 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mQuery completed in 11ms, returned 9 rows[39m
2025-05-17 12:31:47:3147 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 12:31:47:3147 [37mdebug[39m: [37mQuery completed in 4ms, returned 0 rows[39m
2025-05-17 12:31:56:3156 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 12:31:56:3156 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-17 12:31:56:3156 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 12:31:56:3156 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 12:31:56:3156 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-17 12:31:56:3156 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 12:31:56:3156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 12:31:56:3156 [31merror[39m: [31mQuery error: column d.emoji_icon does not exist[39m
2025-05-17 12:31:56:3156 [31merror[39m: [31mError in getDepartments: column d.emoji_icon does not exist[39m
2025-05-17 12:31:56:3156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 12:31:56:3156 [31merror[39m: [31mQuery error: column d.emoji_icon does not exist[39m
2025-05-17 12:31:56:3156 [31merror[39m: [31mError in getDepartments: column d.emoji_icon does not exist[39m
2025-05-17 12:31:56:3156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 12:31:56:3156 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 12:31:57:3157 [37mdebug[39m: [37mQuery completed in 6ms, returned 9 rows[39m
2025-05-17 12:31:57:3157 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 12:31:57:3157 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 12:31:57:3157 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 12:31:57:3157 [37mdebug[39m: [37mQuery completed in 24ms, returned 9 rows[39m
2025-05-17 12:31:57:3157 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 12:31:57:3157 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 12:31:57:3157 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 12:31:57:3157 [37mdebug[39m: [37mQuery completed in 8ms, returned 0 rows[39m
2025-05-17 12:31:57:3157 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 12:31:57:3157 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 12:31:57:3157 [37mdebug[39m: [37mQuery completed in 3ms, returned 0 rows[39m
2025-05-17 14:12:36:1236 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 14:12:36:1236 [37mdebug[39m: [37mQuery completed in 180ms, returned 6 rows[39m
2025-05-17 14:12:36:1236 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 14:12:36:1236 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 14:12:36:1236 [37mdebug[39m: [37mQuery completed in 149ms, returned 9 rows[39m
2025-05-17 14:12:36:1236 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 14:12:36:1236 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 14:12:36:1236 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 14:12:36:1236 [37mdebug[39m: [37mQuery completed in 7ms, returned 0 rows[39m
2025-05-17 14:13:09:139 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 14:13:09:139 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 14:13:09:139 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 14:13:16:1316 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 14:13:16:1316 [37mdebug[39m: [37mQuery completed in 16ms, returned 6 rows[39m
2025-05-17 14:13:16:1316 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 14:13:16:1316 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 14:13:16:1316 [37mdebug[39m: [37mQuery completed in 16ms, returned 9 rows[39m
2025-05-17 14:13:16:1316 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 14:13:16:1316 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 14:13:16:1316 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 14:13:16:1316 [37mdebug[39m: [37mQuery completed in 8ms, returned 0 rows[39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery completed in 5ms, returned 6 rows[39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery completed in 0ms, returned 6 rows[39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-17 14:13:25:1325 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery completed in 43ms, returned 9 rows[39m
2025-05-17 14:13:25:1325 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery completed in 48ms, returned 0 rows[39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 14:13:25:1325 [37mdebug[39m: [37mQuery completed in 11ms, returned 0 rows[39m
2025-05-17 14:41:44:4144 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 14:41:44:4144 [37mdebug[39m: [37mQuery completed in 9ms, returned 6 rows[39m
2025-05-17 14:41:44:4144 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 14:41:44:4144 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 14:41:44:4144 [37mdebug[39m: [37mQuery completed in 41ms, returned 9 rows[39m
2025-05-17 14:41:44:4144 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 14:41:44:4144 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 14:41:44:4144 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 14:41:44:4144 [37mdebug[39m: [37mQuery completed in 3ms, returned 0 rows[39m
2025-05-17 15:48:23:4823 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 15:48:23:4823 [37mdebug[39m: [37mQuery completed in 23ms, returned 6 rows[39m
2025-05-17 15:48:23:4823 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 15:48:23:4823 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 15:48:23:4823 [31merror[39m: [31mQuery error: column u.profile_image does not exist[39m
2025-05-17 15:48:23:4823 [31merror[39m: [31mError in getDoctors: column u.profile_image does not exist[39m
2025-05-17 15:48:23:4823 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 15:48:23:4823 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 15:48:23:4823 [37mdebug[39m: [37mQuery completed in 31ms, returned 0 rows[39m
2025-05-17 15:48:56:4856 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 15:48:56:4856 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 15:48:56:4856 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 15:49:16:4916 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 15:49:16:4916 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 15:49:16:4916 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mQuery completed in 75ms, returned 1 rows[39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mQuery completed in 30ms, returned 6 rows[39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mQuery completed in 5ms, returned 6 rows[39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 15:49:17:4917 [31merror[39m: [31mQuery error: column u.profile_image does not exist[39m
2025-05-17 15:49:17:4917 [31merror[39m: [31mError in getDoctors: column u.profile_image does not exist[39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 15:49:17:4917 [31merror[39m: [31mQuery error: column u.profile_image does not exist[39m
2025-05-17 15:49:17:4917 [31merror[39m: [31mError in getDoctors: column u.profile_image does not exist[39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mQuery completed in 5ms, returned 0 rows[39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 15:49:17:4917 [37mdebug[39m: [37mQuery completed in 9ms, returned 0 rows[39m
2025-05-17 15:51:14:5114 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 15:51:14:5114 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 15:51:14:5114 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 15:51:19:5119 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 15:51:20:5120 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 15:51:20:5120 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 15:51:21:5121 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 15:51:21:5121 [37mdebug[39m: [37mQuery completed in 5ms, returned 6 rows[39m
2025-05-17 15:51:21:5121 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 15:51:21:5121 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 15:51:21:5121 [37mdebug[39m: [37mQuery completed in 20ms, returned 9 rows[39m
2025-05-17 15:51:21:5121 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 15:51:21:5121 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 15:51:21:5121 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 15:51:21:5121 [37mdebug[39m: [37mQuery completed in 3ms, returned 0 rows[39m
2025-05-17 16:06:27:627 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 16:06:27:627 [37mdebug[39m: [37mQuery completed in 7ms, returned 6 rows[39m
2025-05-17 16:06:27:627 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 16:06:27:627 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 16:06:27:627 [37mdebug[39m: [37mQuery completed in 59ms, returned 9 rows[39m
2025-05-17 16:06:27:627 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 16:06:27:627 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 16:06:27:627 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 16:06:27:627 [37mdebug[39m: [37mQuery completed in 3ms, returned 0 rows[39m
2025-05-17 16:07:07:77 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 16:07:07:77 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 16:07:07:77 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 16:07:08:78 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 16:07:08:78 [37mdebug[39m: [37mQuery completed in 4ms, returned 6 rows[39m
2025-05-17 16:07:08:78 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 16:07:08:78 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 16:07:08:78 [37mdebug[39m: [37mQuery completed in 14ms, returned 9 rows[39m
2025-05-17 16:07:08:78 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 16:07:08:78 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 16:07:08:78 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 16:07:08:78 [37mdebug[39m: [37mQuery completed in 3ms, returned 0 rows[39m
2025-05-17 16:07:12:712 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 16:07:12:712 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-17 16:07:12:712 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 16:07:12:712 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 16:07:12:712 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-17 16:07:12:712 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 16:07:12:712 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 16:07:12:712 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 16:07:12:712 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 16:08:15:815 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 16:08:15:815 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 16:08:15:815 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mQuery completed in 10ms, returned 1 rows[39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mQuery completed in 10ms, returned 1 rows[39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mQuery completed in 29ms, returned 6 rows[39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mQuery completed in 32ms, returned 9 rows[39m
2025-05-17 16:08:28:828 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 16:08:28:828 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 16:08:29:829 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-17 16:08:29:829 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 16:08:29:829 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 16:08:29:829 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 16:08:29:829 [37mdebug[39m: [37mQuery completed in 7ms, returned 0 rows[39m
2025-05-17 16:08:29:829 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 16:08:29:829 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 16:08:29:829 [37mdebug[39m: [37mQuery completed in 4ms, returned 0 rows[39m
2025-05-17 16:11:34:1134 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:11:34:1134 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 16:11:34:1134 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:11:34:1134 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 16:11:34:1134 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:11:34:1134 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 16:11:34:1134 [31merror[39m: [31mQuery error: column "profile_image_content_type" does not exist[39m
2025-05-17 16:11:34:1134 [31merror[39m: [31mError fetching profile image: column "profile_image_content_type" does not exist[39m
2025-05-17 16:11:34:1134 [31merror[39m: [31mQuery error: column "profile_image_content_type" does not exist[39m
2025-05-17 16:11:34:1134 [31merror[39m: [31mError fetching profile image: column "profile_image_content_type" does not exist[39m
2025-05-17 16:11:34:1134 [31merror[39m: [31mQuery error: column "profile_image_content_type" does not exist[39m
2025-05-17 16:11:34:1134 [31merror[39m: [31mError fetching profile image: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:19:2319 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:23:19:2319 [37mdebug[39m: [37mQuery params: ["12"][39m
2025-05-17 16:23:19:2319 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:23:19:2319 [37mdebug[39m: [37mQuery params: ["11"][39m
2025-05-17 16:23:19:2319 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:23:19:2319 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 16:23:19:2319 [31merror[39m: [31mQuery error: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:19:2319 [31merror[39m: [31mError fetching profile image: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:19:2319 [31merror[39m: [31mQuery error: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:19:2319 [31merror[39m: [31mError fetching profile image: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:19:2319 [31merror[39m: [31mQuery error: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:19:2319 [31merror[39m: [31mError fetching profile image: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:19:2319 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:23:19:2319 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 16:23:19:2319 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:23:19:2319 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 16:23:19:2319 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:23:19:2319 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 16:23:19:2319 [31merror[39m: [31mQuery error: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:19:2319 [31merror[39m: [31mError fetching profile image: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:19:2319 [31merror[39m: [31mQuery error: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:19:2319 [31merror[39m: [31mError fetching profile image: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:19:2319 [31merror[39m: [31mQuery error: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:19:2319 [31merror[39m: [31mError fetching profile image: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:32:2332 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:23:32:2332 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 16:23:32:2332 [31merror[39m: [31mQuery error: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:32:2332 [31merror[39m: [31mError fetching profile image: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:34:2334 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:23:34:2334 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 16:23:34:2334 [31merror[39m: [31mQuery error: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:34:2334 [31merror[39m: [31mError fetching profile image: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:35:2335 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob, profile_image_content_type[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:23:35:2335 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 16:23:35:2335 [31merror[39m: [31mQuery error: column "profile_image_content_type" does not exist[39m
2025-05-17 16:23:35:2335 [31merror[39m: [31mError fetching profile image: column "profile_image_content_type" does not exist[39m
2025-05-17 16:26:32:2632 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 16:26:32:2632 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 16:26:32:2632 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 16:26:44:2644 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 16:26:44:2644 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 16:26:44:2644 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 16:27:23:2723 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 16:27:23:2723 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 16:27:23:2723 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mQuery completed in 5ms, returned 6 rows[39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-17 16:27:34:2734 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 16:27:34:2734 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-17 19:40:07:407 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 19:40:07:407 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 19:40:07:407 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 19:40:13:4013 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 19:40:13:4013 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 19:40:13:4013 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 19:41:48:4148 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 19:41:48:4148 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 19:41:48:4148 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 19:42:07:427 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 19:42:07:427 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 19:42:07:427 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 19:42:27:4227 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 19:42:27:4227 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 19:42:27:4227 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 20:59:33:5933 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 20:59:34:5934 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 20:59:34:5934 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 20:59:50:5950 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 20:59:50:5950 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 20:59:50:5950 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-17 20:59:50:5950 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 20:59:50:5950 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 20:59:50:5950 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery completed in 59ms, returned 6 rows[39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery completed in 19ms, returned 9 rows[39m
2025-05-17 20:59:51:5951 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery completed in 7ms, returned 9 rows[39m
2025-05-17 20:59:51:5951 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery completed in 19ms, returned 0 rows[39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery completed in 19ms, returned 0 rows[39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 20:59:51:5951 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 21:09:15:915 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 21:09:16:916 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 21:09:16:916 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 21:20:44:2044 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 21:20:45:2045 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 21:20:45:2045 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery completed in 10ms, returned 1 rows[39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery completed in 22ms, returned 1 rows[39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery completed in 32ms, returned 6 rows[39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery completed in 31ms, returned 9 rows[39m
2025-05-17 21:22:04:224 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-17 21:22:04:224 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery completed in 22ms, returned 0 rows[39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery completed in 8ms, returned 0 rows[39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 21:22:04:224 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-17 21:22:08:228 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:22:08:228 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:22:08:228 [37mdebug[39m: [37mQuery completed in 4ms, returned 0 rows[39m
2025-05-17 21:22:08:228 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:22:08:228 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:22:08:228 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mQuery completed in 4ms, returned 6 rows[39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mQuery completed in 8ms, returned 9 rows[39m
2025-05-17 21:22:15:2215 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-17 21:22:15:2215 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:22:15:2215 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-17 21:23:39:2339 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 21:23:39:2339 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 21:23:39:2339 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 21:26:08:268 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 21:26:08:268 [37mdebug[39m: [37mQuery params: ["emma.wilson@email.com"][39m
2025-05-17 21:26:08:268 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-17 21:26:08:268 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:26:08:268 [37mdebug[39m: [37mQuery params: [5][39m
2025-05-17 21:26:08:268 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery completed in 19ms, returned 6 rows[39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery completed in 11ms, returned 9 rows[39m
2025-05-17 21:26:09:269 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery completed in 40ms, returned 9 rows[39m
2025-05-17 21:26:09:269 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery completed in 14ms, returned 0 rows[39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery completed in 4ms, returned 0 rows[39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 21:26:09:269 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 21:26:12:2612 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:26:12:2612 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:26:12:2612 [37mdebug[39m: [37mQuery completed in 7ms, returned 0 rows[39m
2025-05-17 21:26:12:2612 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:26:12:2612 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:26:12:2612 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-17 21:26:14:2614 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mQuery completed in 8ms, returned 9 rows[39m
2025-05-17 21:26:14:2614 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:26:14:2614 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 21:26:18:2618 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:26:18:2618 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:26:18:2618 [37mdebug[39m: [37mQuery completed in 14ms, returned 0 rows[39m
2025-05-17 21:26:18:2618 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:26:18:2618 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:26:18:2618 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mQuery completed in 5ms, returned 6 rows[39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mQuery completed in 14ms, returned 9 rows[39m
2025-05-17 21:27:01:271 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mQuery completed in 6ms, returned 9 rows[39m
2025-05-17 21:27:01:271 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mQuery completed in 18ms, returned 0 rows[39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mQuery params: [5,10,0][39m
2025-05-17 21:27:01:271 [37mdebug[39m: [37mQuery completed in 6ms, returned 0 rows[39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-17 21:27:08:278 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-17 21:27:08:278 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:27:08:278 [37mdebug[39m: [37mQuery completed in 3ms, returned 0 rows[39m
2025-05-17 21:27:11:2711 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:27:11:2711 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:27:11:2711 [37mdebug[39m: [37mQuery completed in 13ms, returned 3 rows[39m
2025-05-17 21:27:11:2711 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:27:11:2711 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:27:12:2712 [37mdebug[39m: [37mQuery completed in 7ms, returned 3 rows[39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mQuery completed in 8ms, returned 6 rows[39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-17 21:33:05:335 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mQuery completed in 64ms, returned 9 rows[39m
2025-05-17 21:33:05:335 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mQuery completed in 3ms, returned 0 rows[39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:33:05:335 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 21:34:05:345 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 21:34:05:345 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 21:34:05:345 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mQuery completed in 18ms, returned 1 rows[39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mQuery completed in 23ms, returned 6 rows[39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-17 21:34:21:3421 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:34:21:3421 [37mdebug[39m: [37mQuery completed in 15ms, returned 9 rows[39m
2025-05-17 21:34:21:3421 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mQuery completed in 14ms, returned 0 rows[39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 21:34:22:3422 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 21:34:25:3425 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:34:25:3425 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:34:25:3425 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-17 21:34:25:3425 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:34:25:3425 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:34:25:3425 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mQuery completed in 4ms, returned 6 rows[39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mQuery completed in 32ms, returned 6 rows[39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mQuery completed in 24ms, returned 9 rows[39m
2025-05-17 21:36:27:3627 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mQuery completed in 6ms, returned 9 rows[39m
2025-05-17 21:36:27:3627 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mQuery completed in 6ms, returned 0 rows[39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:36:27:3627 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 21:36:30:3630 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:36:30:3630 [37mdebug[39m: [37mQuery params: ["12"][39m
2025-05-17 21:36:30:3630 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 21:36:30:3630 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:36:30:3630 [37mdebug[39m: [37mQuery params: ["11"][39m
2025-05-17 21:36:30:3630 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:36:30:3630 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 21:36:30:3630 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 21:36:30:3630 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 21:36:32:3632 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:36:32:3632 [37mdebug[39m: [37mQuery params: ["4"][39m
2025-05-17 21:36:32:3632 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:36:32:3632 [37mdebug[39m: [37mQuery params: ["8"][39m
2025-05-17 21:36:32:3632 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:36:32:3632 [37mdebug[39m: [37mQuery params: ["9"][39m
2025-05-17 21:36:32:3632 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 21:36:32:3632 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-17 21:36:32:3632 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-17 21:51:17:5117 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 21:51:17:5117 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 21:51:17:5117 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 21:51:37:5137 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 21:51:37:5137 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 21:51:37:5137 [37mdebug[39m: [37mQuery completed in 27ms, returned 1 rows[39m
2025-05-17 21:51:37:5137 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:51:37:5137 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 21:51:37:5137 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery completed in 31ms, returned 6 rows[39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-17 21:51:38:5138 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-17 21:51:38:5138 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery completed in 3ms, returned 0 rows[39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 21:51:38:5138 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-17 21:51:56:5156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:51:56:5156 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:51:56:5156 [37mdebug[39m: [37mQuery completed in 17ms, returned 3 rows[39m
2025-05-17 21:51:56:5156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:51:56:5156 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:51:56:5156 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-17 21:54:01:541 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:54:01:541 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:54:02:542 [37mdebug[39m: [37mQuery completed in 14ms, returned 3 rows[39m
2025-05-17 21:54:02:542 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:54:02:542 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:54:02:542 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-17 21:54:10:5410 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:54:10:5410 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:54:10:5410 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 21:54:10:5410 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 21:54:10:5410 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 21:54:10:5410 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-17 22:01:28:128 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:01:28:128 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 22:01:28:128 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 22:05:26:526 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 22:05:26:526 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 22:05:26:526 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 22:05:38:538 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 22:05:38:538 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 22:05:38:538 [37mdebug[39m: [37mQuery completed in 18ms, returned 1 rows[39m
2025-05-17 22:05:38:538 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:05:38:538 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 22:05:38:538 [37mdebug[39m: [37mQuery completed in 34ms, returned 1 rows[39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery completed in 29ms, returned 6 rows[39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery completed in 25ms, returned 9 rows[39m
2025-05-17 22:05:39:539 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery completed in 12ms, returned 9 rows[39m
2025-05-17 22:05:39:539 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery completed in 21ms, returned 0 rows[39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-17 22:05:39:539 [37mdebug[39m: [37mQuery completed in 26ms, returned 1 rows[39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mQuery completed in 23ms, returned 6 rows[39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mQuery completed in 53ms, returned 9 rows[39m
2025-05-17 22:12:12:1212 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mQuery completed in 5ms, returned 0 rows[39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 22:12:12:1212 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-17 22:12:15:1215 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:12:15:1215 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:12:15:1215 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-17 22:12:15:1215 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:12:15:1215 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:12:15:1215 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-17 22:12:15:1215 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:12:15:1215 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 22:12:15:1215 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 22:12:17:1217 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:12:17:1217 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:12:17:1217 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-17 22:12:17:1217 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:12:17:1217 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:12:17:1217 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-17 22:19:40:1940 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:19:40:1940 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:19:40:1940 [37mdebug[39m: [37mQuery completed in 18ms, returned 3 rows[39m
2025-05-17 22:19:40:1940 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:19:40:1940 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:19:40:1940 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-17 22:19:49:1949 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:19:49:1949 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:19:49:1949 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-17 22:19:49:1949 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:19:49:1949 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:19:49:1949 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-17 22:19:49:1949 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:19:49:1949 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 22:19:49:1949 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-17 22:20:08:208 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:20:08:208 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:20:08:208 [37mdebug[39m: [37mQuery completed in 9ms, returned 3 rows[39m
2025-05-17 22:20:08:208 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:20:08:208 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:20:08:208 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-17 22:20:08:208 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:20:08:208 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 22:20:08:208 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-17 22:22:08:228 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:08:228 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:08:228 [37mdebug[39m: [37mQuery completed in 14ms, returned 3 rows[39m
2025-05-17 22:22:08:228 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:08:228 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:08:228 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-17 22:22:16:2216 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:16:2216 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:16:2216 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-17 22:22:16:2216 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:16:2216 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:16:2216 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-17 22:22:26:2226 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:26:2226 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:26:2226 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-17 22:22:26:2226 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:26:2226 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:26:2226 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-17 22:22:33:2233 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:33:2233 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:33:2233 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 22:22:33:2233 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:33:2233 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:33:2233 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 22:22:38:2238 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:38:2238 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:38:2238 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-17 22:22:38:2238 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:38:2238 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:38:2238 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 22:22:42:2242 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:42:2242 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:42:2242 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-17 22:22:42:2242 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:42:2242 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:42:2242 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 22:22:56:2256 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:56:2256 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:56:2256 [37mdebug[39m: [37mQuery completed in 13ms, returned 3 rows[39m
2025-05-17 22:22:56:2256 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:22:56:2256 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:22:56:2256 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-17 22:23:39:2339 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:23:39:2339 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:23:39:2339 [37mdebug[39m: [37mQuery completed in 21ms, returned 3 rows[39m
2025-05-17 22:23:39:2339 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:23:39:2339 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:23:39:2339 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 22:27:55:2755 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:27:55:2755 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:27:55:2755 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-17 22:27:55:2755 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:27:55:2755 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:27:55:2755 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-17 22:28:19:2819 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:28:19:2819 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:28:19:2819 [37mdebug[39m: [37mQuery completed in 7ms, returned 3 rows[39m
2025-05-17 22:28:19:2819 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:28:19:2819 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:28:19:2819 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 22:28:19:2819 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:28:19:2819 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:28:19:2819 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 22:28:19:2819 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:28:19:2819 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 22:28:19:2819 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 22:29:06:296 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:29:06:296 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:29:06:296 [37mdebug[39m: [37mQuery completed in 9ms, returned 3 rows[39m
2025-05-17 22:29:06:296 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:29:06:296 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:29:06:296 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 22:30:16:3016 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:30:16:3016 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 22:30:16:3016 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:30:16:3016 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:30:16:3016 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-17 22:30:16:3016 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-17 22:30:33:3033 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 22:30:33:3033 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 22:30:33:3033 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 22:30:51:3051 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 22:30:51:3051 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 22:30:51:3051 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-17 22:30:51:3051 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:30:51:3051 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 22:30:51:3051 [37mdebug[39m: [37mQuery completed in 188ms, returned 1 rows[39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery completed in 28ms, returned 6 rows[39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery completed in 21ms, returned 9 rows[39m
2025-05-17 22:30:52:3052 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery completed in 7ms, returned 9 rows[39m
2025-05-17 22:30:52:3052 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery completed in 4ms, returned 0 rows[39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 22:30:52:3052 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-17 22:31:12:3112 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 22:31:12:3112 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 22:31:12:3112 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery completed in 4ms, returned 6 rows[39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery completed in 7ms, returned 9 rows[39m
2025-05-17 22:31:13:3113 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery completed in 7ms, returned 9 rows[39m
2025-05-17 22:31:13:3113 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery completed in 3ms, returned 0 rows[39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery completed in 5ms, returned 0 rows[39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 22:31:13:3113 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 22:33:14:3314 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:33:14:3314 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:33:14:3314 [37mdebug[39m: [37mQuery completed in 9ms, returned 3 rows[39m
2025-05-17 22:33:14:3314 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:33:14:3314 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:33:14:3314 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 22:33:14:3314 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:33:14:3314 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 22:33:14:3314 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-17 22:33:21:3321 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery completed in 23ms, returned 9 rows[39m
2025-05-17 22:33:21:3321 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery completed in 11ms, returned 0 rows[39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m     AND a.appointment_datetime > NOW() AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery completed in 5ms, returned 0 rows[39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery completed in 20ms, returned 1 rows[39m
2025-05-17 22:33:21:3321 [37mdebug[39m: [37mQuery completed in 18ms, returned 1 rows[39m
2025-05-17 22:33:25:3325 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:33:25:3325 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:33:25:3325 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-17 22:33:25:3325 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:33:25:3325 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:33:25:3325 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:33:25:3325 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:33:25:3325 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:33:25:3325 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 22:33:25:3325 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 22:33:25:3325 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 22:33:25:3325 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 22:33:40:3340 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:33:40:3340 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:33:40:3340 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-17 22:33:40:3340 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:33:40:3340 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:33:40:3340 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-17 22:43:39:4339 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 22:43:39:4339 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 22:43:39:4339 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mQuery completed in 9ms, returned 6 rows[39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-17 22:43:41:4341 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 22:43:41:4341 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 22:43:49:4349 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 22:43:49:4349 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 22:43:49:4349 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 22:43:49:4349 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:43:49:4349 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 22:43:49:4349 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery completed in 4ms, returned 6 rows[39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-17 22:43:50:4350 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery completed in 29ms, returned 9 rows[39m
2025-05-17 22:43:50:4350 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery completed in 48ms, returned 3 rows[39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery completed in 7ms, returned 3 rows[39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 22:43:50:4350 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-17 22:44:05:445 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:44:05:445 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:44:05:445 [37mdebug[39m: [37mQuery completed in 7ms, returned 3 rows[39m
2025-05-17 22:44:05:445 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:44:05:445 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:44:05:445 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 22:44:09:449 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:09:449 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 22:44:09:449 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery completed in 7ms, returned 6 rows[39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-17 22:44:12:4412 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery completed in 8ms, returned 9 rows[39m
2025-05-17 22:44:12:4412 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 22:44:12:4412 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 22:44:31:4431 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:31:4431 [37mdebug[39m: [37mQuery params: ["8"][39m
2025-05-17 22:44:31:4431 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:31:4431 [37mdebug[39m: [37mQuery params: ["9"][39m
2025-05-17 22:44:31:4431 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:31:4431 [37mdebug[39m: [37mQuery params: ["4"][39m
2025-05-17 22:44:31:4431 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-17 22:44:31:4431 [37mdebug[39m: [37mQuery completed in 20ms, returned 1 rows[39m
2025-05-17 22:44:31:4431 [37mdebug[39m: [37mQuery completed in 27ms, returned 1 rows[39m
2025-05-17 22:44:33:4433 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:33:4433 [37mdebug[39m: [37mQuery params: ["11"][39m
2025-05-17 22:44:33:4433 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:33:4433 [37mdebug[39m: [37mQuery params: ["12"][39m
2025-05-17 22:44:33:4433 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:33:4433 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 22:44:33:4433 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 22:44:33:4433 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-17 22:44:33:4433 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-17 22:44:41:4441 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:41:4441 [37mdebug[39m: [37mQuery params: ["4"][39m
2025-05-17 22:44:41:4441 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:41:4441 [37mdebug[39m: [37mQuery params: ["8"][39m
2025-05-17 22:44:41:4441 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 22:44:41:4441 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:41:4441 [37mdebug[39m: [37mQuery params: ["9"][39m
2025-05-17 22:44:41:4441 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 22:44:41:4441 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-17 22:44:51:4451 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:44:51:4451 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:44:51:4451 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-17 22:44:51:4451 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 22:44:51:4451 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 22:44:51:4451 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-17 22:44:51:4451 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:51:4451 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 22:44:51:4451 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 22:44:51:4451 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 22:44:51:4451 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-17 22:44:51:4451 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-17 23:01:23:123 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 23:01:23:123 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 23:01:23:123 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery completed in 24ms, returned 1 rows[39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery completed in 17ms, returned 6 rows[39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery completed in 15ms, returned 9 rows[39m
2025-05-17 23:01:35:135 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery completed in 8ms, returned 9 rows[39m
2025-05-17 23:01:35:135 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery completed in 68ms, returned 3 rows[39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 23:01:35:135 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 23:01:39:139 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 23:01:39:139 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 23:01:39:139 [37mdebug[39m: [37mQuery completed in 12ms, returned 3 rows[39m
2025-05-17 23:01:39:139 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 23:01:39:139 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 23:01:39:139 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 23:01:39:139 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:01:39:139 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 23:01:39:139 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:01:39:139 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 23:01:39:139 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-17 23:01:39:139 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-17 23:28:05:285 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 23:28:05:285 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 23:28:05:285 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 23:29:13:2913 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 23:29:13:2913 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 23:29:13:2913 [37mdebug[39m: [37mQuery completed in 54ms, returned 3 rows[39m
2025-05-17 23:29:13:2913 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 23:29:13:2913 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 23:29:13:2913 [37mdebug[39m: [37mQuery completed in 24ms, returned 3 rows[39m
2025-05-17 23:29:13:2913 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:29:13:2913 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 23:29:13:2913 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-17 23:29:13:2913 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:29:13:2913 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 23:29:13:2913 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-17 23:38:23:3823 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-17 23:38:23:3823 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-17 23:38:23:3823 [32minfo[39m: [32mEnvironment: development[39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mQuery completed in 25ms, returned 1 rows[39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mQuery completed in 39ms, returned 6 rows[39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mQuery completed in 23ms, returned 9 rows[39m
2025-05-17 23:38:41:3841 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-17 23:38:41:3841 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 23:38:41:3841 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mQuery completed in 46ms, returned 3 rows[39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-17 23:38:42:3842 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-17 23:38:46:3846 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 23:38:46:3846 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 23:38:46:3846 [37mdebug[39m: [37mQuery completed in 12ms, returned 3 rows[39m
2025-05-17 23:38:46:3846 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-17 23:38:46:3846 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-17 23:38:46:3846 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-17 23:38:46:3846 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-17 23:38:46:3846 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-17 23:38:46:3846 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery completed in 19ms, returned 6 rows[39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery completed in 35ms, returned 9 rows[39m
2025-05-18 00:04:52:452 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery completed in 8ms, returned 9 rows[39m
2025-05-18 00:04:52:452 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery completed in 11ms, returned 3 rows[39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 00:04:52:452 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 09:55:25:5525 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 09:55:26:5526 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 09:55:26:5526 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 09:55:37:5537 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 09:55:37:5537 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 09:55:37:5537 [37mdebug[39m: [37mQuery completed in 21ms, returned 1 rows[39m
2025-05-18 09:55:37:5537 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 09:55:37:5537 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 09:55:37:5537 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery completed in 38ms, returned 6 rows[39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery completed in 85ms, returned 9 rows[39m
2025-05-18 09:55:38:5538 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery completed in 17ms, returned 9 rows[39m
2025-05-18 09:55:38:5538 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery completed in 18ms, returned 3 rows[39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 09:55:38:5538 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 09:55:45:5545 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 09:55:45:5545 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 09:55:45:5545 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 09:55:45:5545 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 09:55:45:5545 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 09:55:45:5545 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 09:55:45:5545 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 09:55:45:5545 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 10:02:28:228 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 10:02:28:228 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 10:02:28:228 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 10:02:28:228 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 10:02:28:228 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 10:02:28:228 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 10:02:28:228 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 10:02:28:228 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 10:03:52:352 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 10:03:52:352 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 10:03:52:352 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 10:03:56:356 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 10:03:56:356 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 10:03:56:356 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 10:03:56:356 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 10:04:01:41 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 10:04:01:41 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 10:04:01:41 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 10:04:01:41 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery completed in 21ms, returned 1 rows[39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery completed in 18ms, returned 1 rows[39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery completed in 47ms, returned 6 rows[39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery completed in 4ms, returned 6 rows[39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery completed in 16ms, returned 9 rows[39m
2025-05-18 10:04:13:413 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery completed in 11ms, returned 9 rows[39m
2025-05-18 10:04:13:413 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery completed in 38ms, returned 3 rows[39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 10:04:13:413 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-18 10:05:32:532 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 10:05:32:532 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 10:05:32:532 [37mdebug[39m: [37mQuery completed in 23ms, returned 3 rows[39m
2025-05-18 10:05:32:532 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 10:05:32:532 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 10:05:32:532 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 10:05:32:532 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 10:05:32:532 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-18 10:05:32:532 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 10:05:33:533 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 10:05:33:533 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 10:05:33:533 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 10:05:33:533 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 10:05:33:533 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 10:05:33:533 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 10:05:33:533 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 10:05:33:533 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 10:05:35:535 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 10:05:35:535 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 10:05:35:535 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-18 10:05:35:535 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 10:05:35:535 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 10:05:35:535 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-18 10:05:44:544 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 10:05:44:544 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 10:05:44:544 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 10:05:44:544 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 10:05:44:544 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 10:05:44:544 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 10:05:44:544 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 10:05:44:544 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 10:10:19:1019 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 10:10:19:1019 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 10:10:19:1019 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 10:10:37:1037 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 10:10:37:1037 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 10:10:37:1037 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 10:10:37:1037 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 10:10:37:1037 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 10:10:37:1037 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery completed in 23ms, returned 6 rows[39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery completed in 4ms, returned 6 rows[39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery completed in 21ms, returned 9 rows[39m
2025-05-18 10:10:38:1038 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-18 10:10:38:1038 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 10:10:38:1038 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 10:10:55:1055 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 10:10:55:1055 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 10:10:55:1055 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 10:10:55:1055 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 10:10:55:1055 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 10:10:55:1055 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 10:10:55:1055 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 10:10:55:1055 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 10:21:05:215 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 10:21:05:215 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 10:21:05:215 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 10:21:14:2114 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 10:21:14:2114 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 10:21:14:2114 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 10:21:35:2135 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 10:21:36:2136 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 10:21:36:2136 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 10:22:11:2211 [32minfo[39m: [32mRunning migration: add_patient_fields.sql[39m
2025-05-18 10:22:11:2211 [32minfo[39m: [32mMigration completed successfully: add_patient_fields.sql[39m
2025-05-18 10:22:12:2212 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 10:22:12:2212 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 10:22:12:2212 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 10:22:59:2259 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 10:22:59:2259 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 10:22:59:2259 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 10:23:09:239 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 10:23:09:239 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 10:23:09:239 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 11:20:40:2040 [32minfo[39m: [32mRunning migration: remove_duplicate_columns.sql[39m
2025-05-18 11:20:40:2040 [32minfo[39m: [32mMigration completed successfully: remove_duplicate_columns.sql[39m
2025-05-18 12:10:13:1013 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 12:10:13:1013 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 12:10:13:1013 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 12:10:34:1034 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 12:10:34:1034 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 12:10:34:1034 [37mdebug[39m: [37mQuery completed in 49ms, returned 1 rows[39m
2025-05-18 12:10:34:1034 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 12:10:34:1034 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:10:34:1034 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery completed in 32ms, returned 6 rows[39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery completed in 98ms, returned 9 rows[39m
2025-05-18 12:10:35:1035 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-18 12:10:35:1035 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 12:10:35:1035 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 12:10:43:1043 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 12:10:43:1043 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 12:10:43:1043 [37mdebug[39m: [37mQuery completed in 7ms, returned 3 rows[39m
2025-05-18 12:10:43:1043 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 12:10:43:1043 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 12:10:43:1043 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 12:10:43:1043 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 12:10:43:1043 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-18 12:10:43:1043 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 12:10:45:1045 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 12:10:45:1045 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:10:45:1045 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 12:10:45:1045 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 12:10:45:1045 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_group as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 12:10:45:1045 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:10:45:1045 [31merror[39m: [31mQuery error: column p.blood_group does not exist[39m
2025-05-18 12:10:45:1045 [31merror[39m: [31mError in getPatientProfile: column p.blood_group does not exist[39m
2025-05-18 12:21:32:2132 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 12:21:32:2132 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 12:21:32:2132 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 12:42:51:4251 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 12:42:52:4252 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 12:42:52:4252 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 12:42:54:4254 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 12:42:54:4254 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:42:54:4254 [37mdebug[39m: [37mQuery completed in 20ms, returned 1 rows[39m
2025-05-18 12:42:54:4254 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 12:42:54:4254 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:42:54:4254 [37mdebug[39m: [37mQuery completed in 2ms, returned 2 rows[39m
2025-05-18 12:42:54:4254 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 12:42:54:4254 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:42:54:4254 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 12:42:54:4254 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 12:42:59:4259 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 12:42:59:4259 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:42:59:4259 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 12:42:59:4259 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 12:42:59:4259 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:42:59:4259 [37mdebug[39m: [37mQuery completed in 2ms, returned 2 rows[39m
2025-05-18 12:42:59:4259 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 12:42:59:4259 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:42:59:4259 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 12:42:59:4259 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 12:43:03:433 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 12:43:03:433 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:43:03:433 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 12:43:03:433 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 12:43:03:433 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:43:03:433 [37mdebug[39m: [37mQuery completed in 3ms, returned 2 rows[39m
2025-05-18 12:43:03:433 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 12:43:03:433 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:43:03:433 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 12:43:03:433 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 12:43:17:4317 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 12:43:17:4317 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 12:43:17:4317 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 12:43:17:4317 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 12:43:17:4317 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:43:17:4317 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery completed in 59ms, returned 6 rows[39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery completed in 25ms, returned 9 rows[39m
2025-05-18 12:43:18:4318 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery completed in 35ms, returned 9 rows[39m
2025-05-18 12:43:18:4318 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery completed in 25ms, returned 3 rows[39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 12:43:18:4318 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:43:22:4322 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 12:43:22:4322 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mQuery completed in 0ms, returned 2 rows[39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 12:43:22:4322 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 12:43:22:4322 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 12:43:22:4322 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 13:10:21:1021 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:10:21:1021 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:10:21:1021 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:10:27:1027 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:10:27:1027 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:10:27:1027 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:10:38:1038 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:10:39:1039 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:10:39:1039 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:10:44:1044 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:10:44:1044 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:10:44:1044 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:10:56:1056 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:10:56:1056 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:10:56:1056 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:11:00:110 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:11:01:111 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:11:01:111 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:11:18:1118 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:11:18:1118 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:11:18:1118 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:19:16:1916 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:19:17:1917 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:19:17:1917 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:20:58:2058 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:20:58:2058 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:20:58:2058 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:21:04:214 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 13:21:04:214 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 13:21:04:214 [37mdebug[39m: [37mQuery completed in 27ms, returned 1 rows[39m
2025-05-18 13:21:04:214 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 13:21:04:214 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:21:04:214 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-18 13:21:04:214 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 13:21:04:214 [37mdebug[39m: [37mQuery completed in 45ms, returned 6 rows[39m
2025-05-18 13:21:04:214 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery completed in 18ms, returned 6 rows[39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery completed in 108ms, returned 9 rows[39m
2025-05-18 13:21:05:215 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-18 13:21:05:215 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 13:21:05:215 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 13:24:44:2444 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:24:44:2444 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:24:44:2444 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:24:49:2449 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:24:49:2449 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:24:49:2449 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:25:01:251 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:25:01:251 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:25:01:251 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:25:05:255 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:25:06:256 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:25:06:256 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:25:29:2529 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:25:29:2529 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:25:29:2529 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:34:32:3432 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:34:32:3432 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:34:32:3432 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:34:53:3453 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 13:34:53:3453 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 13:34:53:3453 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 13:34:53:3453 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 13:34:53:3453 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:34:53:3453 [37mdebug[39m: [37mQuery completed in 29ms, returned 1 rows[39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery completed in 61ms, returned 6 rows[39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery completed in 4ms, returned 6 rows[39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery completed in 62ms, returned 9 rows[39m
2025-05-18 13:34:54:3454 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery completed in 17ms, returned 9 rows[39m
2025-05-18 13:34:54:3454 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery completed in 20ms, returned 3 rows[39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 13:34:54:3454 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:35:00:350 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 13:35:00:350 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mQuery completed in 0ms, returned 2 rows[39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 13:35:00:350 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:35:00:350 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 13:35:00:350 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 13:47:10:4710 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:47:10:4710 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:47:10:4710 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:47:21:4721 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 13:47:21:4721 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 13:47:21:4721 [37mdebug[39m: [37mQuery completed in 20ms, returned 1 rows[39m
2025-05-18 13:47:21:4721 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 13:47:21:4721 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:47:21:4721 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery completed in 97ms, returned 6 rows[39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery completed in 8ms, returned 6 rows[39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery completed in 23ms, returned 9 rows[39m
2025-05-18 13:47:22:4722 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-18 13:47:22:4722 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery completed in 14ms, returned 3 rows[39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 13:47:22:4722 [37mdebug[39m: [37mQuery completed in 25ms, returned 1 rows[39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mQuery completed in 3ms, returned 2 rows[39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:47:28:4728 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 13:47:28:4728 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 13:47:28:4728 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:47:28:4728 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 13:47:28:4728 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 13:50:57:5057 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:50:58:5058 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:50:58:5058 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:52:01:521 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:52:01:521 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:52:01:521 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:52:57:5257 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 13:52:57:5257 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:52:57:5257 [37mdebug[39m: [37mQuery completed in 10ms, returned 1 rows[39m
2025-05-18 13:52:57:5257 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 13:52:57:5257 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:52:57:5257 [37mdebug[39m: [37mQuery completed in 2ms, returned 2 rows[39m
2025-05-18 13:52:57:5257 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 13:52:57:5257 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 13:52:57:5257 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 13:52:57:5257 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 13:53:28:5328 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:53:28:5328 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:53:28:5328 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 13:57:15:5715 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 13:57:15:5715 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 13:57:15:5715 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 14:07:52:752 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 14:07:52:752 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 14:07:52:752 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 15:02:28:228 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 15:02:28:228 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 15:02:28:228 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 15:55:16:5516 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 15:55:16:5516 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 15:55:16:5516 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 15:55:31:5531 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 15:55:31:5531 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 15:55:31:5531 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 15:55:34:5534 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 15:55:34:5534 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 15:55:34:5534 [37mdebug[39m: [37mQuery completed in 23ms, returned 1 rows[39m
2025-05-18 15:55:34:5534 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 15:55:34:5534 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:55:34:5534 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery completed in 30ms, returned 6 rows[39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery completed in 29ms, returned 6 rows[39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery completed in 32ms, returned 9 rows[39m
2025-05-18 15:55:36:5536 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery completed in 12ms, returned 9 rows[39m
2025-05-18 15:55:36:5536 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery completed in 30ms, returned 3 rows[39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 15:55:36:5536 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mQuery completed in 3ms, returned 2 rows[39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:55:43:5543 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 15:55:43:5543 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 15:55:43:5543 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:55:43:5543 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 15:55:43:5543 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 15:56:02:562 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 15:56:02:562 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 15:56:02:562 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mQuery completed in 34ms, returned 6 rows[39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mQuery completed in 4ms, returned 6 rows[39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mQuery completed in 12ms, returned 9 rows[39m
2025-05-18 15:56:17:5617 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mQuery completed in 6ms, returned 9 rows[39m
2025-05-18 15:56:17:5617 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 15:56:17:5617 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mQuery completed in 2ms, returned 2 rows[39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:56:23:5623 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 15:56:23:5623 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 15:56:23:5623 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 15:56:23:5623 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 15:56:23:5623 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 16:00:32:032 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:00:32:032 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:00:32:032 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 16:00:52:052 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:00:53:053 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:00:53:053 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 16:04:23:423 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:04:23:423 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:04:23:423 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 16:11:37:1137 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:11:37:1137 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:11:37:1137 [37mdebug[39m: [37mQuery completed in 20ms, returned 1 rows[39m
2025-05-18 16:11:37:1137 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:11:37:1137 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:11:37:1137 [37mdebug[39m: [37mQuery completed in 3ms, returned 2 rows[39m
2025-05-18 16:11:37:1137 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:11:37:1137 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:11:37:1137 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 16:11:37:1137 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 16:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 16:11:50:1150 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 16:11:50:1150 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 16:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:11:50:1150 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:11:50:1150 [37mdebug[39m: [37mQuery completed in 45ms, returned 1 rows[39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery completed in 30ms, returned 6 rows[39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery completed in 18ms, returned 9 rows[39m
2025-05-18 16:11:51:1151 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery completed in 15ms, returned 9 rows[39m
2025-05-18 16:11:51:1151 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery completed in 27ms, returned 3 rows[39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery completed in 10ms, returned 1 rows[39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 16:11:51:1151 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 16:11:55:1155 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:11:55:1155 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:11:55:1155 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 16:11:55:1155 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:11:55:1155 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:11:55:1155 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:11:55:1155 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:11:55:1155 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:11:55:1155 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 16:11:55:1155 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 16:11:55:1155 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:11:55:1155 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:11:56:1156 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 16:11:56:1156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:11:56:1156 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:11:56:1156 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:11:56:1156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:11:56:1156 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:11:56:1156 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 16:11:56:1156 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 16:18:44:1844 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:18:44:1844 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:18:44:1844 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery completed in 34ms, returned 6 rows[39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery completed in 34ms, returned 9 rows[39m
2025-05-18 16:19:21:1921 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-18 16:19:21:1921 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery completed in 20ms, returned 3 rows[39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 16:19:21:1921 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 16:21:29:2129 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:21:29:2129 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:21:29:2129 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 16:21:34:2134 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:21:34:2134 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:21:34:2134 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-18 16:21:34:2134 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:21:34:2134 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:21:34:2134 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:21:34:2134 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:21:34:2134 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:21:34:2134 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 16:21:34:2134 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 16:21:39:2139 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:21:39:2139 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:21:39:2139 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 16:22:10:2210 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:22:10:2210 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:22:10:2210 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 16:22:23:2223 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:22:23:2223 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:22:23:2223 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 16:22:23:2223 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:22:23:2223 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:22:23:2223 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:22:23:2223 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:22:23:2223 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:22:23:2223 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 16:22:23:2223 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 16:22:29:2229 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 16:22:29:2229 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 16:22:29:2229 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 16:22:29:2229 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:22:29:2229 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:22:29:2229 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery completed in 39ms, returned 6 rows[39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery completed in 14ms, returned 9 rows[39m
2025-05-18 16:22:30:2230 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-18 16:22:30:2230 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 16:22:30:2230 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:22:34:2234 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 16:22:34:2234 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_primary as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:22:34:2234 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:22:34:2234 [31merror[39m: [31mQuery error: column "is_primary" does not exist[39m
2025-05-18 16:22:34:2234 [31merror[39m: [31mError in getPatientProfile: column "is_primary" does not exist[39m
2025-05-18 16:32:11:3211 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:32:12:3212 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 16:32:12:3212 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:32:12:3212 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 16:32:26:3226 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 16:32:26:3226 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 16:32:26:3226 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 16:32:26:3226 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:32:26:3226 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:32:26:3226 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery completed in 32ms, returned 6 rows[39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery completed in 0ms, returned 6 rows[39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery completed in 27ms, returned 9 rows[39m
2025-05-18 16:32:27:3227 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-18 16:32:27:3227 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery completed in 14ms, returned 3 rows[39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 16:32:27:3227 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mQuery completed in 0ms, returned 2 rows[39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:32:32:3232 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mQuery completed in 76ms, returned 1 rows[39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mQuery completed in 5ms, returned 2 rows[39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:35:22:3522 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:40:34:4034 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 16:41:07:417 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:41:07:417 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 16:41:07:417 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 16:42:12:4212 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:42:12:4212 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:42:12:4212 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:42:12:4212 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 16:42:12:4212 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 16:42:12:4212 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 16:42:12:4212 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:42:12:4212 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:42:12:4212 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:42:12:4212 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:42:12:4212 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:42:12:4212 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 16:52:23:5223 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:52:23:5223 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 16:52:23:5223 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:52:23:5223 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 16:52:43:5243 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 16:52:43:5243 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 16:52:43:5243 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-18 16:52:43:5243 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:52:43:5243 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:52:43:5243 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery completed in 33ms, returned 6 rows[39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery completed in 28ms, returned 9 rows[39m
2025-05-18 16:52:44:5244 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery completed in 26ms, returned 9 rows[39m
2025-05-18 16:52:44:5244 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery completed in 31ms, returned 3 rows[39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 16:52:44:5244 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-18 16:52:49:5249 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 16:52:49:5249 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 16:52:49:5249 [37mdebug[39m: [37mQuery completed in 15ms, returned 3 rows[39m
2025-05-18 16:52:49:5249 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 16:52:49:5249 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 16:52:49:5249 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-18 16:52:49:5249 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 16:52:49:5249 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-18 16:52:49:5249 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:52:54:5254 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 16:53:56:5356 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture"[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 16:53:56:5356 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:53:56:5356 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 16:53:56:5356 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:53:56:5356 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:53:56:5356 [37mdebug[39m: [37mQuery completed in 0ms, returned 2 rows[39m
2025-05-18 16:53:56:5356 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 16:53:56:5356 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 16:53:56:5356 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 16:57:49:5749 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:57:49:5749 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 16:57:49:5749 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:57:49:5749 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 16:58:03:583 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:58:04:584 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 16:58:04:584 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:58:04:584 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 16:58:24:5824 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:58:25:5825 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 16:58:25:5825 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:58:25:5825 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 16:58:41:5841 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 16:58:42:5842 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 16:58:42:5842 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 16:58:42:5842 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 17:10:15:1015 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 17:10:15:1015 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 17:10:15:1015 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 17:10:15:1015 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 17:10:34:1034 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 17:10:34:1034 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 17:10:34:1034 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery completed in 30ms, returned 6 rows[39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery completed in 18ms, returned 9 rows[39m
2025-05-18 17:10:35:1035 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery completed in 11ms, returned 9 rows[39m
2025-05-18 17:10:35:1035 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 17:10:35:1035 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 17:10:37:1037 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:10:37:1037 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:10:37:1037 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 17:10:37:1037 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:10:37:1037 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:10:37:1037 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 17:10:37:1037 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:10:37:1037 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:10:37:1037 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 17:10:37:1037 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:10:37:1037 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:10:37:1037 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 17:10:38:1038 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:10:38:1038 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:10:38:1038 [37mdebug[39m: [37mQuery completed in 0ms, returned 2 rows[39m
2025-05-18 17:10:38:1038 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:10:38:1038 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:10:38:1038 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 17:16:18:1618 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 17:16:18:1618 [37mdebug[39m: [37mQuery params: ["robert.johnson@healthclinic.com"][39m
2025-05-18 17:16:18:1618 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 17:16:18:1618 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:16:18:1618 [37mdebug[39m: [37mQuery params: [12][39m
2025-05-18 17:16:18:1618 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-18 17:17:56:1756 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 17:17:56:1756 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 17:17:56:1756 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 17:17:56:1756 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:17:56:1756 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:17:56:1756 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery completed in 11ms, returned 6 rows[39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery completed in 0ms, returned 6 rows[39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-18 17:17:57:1757 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery completed in 7ms, returned 9 rows[39m
2025-05-18 17:17:57:1757 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 17:17:57:1757 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 17:19:15:1915 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 17:19:15:1915 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 17:19:15:1915 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 17:19:15:1915 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 17:20:53:2053 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 17:20:54:2054 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 17:20:54:2054 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 17:20:54:2054 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 17:21:07:217 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 17:21:08:218 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 17:21:08:218 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 17:21:08:218 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 17:21:41:2141 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 17:21:41:2141 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 17:21:41:2141 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 17:21:41:2141 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 17:22:08:228 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 17:22:08:228 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery completed in 50ms, returned 1 rows[39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery completed in 11ms, returned 6 rows[39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery completed in 37ms, returned 9 rows[39m
2025-05-18 17:22:09:229 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-18 17:22:09:229 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery completed in 11ms, returned 3 rows[39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 17:22:09:229 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mQuery completed in 0ms, returned 2 rows[39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:22:10:2210 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 17:22:45:2245 [31merror[39m: [31mError in addEmergencyContact: column "is_primary" of relation "emergency_contacts" does not exist[39m
2025-05-18 17:26:55:2655 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:26:55:2655 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:26:55:2655 [37mdebug[39m: [37mQuery completed in 18ms, returned 1 rows[39m
2025-05-18 17:26:55:2655 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:26:55:2655 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:26:55:2655 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 17:26:55:2655 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:26:55:2655 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:26:55:2655 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 17:27:28:2728 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 17:27:28:2728 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 17:27:28:2728 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 17:27:28:2728 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 17:27:31:2731 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:27:31:2731 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:27:31:2731 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-18 17:27:31:2731 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:27:31:2731 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:27:31:2731 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 17:27:31:2731 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:27:31:2731 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:27:31:2731 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery completed in 20ms, returned 6 rows[39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery completed in 15ms, returned 9 rows[39m
2025-05-18 17:27:41:2741 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery completed in 8ms, returned 9 rows[39m
2025-05-18 17:27:41:2741 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery completed in 11ms, returned 3 rows[39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 17:27:41:2741 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mQuery completed in 2ms, returned 2 rows[39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:27:44:2744 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 17:28:01:281 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:28:01:281 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:28:01:281 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-18 17:28:01:281 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:28:01:281 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:28:01:281 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 17:28:01:281 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:28:01:281 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:28:01:281 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 17:32:39:3239 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:32:39:3239 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:32:40:3240 [37mdebug[39m: [37mQuery completed in 115ms, returned 1 rows[39m
2025-05-18 17:32:40:3240 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:32:40:3240 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:32:40:3240 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 17:32:40:3240 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:32:40:3240 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:32:40:3240 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 17:33:00:330 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:33:00:330 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:33:00:330 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-18 17:33:00:330 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:33:00:330 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:33:00:330 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 17:33:00:330 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:33:00:330 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:33:00:330 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 17:33:22:3322 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:33:22:3322 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:33:22:3322 [37mdebug[39m: [37mQuery completed in 46ms, returned 1 rows[39m
2025-05-18 17:33:22:3322 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:33:22:3322 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:33:22:3322 [37mdebug[39m: [37mQuery completed in 3ms, returned 2 rows[39m
2025-05-18 17:33:22:3322 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:33:22:3322 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:33:22:3322 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 17:33:38:3338 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:33:38:3338 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:33:38:3338 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-18 17:33:38:3338 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:33:38:3338 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:33:38:3338 [37mdebug[39m: [37mQuery completed in 2ms, returned 2 rows[39m
2025-05-18 17:33:38:3338 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:33:38:3338 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:33:38:3338 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 17:33:53:3353 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:33:53:3353 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:33:53:3353 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:33:53:3353 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 17:33:53:3353 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-18 17:33:53:3353 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:33:53:3353 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:33:53:3353 [37mdebug[39m: [37mQuery completed in 2ms, returned 2 rows[39m
2025-05-18 17:33:53:3353 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:33:53:3353 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:33:53:3353 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-18 17:33:53:3353 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery completed in 22ms, returned 1 rows[39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:45:29:4529 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 17:47:07:477 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 17:47:07:477 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 17:47:07:477 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 17:47:07:477 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 17:51:56:5156 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 17:51:56:5156 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 17:51:56:5156 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 17:51:56:5156 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mQuery completed in 21ms, returned 1 rows[39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mQuery completed in 29ms, returned 6 rows[39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mQuery completed in 58ms, returned 9 rows[39m
2025-05-18 17:52:06:526 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 17:52:06:526 [37mdebug[39m: [37mQuery completed in 6ms, returned 9 rows[39m
2025-05-18 17:52:06:526 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 17:52:07:527 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 17:52:09:529 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-18 17:52:09:529 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 17:52:09:529 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery completed in 10ms, returned 1 rows[39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-18 17:52:09:529 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 17:52:09:529 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 18:58:38:5838 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT allergy_id FROM patient_allergies[39m
[37m      WHERE allergy_id = $1 AND patient_id = $2[39m
[37m    [39m
2025-05-18 18:58:38:5838 [37mdebug[39m: [37mQuery params: ["1",13][39m
2025-05-18 18:58:38:5838 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 18:58:38:5838 [37mdebug[39m: [37mExecuting query: [39m
[37m      UPDATE patient_allergies[39m
[37m      SET [39m
[37m        name = $1,[39m
[37m        severity = $2,[39m
[37m        reaction = $3,[39m
[37m        notes = $4,[39m
[37m        updated_at = NOW()[39m
[37m      WHERE allergy_id = $5 AND patient_id = $6[39m
[37m      RETURNING [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity,[39m
[37m        reaction,[39m
[37m        notes,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-18 18:58:38:5838 [37mdebug[39m: [37mQuery params: ["Penicillin","severe",null,null,"1",13][39m
2025-05-18 18:58:39:5839 [37mdebug[39m: [37mQuery completed in 24ms, returned 1 rows[39m
2025-05-18 18:58:54:5854 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 18:58:54:5854 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 18:58:54:5854 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-18 18:59:18:5918 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT allergy_id FROM patient_allergies[39m
[37m      WHERE allergy_id = $1 AND patient_id = $2[39m
[37m    [39m
2025-05-18 18:59:18:5918 [37mdebug[39m: [37mQuery params: ["2",13][39m
2025-05-18 18:59:18:5918 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 18:59:18:5918 [37mdebug[39m: [37mExecuting query: [39m
[37m      DELETE FROM patient_allergies[39m
[37m      WHERE allergy_id = $1 AND patient_id = $2[39m
[37m    [39m
2025-05-18 18:59:18:5918 [37mdebug[39m: [37mQuery params: ["2",13][39m
2025-05-18 18:59:18:5918 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 18:59:23:5923 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 18:59:23:5923 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 18:59:23:5923 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 18:59:23:5923 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-18 18:59:23:5923 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 18:59:23:5923 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 18:59:23:5923 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-18 18:59:23:5923 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 18:59:23:5923 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 18:59:23:5923 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 18:59:23:5923 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 18:59:23:5923 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 18:59:23:5923 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 18:59:23:5923 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 18:59:39:5939 [37mdebug[39m: [37mExecuting query: [39m
[37m      INSERT INTO patient_allergies ([39m
[37m        patient_id, [39m
[37m        name, [39m
[37m        severity, [39m
[37m        reaction, [39m
[37m        notes[39m
[37m      )[39m
[37m      VALUES ($1, $2, $3, $4, $5)[39m
[37m      RETURNING [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity,[39m
[37m        reaction,[39m
[37m        notes,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-18 18:59:39:5939 [37mdebug[39m: [37mQuery params: [13,"Fever","Low",null,null][39m
2025-05-18 18:59:39:5939 [31merror[39m: [31mQuery error: invalid input value for enum severity_level: "Low"[39m
2025-05-18 18:59:39:5939 [31merror[39m: [31mError in addAllergy: invalid input value for enum severity_level: "Low"[39m
2025-05-18 19:00:28:028 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT allergy_id FROM patient_allergies[39m
[37m      WHERE allergy_id = $1 AND patient_id = $2[39m
[37m    [39m
2025-05-18 19:00:28:028 [37mdebug[39m: [37mQuery params: ["1",13][39m
2025-05-18 19:00:28:028 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 19:00:28:028 [37mdebug[39m: [37mExecuting query: [39m
[37m      UPDATE patient_allergies[39m
[37m      SET [39m
[37m        name = $1,[39m
[37m        severity = $2,[39m
[37m        reaction = $3,[39m
[37m        notes = $4,[39m
[37m        updated_at = NOW()[39m
[37m      WHERE allergy_id = $5 AND patient_id = $6[39m
[37m      RETURNING [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity,[39m
[37m        reaction,[39m
[37m        notes,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-18 19:00:28:028 [37mdebug[39m: [37mQuery params: ["Penicillins","severe",null,null,"1",13][39m
2025-05-18 19:00:28:028 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-18 19:00:31:031 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:00:31:031 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:00:31:031 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:00:31:031 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:00:31:031 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 19:00:31:031 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-18 19:00:31:031 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:00:31:031 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:00:31:031 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:00:31:031 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 19:00:31:031 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 19:00:31:031 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:00:31:031 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:00:31:031 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 19:01:45:145 [31merror[39m: [31mError in updateEmergencyContact: column "is_primary" does not exist[39m
2025-05-18 19:04:30:430 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:04:30:430 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:04:30:430 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:04:30:430 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:04:59:459 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:04:59:459 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:04:59:459 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:04:59:459 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:05:21:521 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:05:21:521 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:05:21:521 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:05:21:521 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:06:14:614 [37mdebug[39m: [37mExecuting query: SELECT enumlabel FROM pg_enum JOIN pg_type ON pg_enum.enumtypid = pg_type.oid WHERE typname =  ORDER BY enumsortorder[39m
2025-05-18 19:06:14:614 [37mdebug[39m: [37mQuery params: ["severity_level"][39m
2025-05-18 19:06:14:614 [31merror[39m: [31mQuery error: syntax error at or near "ORDER"[39m
2025-05-18 19:06:30:630 [37mdebug[39m: [37mExecuting query: SELECT enumlabel FROM pg_enum JOIN pg_type ON pg_enum.enumtypid = pg_type.oid WHERE typname = 'severity_level' ORDER BY enumsortorder[39m
2025-05-18 19:06:30:630 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-18 19:06:57:657 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-18 19:06:57:657 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:06:57:657 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 19:06:57:657 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:06:57:657 [37mdebug[39m: [37mQuery completed in 33ms, returned 1 rows[39m
2025-05-18 19:07:41:741 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:07:42:742 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:07:42:742 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:07:42:742 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:07:54:754 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 19:07:54:754 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 19:07:54:754 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 19:07:54:754 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:07:54:754 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:07:54:754 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-18 19:07:54:754 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery completed in 39ms, returned 6 rows[39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery completed in 44ms, returned 9 rows[39m
2025-05-18 19:07:55:755 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery completed in 8ms, returned 9 rows[39m
2025-05-18 19:07:55:755 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 19:07:55:755 [37mdebug[39m: [37mQuery completed in 10ms, returned 1 rows[39m
2025-05-18 19:07:59:759 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery completed in 25ms, returned 1 rows[39m
2025-05-18 19:07:59:759 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 19:07:59:759 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 19:07:59:759 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:07:59:759 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 19:08:12:812 [32minfo[39m: [32mAdding allergy with data: {"allergyName":"Fever","severity":"mild"}[39m
2025-05-18 19:08:12:812 [37mdebug[39m: [37mExecuting query: [39m
[37m      INSERT INTO patient_allergies ([39m
[37m        patient_id, [39m
[37m        name, [39m
[37m        severity, [39m
[37m        reaction, [39m
[37m        notes[39m
[37m      )[39m
[37m      VALUES ($1, $2, $3, $4, $5)[39m
[37m      RETURNING [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity,[39m
[37m        reaction,[39m
[37m        notes,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-18 19:08:12:812 [37mdebug[39m: [37mQuery params: [13,"Fever","mild",null,null][39m
2025-05-18 19:08:12:812 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 19:08:15:815 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:08:15:815 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 19:08:15:815 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:08:15:815 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:08:15:815 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:08:15:815 [37mdebug[39m: [37mQuery completed in 18ms, returned 1 rows[39m
2025-05-18 19:08:15:815 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-18 19:08:15:815 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:08:15:815 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:08:15:815 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:08:15:815 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 19:08:15:815 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:08:15:815 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:08:15:815 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:08:20:820 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT allergy_id FROM patient_allergies[39m
[37m      WHERE allergy_id = $1 AND patient_id = $2[39m
[37m    [39m
2025-05-18 19:08:20:820 [37mdebug[39m: [37mQuery params: ["7",13][39m
2025-05-18 19:08:20:820 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 19:08:20:820 [37mdebug[39m: [37mExecuting query: [39m
[37m      UPDATE patient_allergies[39m
[37m      SET [39m
[37m        name = $1,[39m
[37m        severity = $2,[39m
[37m        reaction = $3,[39m
[37m        notes = $4,[39m
[37m        updated_at = NOW()[39m
[37m      WHERE allergy_id = $5 AND patient_id = $6[39m
[37m      RETURNING [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity,[39m
[37m        reaction,[39m
[37m        notes,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-18 19:08:20:820 [37mdebug[39m: [37mQuery params: ["Fevers","mild",null,null,"7",13][39m
2025-05-18 19:08:20:820 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 19:08:22:822 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT allergy_id FROM patient_allergies[39m
[37m      WHERE allergy_id = $1 AND patient_id = $2[39m
[37m    [39m
2025-05-18 19:08:22:822 [37mdebug[39m: [37mQuery params: ["7",13][39m
2025-05-18 19:08:22:822 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:08:22:822 [37mdebug[39m: [37mExecuting query: [39m
[37m      DELETE FROM patient_allergies[39m
[37m      WHERE allergy_id = $1 AND patient_id = $2[39m
[37m    [39m
2025-05-18 19:08:22:822 [37mdebug[39m: [37mQuery params: ["7",13][39m
2025-05-18 19:08:22:822 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:08:29:829 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:08:29:829 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 19:08:29:829 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-18 19:09:18:918 [37mdebug[39m: [37mExecuting query: SELECT column_name, data_type FROM information_schema.columns WHERE table_name = 'emergency_contacts'[39m
2025-05-18 19:09:18:918 [37mdebug[39m: [37mQuery completed in 27ms, returned 9 rows[39m
2025-05-18 19:11:50:1150 [37mdebug[39m: [37mExecuting query: SELECT column_name FROM information_schema.columns WHERE table_name = 'emergency_contacts' AND column_name IN ('is_default', 'is_primary')[39m
2025-05-18 19:11:50:1150 [37mdebug[39m: [37mQuery completed in 26ms, returned 1 rows[39m
2025-05-18 19:12:33:1233 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:12:33:1233 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:12:33:1233 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:12:33:1233 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:13:08:138 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:13:08:138 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:13:08:138 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:13:08:138 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:13:39:1339 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:13:40:1340 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:13:40:1340 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:13:40:1340 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:14:02:142 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:14:02:142 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:14:02:142 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:14:02:142 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:17:11:1711 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:17:11:1711 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:17:11:1711 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:17:11:1711 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:17:27:1727 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 19:17:27:1727 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 19:17:27:1727 [37mdebug[39m: [37mQuery completed in 48ms, returned 1 rows[39m
2025-05-18 19:17:27:1727 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:17:27:1727 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:17:27:1727 [37mdebug[39m: [37mQuery completed in 61ms, returned 1 rows[39m
2025-05-18 19:17:28:1728 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 19:17:28:1728 [37mdebug[39m: [37mQuery completed in 38ms, returned 6 rows[39m
2025-05-18 19:17:28:1728 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 19:17:28:1728 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 19:17:28:1728 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 19:17:28:1728 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 19:17:28:1728 [37mdebug[39m: [37mQuery completed in 71ms, returned 9 rows[39m
2025-05-18 19:17:28:1728 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 19:17:28:1728 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 19:17:28:1728 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 19:17:28:1728 [37mdebug[39m: [37mQuery completed in 7ms, returned 9 rows[39m
2025-05-18 19:17:28:1728 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 19:17:28:1728 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 19:17:28:1728 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mQuery completed in 19ms, returned 3 rows[39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mQuery completed in 12ms, returned 3 rows[39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 19:17:29:1729 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 19:17:31:1731 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery completed in 73ms, returned 1 rows[39m
2025-05-18 19:17:31:1731 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery completed in 30ms, returned 1 rows[39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery completed in 33ms, returned 1 rows[39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 19:17:31:1731 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-18 19:17:31:1731 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:17:31:1731 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 19:17:46:1746 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:17:46:1746 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:17:46:1746 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:17:46:1746 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-18 19:17:46:1746 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:17:46:1746 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:17:46:1746 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:17:46:1746 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:17:46:1746 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 19:17:46:1746 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:17:46:1746 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:17:46:1746 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:17:46:1746 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:17:46:1746 [37mdebug[39m: [37mQuery completed in 33ms, returned 1 rows[39m
2025-05-18 19:18:50:1850 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT contact_id FROM emergency_contacts[39m
[37m      WHERE contact_id = $1 AND patient_id = $2[39m
[37m    [39m
2025-05-18 19:18:50:1850 [37mdebug[39m: [37mQuery params: ["5",13][39m
2025-05-18 19:18:50:1850 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 19:18:50:1850 [37mdebug[39m: [37mExecuting query: [39m
[37m      DELETE FROM emergency_contacts[39m
[37m      WHERE contact_id = $1 AND patient_id = $2[39m
[37m    [39m
2025-05-18 19:18:50:1850 [37mdebug[39m: [37mQuery params: ["5",13][39m
2025-05-18 19:18:50:1850 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:19:50:1950 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:19:50:1950 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 19:19:50:1950 [37mdebug[39m: [37mQuery completed in 41ms, returned 1 rows[39m
2025-05-18 19:21:19:2119 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:21:19:2119 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:21:19:2119 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:21:19:2119 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:21:35:2135 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:21:36:2136 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:21:36:2136 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:21:36:2136 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:26:48:2648 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:26:49:2649 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:26:49:2649 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:26:49:2649 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:27:01:271 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:27:01:271 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:27:01:271 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 19:27:01:271 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:27:01:271 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:27:01:271 [37mdebug[39m: [37mQuery completed in 38ms, returned 1 rows[39m
2025-05-18 19:27:01:271 [37mdebug[39m: [37mQuery completed in 44ms, returned 1 rows[39m
2025-05-18 19:27:01:271 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:27:01:271 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:27:01:271 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mQuery completed in 31ms, returned 1 rows[39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 19:27:02:272 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-18 19:27:02:272 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:27:02:272 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:27:18:2718 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:27:18:2718 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:27:18:2718 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:27:18:2718 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:27:24:2724 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:27:24:2724 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:27:24:2724 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:27:24:2724 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:30:41:3041 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery completed in 42ms, returned 1 rows[39m
2025-05-18 19:30:41:3041 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery completed in 47ms, returned 1 rows[39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 19:30:41:3041 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-18 19:30:41:3041 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:30:41:3041 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:41:00:410 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 19:41:01:411 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 19:41:01:411 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 19:41:01:411 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 19:41:16:4116 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 19:41:16:4116 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 19:41:16:4116 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery completed in 49ms, returned 6 rows[39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery completed in 54ms, returned 9 rows[39m
2025-05-18 19:41:17:4117 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery completed in 8ms, returned 9 rows[39m
2025-05-18 19:41:17:4117 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery completed in 27ms, returned 3 rows[39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 19:41:17:4117 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 19:41:18:4118 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:41:18:4118 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 19:41:18:4118 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:41:18:4118 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 19:41:18:4118 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 19:41:18:4118 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 19:41:21:4121 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery completed in 44ms, returned 1 rows[39m
2025-05-18 19:41:21:4121 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery completed in 24ms, returned 1 rows[39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery completed in 29ms, returned 1 rows[39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-18 19:41:21:4121 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery completed in 34ms, returned 1 rows[39m
2025-05-18 19:41:21:4121 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:41:21:4121 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:42:37:4237 [32minfo[39m: [32mPassword change attempt for user ID: 13[39m
2025-05-18 19:42:37:4237 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT password_hash FROM users WHERE user_id = $1[39m
[37m    [39m
2025-05-18 19:42:37:4237 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:42:37:4237 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 19:42:38:4238 [33mwarn[39m: [33mInvalid current password for user ID 13[39m
2025-05-18 19:42:41:4241 [32minfo[39m: [32mPassword change attempt for user ID: 13[39m
2025-05-18 19:42:41:4241 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT password_hash FROM users WHERE user_id = $1[39m
[37m    [39m
2025-05-18 19:42:41:4241 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:42:41:4241 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 19:42:41:4241 [37mdebug[39m: [37mExecuting query: [39m
[37m      UPDATE users[39m
[37m      SET password_hash = $1, updated_at = NOW()[39m
[37m      WHERE user_id = $2[39m
[37m      RETURNING user_id[39m
[37m    [39m
2025-05-18 19:42:41:4241 [37mdebug[39m: [37mQuery params: ["$2a$10$zeL3S1aN2QXuH0uxmZe7z.FNSnZNMph/ywycYAmlgGsRC.LuysEqi",13][39m
2025-05-18 19:42:41:4241 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 19:42:41:4241 [32minfo[39m: [32mPassword successfully updated for user ID 13[39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery completed in 6ms, returned 6 rows[39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-18 19:42:55:4255 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery completed in 24ms, returned 9 rows[39m
2025-05-18 19:42:55:4255 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 19:42:55:4255 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-18 19:43:00:430 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-18 19:43:00:430 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 19:43:00:430 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 19:43:00:430 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:43:00:430 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 19:43:10:4310 [32minfo[39m: [32mPassword change attempt for user ID: 13[39m
2025-05-18 19:43:10:4310 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT password_hash FROM users WHERE user_id = $1[39m
[37m    [39m
2025-05-18 19:43:10:4310 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 19:43:10:4310 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 19:43:10:4310 [37mdebug[39m: [37mExecuting query: [39m
[37m      UPDATE users[39m
[37m      SET password_hash = $1, updated_at = NOW()[39m
[37m      WHERE user_id = $2[39m
[37m      RETURNING user_id[39m
[37m    [39m
2025-05-18 19:43:10:4310 [37mdebug[39m: [37mQuery params: ["$2a$10$W8pVzy1qYzKf3SEB8KIuye6QKPRoAlMjOSJECa5.7Gd2lh.XSLhWW",13][39m
2025-05-18 19:43:10:4310 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 19:43:10:4310 [32minfo[39m: [32mPassword successfully updated for user ID 13[39m
2025-05-18 19:44:16:4416 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 19:44:16:4416 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 19:44:16:4416 [37mdebug[39m: [37mQuery completed in 111ms, returned 3 rows[39m
2025-05-18 19:44:16:4416 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 19:44:16:4416 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 19:44:16:4416 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-18 19:44:16:4416 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 19:44:16:4416 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-18 19:44:16:4416 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 20:55:52:5552 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 20:55:53:5553 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 20:55:53:5553 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 20:55:53:5553 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 20:56:02:562 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 20:56:02:562 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 20:56:02:562 [37mdebug[39m: [37mQuery completed in 35ms, returned 1 rows[39m
2025-05-18 20:56:02:562 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 20:56:02:562 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 20:56:02:562 [37mdebug[39m: [37mQuery completed in 26ms, returned 1 rows[39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mQuery completed in 23ms, returned 6 rows[39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mQuery completed in 89ms, returned 9 rows[39m
2025-05-18 20:56:03:563 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mQuery completed in 28ms, returned 9 rows[39m
2025-05-18 20:56:03:563 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mQuery completed in 13ms, returned 3 rows[39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 20:56:03:563 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-18 20:56:04:564 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 20:56:04:564 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 20:56:04:564 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 20:56:04:564 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 20:56:04:564 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 20:56:04:564 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 20:56:04:564 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 20:56:04:564 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 20:56:04:564 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 20:56:08:568 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 20:56:08:568 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 20:56:08:568 [37mdebug[39m: [37mQuery completed in 13ms, returned 3 rows[39m
2025-05-18 20:56:08:568 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 20:56:08:568 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 20:56:08:568 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 20:56:08:568 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 20:56:08:568 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-18 20:56:08:568 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 20:56:10:5610 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery completed in 21ms, returned 1 rows[39m
2025-05-18 20:56:10:5610 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 20:56:10:5610 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 20:56:10:5610 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 20:56:10:5610 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 20:56:21:5621 [32minfo[39m: [32mUpdating profile for patient ID: 13[39m
2025-05-18 20:56:21:5621 [37mdebug[39m: [37mProfile update data: {"firstName":"John","lastName":"Doe","phone":"016-4561362","address":"[Address Object]","bloodType":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 20:56:22:5622 [37mdebug[39m: [37mProcessed address for update: {"city":"Patient City","state":"PC","street":"456 Patient St","country":"United States","zipCode":"45678"}[39m
2025-05-18 20:56:22:5622 [31merror[39m: [31mError in updateProfile: could not determine data type of parameter $1[39m
2025-05-18 20:56:22:5622 [31merror[39m: [31mError details:[39m
2025-05-18 20:56:28:5628 [32minfo[39m: [32mUpdating profile for patient ID: 13[39m
2025-05-18 20:56:28:5628 [37mdebug[39m: [37mProfile update data: {"firstName":"John","lastName":"Doe","phone":"016-4561362","address":"[Address Object]","bloodType":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 20:56:28:5628 [37mdebug[39m: [37mProcessed address for update: {"city":"Patient City","state":"PC","street":"456 Patient St","country":"United States","zipCode":"45678"}[39m
2025-05-18 20:56:28:5628 [31merror[39m: [31mError in updateProfile: could not determine data type of parameter $1[39m
2025-05-18 20:56:28:5628 [31merror[39m: [31mError details:[39m
2025-05-18 20:56:51:5651 [32minfo[39m: [32mUpdating profile for patient ID: 13[39m
2025-05-18 20:56:51:5651 [37mdebug[39m: [37mProfile update data: {"firstName":"John","lastName":"Doe","phone":"016-4561362","address":"[Address Object]","bloodType":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 20:56:51:5651 [37mdebug[39m: [37mProcessed address for update: {"city":"Patient City","state":"PC","street":"456 Patient St","country":"United States","zipCode":"45678"}[39m
2025-05-18 20:56:51:5651 [31merror[39m: [31mError in updateProfile: could not determine data type of parameter $1[39m
2025-05-18 20:56:51:5651 [31merror[39m: [31mError details:[39m
2025-05-18 20:57:02:572 [32minfo[39m: [32mUpdating profile for patient ID: 13[39m
2025-05-18 20:57:02:572 [37mdebug[39m: [37mProfile update data: {"firstName":"John","lastName":"Doe","phone":"016-4561362","address":"[Address Object]","bloodType":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 20:57:02:572 [37mdebug[39m: [37mProcessed address for update: {"city":"Patient City","state":"PC","street":"456 Patient St","country":"United States","zipCode":"45678"}[39m
2025-05-18 20:57:02:572 [31merror[39m: [31mError in updateProfile: could not determine data type of parameter $1[39m
2025-05-18 20:57:02:572 [31merror[39m: [31mError details:[39m
2025-05-18 20:57:03:573 [32minfo[39m: [32mUpdating profile for patient ID: 13[39m
2025-05-18 20:57:03:573 [37mdebug[39m: [37mProfile update data: {"firstName":"John","lastName":"Doe","phone":"016-4561362","address":"[Address Object]","bloodType":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 20:57:03:573 [37mdebug[39m: [37mProcessed address for update: {"city":"Patient City","state":"PC","street":"456 Patient St","country":"United States","zipCode":"45678"}[39m
2025-05-18 20:57:03:573 [31merror[39m: [31mError in updateProfile: could not determine data type of parameter $1[39m
2025-05-18 20:57:03:573 [31merror[39m: [31mError details:[39m
2025-05-18 21:30:17:3017 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:30:18:3018 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:30:18:3018 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:30:18:3018 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:31:47:3147 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:31:48:3148 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:31:48:3148 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:31:48:3148 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:32:21:3221 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 21:32:21:3221 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 21:32:21:3221 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-18 21:32:21:3221 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 21:32:21:3221 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:32:21:3221 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery completed in 36ms, returned 6 rows[39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery completed in 56ms, returned 9 rows[39m
2025-05-18 21:32:22:3222 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery completed in 11ms, returned 9 rows[39m
2025-05-18 21:32:22:3222 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery completed in 19ms, returned 3 rows[39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 21:32:22:3222 [37mdebug[39m: [37mQuery completed in 26ms, returned 1 rows[39m
2025-05-18 21:32:27:3227 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery completed in 29ms, returned 1 rows[39m
2025-05-18 21:32:27:3227 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery completed in 18ms, returned 1 rows[39m
2025-05-18 21:32:27:3227 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery completed in 26ms, returned 1 rows[39m
2025-05-18 21:32:27:3227 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:32:27:3227 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 21:32:44:3244 [32minfo[39m: [32mUpdating profile for patient ID: 13[39m
2025-05-18 21:32:44:3244 [37mdebug[39m: [37mProfile update data: {"firstName":"John","lastName":"Doe","phone":"0164561362","address":"[Address Object]","bloodType":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 21:32:44:3244 [37mdebug[39m: [37mProcessed address for update: {"city":"Patient City","state":"PC","street":"456 Patient St","country":"United States","zipCode":"45678"}[39m
2025-05-18 21:32:44:3244 [31merror[39m: [31mError in updateProfile: could not determine data type of parameter $1[39m
2025-05-18 21:32:44:3244 [31merror[39m: [31mError details:[39m
2025-05-18 21:35:32:3532 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:35:33:3533 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:35:33:3533 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:35:33:3533 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:35:43:3543 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:35:44:3544 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:35:44:3544 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:35:44:3544 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:36:14:3614 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:36:14:3614 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:36:14:3614 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:36:14:3614 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:36:24:3624 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:36:24:3624 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:36:24:3624 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:36:24:3624 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:44:36:4436 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:44:37:4437 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:44:37:4437 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:44:37:4437 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:45:05:455 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 21:45:05:455 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 21:45:05:455 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-18 21:45:05:455 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 21:45:05:455 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:45:05:455 [37mdebug[39m: [37mQuery completed in 18ms, returned 1 rows[39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery completed in 31ms, returned 6 rows[39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery completed in 28ms, returned 9 rows[39m
2025-05-18 21:45:06:456 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-18 21:45:06:456 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery completed in 98ms, returned 3 rows[39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery completed in 7ms, returned 3 rows[39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery completed in 18ms, returned 1 rows[39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery completed in 31ms, returned 1 rows[39m
2025-05-18 21:45:06:456 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 21:45:10:4510 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery completed in 34ms, returned 1 rows[39m
2025-05-18 21:45:10:4510 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 21:45:10:4510 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery completed in 31ms, returned 1 rows[39m
2025-05-18 21:45:10:4510 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 21:45:10:4510 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 21:45:19:4519 [32minfo[39m: [32mUpdating profile for patient ID: 13[39m
2025-05-18 21:45:19:4519 [37mdebug[39m: [37mProfile update data: {"firstName":"John","lastName":"Doe","phone":"0164561362","address":"[Address Object]","bloodType":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 21:45:19:4519 [37mdebug[39m: [37mProcessed address for update: {"city":"Patient City","state":"PC","street":"456 Patient St","country":"United States","zipCode":"45678"}[39m
2025-05-18 21:45:19:4519 [31merror[39m: [31mError in updateProfile: could not determine data type of parameter $1[39m
2025-05-18 21:45:19:4519 [31merror[39m: [31mError details:[39m
2025-05-18 21:55:09:559 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:55:09:559 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:55:09:559 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:55:09:559 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:55:27:5527 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:55:28:5528 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:55:28:5528 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:55:28:5528 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:56:15:5615 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:56:15:5615 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:56:15:5615 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:56:15:5615 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:56:28:5628 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:56:29:5629 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:56:29:5629 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:56:29:5629 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:56:36:5636 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:56:36:5636 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:56:36:5636 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:56:36:5636 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:57:19:5719 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:57:20:5720 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:57:20:5720 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:57:20:5720 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 21:57:27:5727 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 21:57:27:5727 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 21:57:27:5727 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 21:57:27:5727 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 22:43:58:4358 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 22:43:58:4358 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 22:43:58:4358 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 22:43:58:4358 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 22:44:14:4414 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 22:44:14:4414 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 22:44:14:4414 [37mdebug[39m: [37mQuery completed in 33ms, returned 1 rows[39m
2025-05-18 22:44:14:4414 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 22:44:14:4414 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 22:44:14:4414 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery completed in 50ms, returned 6 rows[39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery completed in 23ms, returned 9 rows[39m
2025-05-18 22:44:15:4415 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-18 22:44:15:4415 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery completed in 53ms, returned 3 rows[39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-18 22:44:15:4415 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 22:44:19:4419 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery completed in 47ms, returned 1 rows[39m
2025-05-18 22:44:19:4419 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery completed in 24ms, returned 1 rows[39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 22:44:19:4419 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-18 22:44:19:4419 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 22:44:19:4419 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 22:44:28:4428 [32minfo[39m: [32mUpdating profile for patient ID: 13[39m
2025-05-18 22:44:28:4428 [37mdebug[39m: [37mProfile update data: {"firstName":"John","lastName":"Doe","phone":"0164561362","address":"[Address Object]","bloodType":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 22:44:28:4428 [37mdebug[39m: [37mFinal address JSON: {"city":"Patient City","state":"PC","street":"456 Patient St","country":"United States","zipCode":"45678"}[39m
2025-05-18 22:44:28:4428 [37mdebug[39m: [37mFinal SQL: [39m
[37m          UPDATE users[39m
[37m          SET first_name = $1, last_name = $2, phone = $3, address = $4::jsonb[39m
[37m          WHERE user_id = $5[39m
[37m          RETURNING user_id[39m
[37m        [39m
2025-05-18 22:44:28:4428 [37mdebug[39m: [37mSQL params: ["John","Doe","0164561362","{\"city\":\"Patient City\",\"state\":\"PC\",\"street\":\"456 Patient St\",\"country\":\"United States\",\"zipCode\":\"45678\"}",13][39m
2025-05-18 22:44:28:4428 [31merror[39m: [31mError in updateProfile: could not determine data type of parameter $1[39m
2025-05-18 22:44:28:4428 [31merror[39m: [31mError details:[39m
2025-05-18 22:44:59:4459 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 22:44:59:4459 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 22:44:59:4459 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 22:44:59:4459 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 22:51:24:5124 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 22:51:25:5125 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 22:51:25:5125 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 22:51:25:5125 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 22:51:44:5144 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 22:51:45:5145 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 22:51:45:5145 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 22:51:45:5145 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 22:52:04:524 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 22:52:05:525 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 22:52:05:525 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 22:52:05:525 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 22:52:34:5234 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 22:52:35:5235 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 22:52:35:5235 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 22:52:35:5235 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 22:59:43:5943 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 22:59:44:5944 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 22:59:44:5944 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 22:59:44:5944 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 22:59:56:5956 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 22:59:56:5956 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-18 22:59:56:5956 [37mdebug[39m: [37mQuery completed in 35ms, returned 1 rows[39m
2025-05-18 22:59:56:5956 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 22:59:56:5956 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 22:59:56:5956 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery completed in 34ms, returned 6 rows[39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery completed in 35ms, returned 9 rows[39m
2025-05-18 22:59:57:5957 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery completed in 11ms, returned 9 rows[39m
2025-05-18 22:59:57:5957 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery completed in 22ms, returned 3 rows[39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery completed in 20ms, returned 1 rows[39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery completed in 52ms, returned 1 rows[39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 22:59:57:5957 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-18 23:00:02:02 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery completed in 28ms, returned 1 rows[39m
2025-05-18 23:00:02:02 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery completed in 21ms, returned 1 rows[39m
2025-05-18 23:00:02:02 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-18 23:00:02:02 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 23:00:02:02 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-18 23:00:08:08 [32minfo[39m: [32mUpdating profile for patient ID: 13[39m
2025-05-18 23:00:08:08 [37mdebug[39m: [37mProfile update data: {"firstName":"John","lastName":"Doe","phone":"0164561362","address":"[Address Object]","bloodType":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 23:00:08:08 [37mdebug[39m: [37mAddress object converted to string: {"city":"Patient City","state":"PC","street":"456 Patient St","country":"United States","zipCode":"45678"}[39m
2025-05-18 23:00:08:08 [37mdebug[39m: [37mFinal SQL query:  UPDATE users SET first_name = $1, last_name = $2, phone = $3, address = $4::jsonb WHERE user_id = $5 RETURNING user_id, first_name, last_name, phone, address [39m
2025-05-18 23:00:08:08 [37mdebug[39m: [37mQuery parameters: ["John","Doe","0164561362","{\"city\":\"Patient City\",\"state\":\"PC\",\"street\":\"456 Patient St\",\"country\":\"United States\",\"zipCode\":\"45678\"}",13][39m
2025-05-18 23:00:08:08 [37mdebug[39m: [37mUpdate successful, returned data: {"user_id":13,"first_name":"John","last_name":"Doe","phone":"0164561362","address":{"city":"Patient City","state":"PC","street":"456 Patient St","country":"United States","zipCode":"45678"}}[39m
2025-05-18 23:00:08:08 [31merror[39m: [31mError in updateProfile: could not determine data type of parameter $1[39m
2025-05-18 23:00:08:08 [31merror[39m: [31mError details:[39m
2025-05-18 23:05:53:553 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 23:05:54:554 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 23:05:54:554 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 23:05:54:554 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 23:06:25:625 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 23:06:26:626 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 23:06:26:626 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 23:06:26:626 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 23:06:43:643 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 23:06:44:644 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 23:06:44:644 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 23:06:44:644 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 23:07:45:745 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 23:07:46:746 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 23:07:46:746 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 23:07:46:746 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 23:16:14:1614 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 23:16:15:1615 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 23:16:15:1615 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 23:16:15:1615 [32minfo[39m: [32mEnvironment: development[39m
2025-05-18 23:16:18:1618 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-18 23:16:18:1618 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 23:16:18:1618 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 23:16:18:1618 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 23:16:18:1618 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 23:16:18:1618 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-18 23:16:18:1618 [37mdebug[39m: [37mQuery completed in 47ms, returned 1 rows[39m
2025-05-18 23:16:18:1618 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-18 23:16:18:1618 [33mwarn[39m: [33mFailed to parse address JSON: Unexpected non-whitespace character after JSON at position 4 (line 1 column 5)[39m
2025-05-18 23:16:18:1618 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 23:16:18:1618 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 23:16:18:1618 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 23:16:18:1618 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 23:16:18:1618 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-18 23:16:18:1618 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-18 23:16:24:1624 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-18 23:16:24:1624 [37mdebug[39m: [37mQuery params: ["jane.smith@example.com"][39m
2025-05-18 23:16:24:1624 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-18 23:16:24:1624 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 23:16:24:1624 [37mdebug[39m: [37mQuery params: [14][39m
2025-05-18 23:16:24:1624 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery completed in 70ms, returned 6 rows[39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery completed in 16ms, returned 9 rows[39m
2025-05-18 23:16:25:1625 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-18 23:16:25:1625 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery params: [14,10,0][39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery completed in 4ms, returned 2 rows[39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery params: [14,10,0][39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery params: ["4"][39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-18 23:16:25:1625 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-18 23:16:29:1629 [32minfo[39m: [32mFetching profile for patient ID: 14[39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery params: [14][39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery completed in 34ms, returned 1 rows[39m
2025-05-18 23:16:29:1629 [32minfo[39m: [32mPatient data fetched: {"id":14,"bloodGroup":"B-","height":"164.00","weight":"55.10"}[39m
2025-05-18 23:16:29:1629 [33mwarn[39m: [33mFailed to parse address JSON: Unexpected token 'N', "No. 789, J"... is not valid JSON[39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery params: [14][39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery completed in 27ms, returned 1 rows[39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery completed in 4ms, returned 2 rows[39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery params: [14][39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-18 23:16:29:1629 [32minfo[39m: [32mFetching profile for patient ID: 14[39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery params: [14][39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-18 23:16:29:1629 [32minfo[39m: [32mPatient data fetched: {"id":14,"bloodGroup":"B-","height":"164.00","weight":"55.10"}[39m
2025-05-18 23:16:29:1629 [33mwarn[39m: [33mFailed to parse address JSON: Unexpected token 'N', "No. 789, J"... is not valid JSON[39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery params: [14][39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery completed in 3ms, returned 2 rows[39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery params: [14][39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery completed in 22ms, returned 1 rows[39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery params: ["14"][39m
2025-05-18 23:16:29:1629 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-18 23:16:38:1638 [32minfo[39m: [32mUpdating profile for patient ID: 14[39m
2025-05-18 23:16:38:1638 [37mdebug[39m: [37mProfile update data: {"firstName":"Jane","lastName":"Smith","phone":"0164561362","address":"No. 789, Jalan Patient, Taman Wellness, 55100 Kuala Lumpur, Wilayah Persekutuan","bloodType":"B-","height":"164.00","weight":"55.10"}[39m
2025-05-18 23:16:38:1638 [37mdebug[39m: [37mUsing string address: No. 789, Jalan Patient, Taman Wellness, 55100 Kuala Lumpur, Wilayah Persekutuan[39m
2025-05-18 23:16:38:1638 [37mdebug[39m: [37mFinal SQL query:  UPDATE users SET first_name = $1, last_name = $2, phone = $3, address = $4 WHERE user_id = $5 RETURNING user_id, first_name, last_name, phone, address [39m
2025-05-18 23:16:38:1638 [37mdebug[39m: [37mQuery parameters: ["Jane","Smith","0164561362","No. 789, Jalan Patient, Taman Wellness, 55100 Kuala Lumpur, Wilayah Persekutuan",14][39m
2025-05-18 23:16:38:1638 [37mdebug[39m: [37mUpdate successful, returned data: {"user_id":14,"first_name":"Jane","last_name":"Smith","phone":"0164561362","address":"No. 789, Jalan Patient, Taman Wellness, 55100 Kuala Lumpur, Wilayah Persekutuan"}[39m
2025-05-18 23:16:38:1638 [31merror[39m: [31mError in updateProfile: could not determine data type of parameter $1[39m
2025-05-18 23:16:38:1638 [31merror[39m: [31mError details:[39m
2025-05-18 23:18:02:182 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-18 23:18:02:182 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-18 23:18:02:182 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-18 23:18:02:182 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 09:32:05:325 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 09:32:05:325 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 09:32:05:325 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 09:32:05:325 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 09:32:16:3216 [32minfo[39m: [32mFetching profile for patient ID: 14[39m
2025-05-19 09:32:16:3216 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-19 09:32:16:3216 [37mdebug[39m: [37mQuery params: [14][39m
2025-05-19 09:32:16:3216 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 09:32:16:3216 [37mdebug[39m: [37mQuery params: ["14"][39m
2025-05-19 09:32:16:3216 [37mdebug[39m: [37mQuery completed in 37ms, returned 1 rows[39m
2025-05-19 09:32:16:3216 [32minfo[39m: [32mPatient data fetched: {"id":14,"bloodGroup":"B-","height":"164.00","weight":"55.10"}[39m
2025-05-19 09:32:16:3216 [33mwarn[39m: [33mFailed to parse address JSON: Unexpected token 'N', "No. 789, J"... is not valid JSON[39m
2025-05-19 09:32:16:3216 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-19 09:32:16:3216 [37mdebug[39m: [37mQuery params: [14][39m
2025-05-19 09:32:16:3216 [37mdebug[39m: [37mQuery completed in 42ms, returned 1 rows[39m
2025-05-19 09:32:16:3216 [37mdebug[39m: [37mQuery completed in 7ms, returned 2 rows[39m
2025-05-19 09:32:16:3216 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-19 09:32:16:3216 [37mdebug[39m: [37mQuery params: [14][39m
2025-05-19 09:32:16:3216 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-19 09:32:24:3224 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-19 09:32:24:3224 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-19 09:32:24:3224 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery completed in 63ms, returned 6 rows[39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery completed in 5ms, returned 6 rows[39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery completed in 149ms, returned 9 rows[39m
2025-05-19 09:32:25:3225 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-19 09:32:25:3225 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery completed in 47ms, returned 3 rows[39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 09:32:25:3225 [37mdebug[39m: [37mQuery completed in 10ms, returned 1 rows[39m
2025-05-19 09:32:26:3226 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 09:32:26:3226 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-19 09:32:26:3226 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 09:32:30:3230 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery completed in 63ms, returned 1 rows[39m
2025-05-19 09:32:30:3230 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-19 09:32:30:3230 [33mwarn[39m: [33mFailed to parse address JSON: Unexpected non-whitespace character after JSON at position 3 (line 1 column 4)[39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery params: ["14"][39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery completed in 27ms, returned 1 rows[39m
2025-05-19 09:32:30:3230 [32minfo[39m: [32mFetching profile for patient ID: 13[39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        p.patient_id as id,[39m
[37m        p.patient_id as "userId",[39m
[37m        p.date_of_birth as "dateOfBirth",[39m
[37m        p.blood_type as "bloodGroup",[39m
[37m        p.height,[39m
[37m        p.weight,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.address,[39m
[37m        u.profile_image_blob[39m
[37m      FROM patients p[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE p.patient_id = $1[39m
[37m    [39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery completed in 20ms, returned 1 rows[39m
2025-05-19 09:32:30:3230 [32minfo[39m: [32mPatient data fetched: {"id":13,"bloodGroup":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-19 09:32:30:3230 [33mwarn[39m: [33mFailed to parse address JSON: Unexpected non-whitespace character after JSON at position 3 (line 1 column 4)[39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        allergy_id as id,[39m
[37m        name as "allergyName",[39m
[37m        severity[39m
[37m      FROM patient_allergies[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        contact_id as id,[39m
[37m        name,[39m
[37m        relationship,[39m
[37m        phone,[39m
[37m        is_default as "isPrimary"[39m
[37m      FROM emergency_contacts[39m
[37m      WHERE patient_id = $1[39m
[37m    [39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery params: ["13"][39m
2025-05-19 09:32:30:3230 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-19 09:32:40:3240 [32minfo[39m: [32mUpdating profile for patient ID: 13[39m
2025-05-19 09:32:40:3240 [37mdebug[39m: [37mProfile update data: {"firstName":"John","lastName":"Doe","phone":"0164561362","address":"456, Jalan Recovery, Taman Wellness, 11600 Georgetown, Pulau Pinang","bloodType":"A+","height":"163.00","weight":"51.80"}[39m
2025-05-19 09:32:40:3240 [37mdebug[39m: [37mUsing string address: 456, Jalan Recovery, Taman Wellness, 11600 Georgetown, Pulau Pinang[39m
2025-05-19 09:32:40:3240 [37mdebug[39m: [37mFinal SQL query:  UPDATE users SET first_name = $1, last_name = $2, phone = $3, address = $4 WHERE user_id = $5 RETURNING user_id, first_name, last_name, phone, address [39m
2025-05-19 09:32:40:3240 [37mdebug[39m: [37mQuery parameters: ["John","Doe","0164561362","456, Jalan Recovery, Taman Wellness, 11600 Georgetown, Pulau Pinang",13][39m
2025-05-19 09:32:40:3240 [37mdebug[39m: [37mUpdate successful, returned data: {"user_id":13,"first_name":"John","last_name":"Doe","phone":"0164561362","address":"456, Jalan Recovery, Taman Wellness, 11600 Georgetown, Pulau Pinang"}[39m
2025-05-19 09:32:40:3240 [31merror[39m: [31mError in updateProfile: could not determine data type of parameter $1[39m
2025-05-19 09:32:40:3240 [31merror[39m: [31mError details:[39m
2025-05-19 09:33:45:3345 [37mdebug[39m: [37mEmergency contact address processed: [39m
2025-05-19 09:33:50:3350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 09:33:50:3350 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 09:33:50:3350 [37mdebug[39m: [37mQuery completed in 46ms, returned 3 rows[39m
2025-05-19 09:33:50:3350 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 09:33:50:3350 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 09:33:50:3350 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-19 09:33:50:3350 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 09:33:50:3350 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 09:33:50:3350 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-19 10:49:39:4939 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 10:49:39:4939 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 10:49:39:4939 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 10:49:39:4939 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 10:49:39:4939 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 10:49:50:4950 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-19 10:49:50:4950 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-19 10:49:50:4950 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-19 10:49:50:4950 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 10:49:50:4950 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 10:49:50:4950 [37mdebug[39m: [37mQuery completed in 60ms, returned 1 rows[39m
2025-05-19 10:49:51:4951 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 10:49:51:4951 [37mdebug[39m: [37mQuery completed in 50ms, returned 6 rows[39m
2025-05-19 10:49:51:4951 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 10:49:51:4951 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-19 10:49:51:4951 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 10:49:51:4951 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 10:49:51:4951 [37mdebug[39m: [37mQuery completed in 28ms, returned 9 rows[39m
2025-05-19 10:49:51:4951 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 10:49:51:4951 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 10:49:51:4951 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 10:49:51:4951 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-19 10:49:51:4951 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mQuery completed in 32ms, returned 3 rows[39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-19 10:49:52:4952 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 10:49:56:4956 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 10:49:56:4956 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mQuery completed in 54ms, returned 3 rows[39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 10:49:56:4956 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 10:49:56:4956 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-19 10:49:56:4956 [37mdebug[39m: [37mQuery completed in 20ms, returned 3 rows[39m
2025-05-19 10:50:19:5019 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 10:50:20:5020 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 10:50:20:5020 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 10:54:26:5426 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 10:54:26:5426 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 10:54:26:5426 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-19 10:55:07:557 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 10:55:07:557 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 10:55:07:557 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 11:10:24:1024 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:10:24:1024 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:10:24:1024 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:10:24:1024 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:10:24:1024 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:10:24:1024 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:10:24:1024 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:10:24:1024 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:10:29:1029 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:10:29:1029 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:10:29:1029 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:10:29:1029 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:10:29:1029 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:10:29:1029 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:10:29:1029 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:10:29:1029 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:10:29:1029 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 11:10:29:1029 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 11:10:29:1029 [37mdebug[39m: [37mQuery completed in 23ms, returned 3 rows[39m
2025-05-19 11:10:29:1029 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 11:10:29:1029 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 11:10:29:1029 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-19 11:10:42:1042 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:10:42:1042 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:10:42:1042 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:10:42:1042 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:10:42:1042 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:10:42:1042 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:10:42:1042 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:10:42:1042 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:10:51:1051 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 11:10:51:1051 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 11:10:51:1051 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 11:10:51:1051 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 11:10:51:1051 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery completed in 13ms, returned 6 rows[39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery completed in 38ms, returned 9 rows[39m
2025-05-19 11:11:04:114 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-19 11:11:04:114 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-19 11:11:04:114 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-19 11:11:08:118 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:11:08:118 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:08:118 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:11:08:118 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-19 11:11:08:118 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-19 11:11:09:119 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:11:09:119 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:09:119 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:11:09:119 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:11:09:119 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:11:09:119 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:09:119 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:11:09:119 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:11:11:1111 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:11:11:1111 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:11:1111 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 11:11:11:1111 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 11:11:11:1111 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:11:11:1111 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:11:11:1111 [37mdebug[39m: [37mQuery completed in 9ms, returned 3 rows[39m
2025-05-19 11:11:11:1111 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:11:11:1111 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:11:1111 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 11:11:11:1111 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 11:11:11:1111 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:11:11:1111 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:11:11:1111 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-19 11:11:12:1112 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:11:12:1112 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:12:1112 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:11:12:1112 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:11:12:1112 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:11:12:1112 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:12:1112 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:11:12:1112 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:11:13:1113 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 11:11:13:1113 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 11:11:13:1113 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:11:13:1113 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:13:1113 [37mdebug[39m: [37mQuery completed in 16ms, returned 3 rows[39m
2025-05-19 11:11:13:1113 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:11:13:1113 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:11:13:1113 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 11:11:13:1113 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 11:11:13:1113 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:11:13:1113 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:13:1113 [37mdebug[39m: [37mQuery completed in 9ms, returned 3 rows[39m
2025-05-19 11:11:14:1114 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:11:14:1114 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:11:16:1116 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:11:16:1116 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:16:1116 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:11:16:1116 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 11:11:16:1116 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 11:11:16:1116 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 11:11:16:1116 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 11:11:16:1116 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 12:47:56:4756 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 12:47:57:4757 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 12:47:57:4757 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 12:47:57:4757 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 12:47:57:4757 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 13:12:21:1221 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 13:12:22:1222 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 13:12:22:1222 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 13:12:22:1222 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 13:12:22:1222 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 13:12:39:1239 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-19 13:12:39:1239 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-19 13:12:39:1239 [37mdebug[39m: [37mQuery completed in 22ms, returned 1 rows[39m
2025-05-19 13:12:39:1239 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 13:12:39:1239 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 13:12:39:1239 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery completed in 32ms, returned 6 rows[39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery completed in 23ms, returned 9 rows[39m
2025-05-19 13:12:40:1240 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery completed in 14ms, returned 9 rows[39m
2025-05-19 13:12:40:1240 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery completed in 46ms, returned 3 rows[39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-19 13:12:40:1240 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 13:12:45:1245 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 13:12:45:1245 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mQuery completed in 17ms, returned 3 rows[39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 13:12:45:1245 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 13:12:45:1245 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 13:12:45:1245 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-19 13:23:54:2354 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 13:23:54:2354 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 13:23:54:2354 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 13:23:54:2354 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 13:23:54:2354 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 13:23:54:2354 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 13:23:54:2354 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 13:23:54:2354 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 13:23:57:2357 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 13:23:57:2357 [37mdebug[39m: [37mQuery params: ["2"][39m
2025-05-19 13:23:57:2357 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-19 15:44:48:4448 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 15:44:49:4449 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 15:44:49:4449 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 15:44:49:4449 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 15:44:49:4449 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 15:45:02:452 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-19 15:45:02:452 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-19 15:45:02:452 [37mdebug[39m: [37mQuery completed in 35ms, returned 1 rows[39m
2025-05-19 15:45:02:452 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 15:45:02:452 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 15:45:02:452 [37mdebug[39m: [37mQuery completed in 23ms, returned 1 rows[39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery completed in 28ms, returned 6 rows[39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery completed in 30ms, returned 9 rows[39m
2025-05-19 15:45:03:453 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-19 15:45:03:453 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery completed in 8ms, returned 3 rows[39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery completed in 37ms, returned 1 rows[39m
2025-05-19 15:45:03:453 [37mdebug[39m: [37mQuery completed in 42ms, returned 1 rows[39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mQuery completed in 13ms, returned 3 rows[39m
2025-05-19 15:45:08:458 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 15:45:08:458 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 15:45:08:458 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 15:45:08:458 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-19 15:45:08:458 [37mdebug[39m: [37mQuery completed in 28ms, returned 3 rows[39m
2025-05-19 15:45:10:4510 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 15:45:10:4510 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 15:45:10:4510 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 15:45:10:4510 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 15:45:10:4510 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 15:45:10:4510 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 15:45:10:4510 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 15:45:10:4510 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 15:45:12:4512 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 15:45:12:4512 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 15:45:12:4512 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 15:45:12:4512 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 15:45:14:4514 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 15:45:14:4514 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 15:45:14:4514 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 15:45:14:4514 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 15:45:14:4514 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 15:45:14:4514 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 15:45:14:4514 [37mdebug[39m: [37mQuery completed in 11ms, returned 3 rows[39m
2025-05-19 15:45:14:4514 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 15:45:14:4514 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 15:45:14:4514 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 15:45:14:4514 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 15:45:14:4514 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 15:45:14:4514 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 15:45:14:4514 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-19 15:45:26:4526 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 15:45:26:4526 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 15:45:26:4526 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 15:45:26:4526 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 15:45:26:4526 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 15:45:26:4526 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 15:45:26:4526 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 15:45:26:4526 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 15:45:38:4538 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.record_type as "recordType",[39m
[37m          mr.attachments,[39m
[37m          mr.follow_up_date as "followUpDate",[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 15:45:38:4538 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 15:45:38:4538 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-19 15:45:38:4538 [31merror[39m: [31mError in getPatientMedicalRecords: column mr.attachments does not exist[39m
2025-05-19 16:16:37:1637 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 16:16:37:1637 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 16:16:37:1637 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 16:16:37:1637 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 16:16:37:1637 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 16:16:44:1644 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 16:16:44:1644 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 16:16:44:1644 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 16:16:44:1644 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 16:16:44:1644 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 16:24:16:2416 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 16:24:16:2416 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 16:24:16:2416 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 16:24:16:2416 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 16:24:16:2416 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 16:24:39:2439 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-19 16:24:39:2439 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-19 16:24:39:2439 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-19 16:24:40:2440 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 16:24:40:2440 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 16:24:40:2440 [37mdebug[39m: [37mQuery completed in 55ms, returned 1 rows[39m
2025-05-19 16:24:40:2440 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 16:24:40:2440 [37mdebug[39m: [37mQuery completed in 70ms, returned 6 rows[39m
2025-05-19 16:24:40:2440 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 16:24:40:2440 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-19 16:24:40:2440 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 16:24:40:2440 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 16:24:40:2440 [37mdebug[39m: [37mQuery completed in 21ms, returned 9 rows[39m
2025-05-19 16:24:40:2440 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mQuery completed in 15ms, returned 9 rows[39m
2025-05-19 16:24:41:2441 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mQuery completed in 23ms, returned 3 rows[39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mQuery completed in 33ms, returned 1 rows[39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 16:24:41:2441 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mQuery completed in 14ms, returned 3 rows[39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mQuery completed in 18ms, returned 3 rows[39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 16:24:44:2444 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-19 16:24:55:2455 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 16:24:55:2455 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 16:24:55:2455 [37mdebug[39m: [37mQuery completed in 9ms, returned 3 rows[39m
2025-05-19 16:24:55:2455 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 16:24:55:2455 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 16:24:55:2455 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 19:34:36:3436 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 19:34:36:3436 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 19:34:36:3436 [37mdebug[39m: [37mQuery completed in 18ms, returned 3 rows[39m
2025-05-19 19:34:37:3437 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 19:34:37:3437 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 19:34:37:3437 [37mdebug[39m: [37mQuery completed in 31ms, returned 1 rows[39m
2025-05-19 19:34:49:3449 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 19:34:49:3449 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 19:34:49:3449 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mQuery completed in 14ms, returned 3 rows[39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mQuery completed in 18ms, returned 3 rows[39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 19:39:45:3945 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-19 19:43:40:4340 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 19:43:40:4340 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 19:43:40:4340 [37mdebug[39m: [37mQuery completed in 14ms, returned 3 rows[39m
2025-05-19 19:43:40:4340 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 19:43:40:4340 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 19:43:40:4340 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mQuery completed in 11ms, returned 3 rows[39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mQuery completed in 0ms, returned 3 rows[39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 19:43:48:4348 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-19 19:43:50:4350 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 19:43:50:4350 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 19:43:50:4350 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 19:43:50:4350 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 19:43:50:4350 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 19:43:50:4350 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery completed in 6ms, returned 6 rows[39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery completed in 5ms, returned 6 rows[39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery completed in 54ms, returned 9 rows[39m
2025-05-19 19:44:09:449 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery completed in 12ms, returned 9 rows[39m
2025-05-19 19:44:09:449 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-19 19:44:09:449 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-19 22:40:01:401 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 22:40:02:402 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 22:40:02:402 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 22:40:02:402 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 22:40:02:402 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 22:40:10:4010 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 22:40:11:4011 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 22:40:11:4011 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 22:40:11:4011 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 22:40:11:4011 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mQuery completed in 42ms, returned 3 rows[39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mQuery completed in 45ms, returned 3 rows[39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mQuery completed in 15ms, returned 3 rows[39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-19 22:47:19:4719 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-19 22:47:24:4724 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 22:47:24:4724 [37mdebug[39m: [37mQuery completed in 32ms, returned 6 rows[39m
2025-05-19 22:47:24:4724 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 22:47:24:4724 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-19 22:47:24:4724 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 22:47:24:4724 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 22:47:24:4724 [37mdebug[39m: [37mQuery completed in 72ms, returned 9 rows[39m
2025-05-19 22:47:24:4724 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 22:47:24:4724 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 22:47:24:4724 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 22:47:24:4724 [37mdebug[39m: [37mQuery completed in 23ms, returned 9 rows[39m
2025-05-19 22:47:24:4724 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 22:47:25:4725 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 22:47:25:4725 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 22:47:25:4725 [37mdebug[39m: [37mQuery completed in 19ms, returned 3 rows[39m
2025-05-19 22:47:25:4725 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 22:47:25:4725 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 22:47:25:4725 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 22:47:25:4725 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-19 22:47:25:4725 [37mdebug[39m: [37mQuery completed in 14ms, returned 3 rows[39m
2025-05-19 22:47:25:4725 [37mdebug[39m: [37mQuery completed in 17ms, returned 1 rows[39m
2025-05-19 22:47:25:4725 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 22:47:25:4725 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-19 22:47:25:4725 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mQuery completed in 4ms, returned 6 rows[39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-19 22:47:32:4732 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mQuery completed in 6ms, returned 9 rows[39m
2025-05-19 22:47:32:4732 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 22:47:32:4732 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 23:09:12:912 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 23:09:12:912 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 23:09:12:912 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 23:09:12:912 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 23:09:12:912 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 23:09:26:926 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-19 23:09:26:926 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-19 23:09:26:926 [37mdebug[39m: [37mQuery completed in 22ms, returned 1 rows[39m
2025-05-19 23:09:26:926 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:09:26:926 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 23:09:26:926 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery completed in 69ms, returned 6 rows[39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery completed in 25ms, returned 9 rows[39m
2025-05-19 23:09:27:927 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery completed in 29ms, returned 9 rows[39m
2025-05-19 23:09:27:927 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery completed in 24ms, returned 3 rows[39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-19 23:09:27:927 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-19 23:37:43:3743 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 23:37:44:3744 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 23:37:44:3744 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 23:37:44:3744 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 23:37:44:3744 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 23:38:15:3815 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-19 23:38:16:3816 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-19 23:38:16:3816 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-19 23:38:16:3816 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-19 23:38:16:3816 [32minfo[39m: [32mEnvironment: development[39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mQuery completed in 104ms, returned 6 rows[39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mQuery completed in 4ms, returned 6 rows[39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mQuery completed in 113ms, returned 9 rows[39m
2025-05-19 23:38:53:3853 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mQuery completed in 7ms, returned 9 rows[39m
2025-05-19 23:38:53:3853 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mQuery completed in 31ms, returned 3 rows[39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:38:53:3853 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 23:38:54:3854 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-19 23:38:54:3854 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 23:38:54:3854 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-19 23:38:54:3854 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-19 23:38:54:3854 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 23:38:54:3854 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-19 23:40:42:4042 [31merror[39m: [31mError in createAppointment: Invalid time value[39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mQuery completed in 7ms, returned 6 rows[39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mQuery completed in 36ms, returned 9 rows[39m
2025-05-19 23:40:51:4051 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-19 23:40:51:4051 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:40:51:4051 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 23:40:53:4053 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-19 23:40:53:4053 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 23:40:53:4053 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 23:40:53:4053 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-19 23:40:53:4053 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 23:40:53:4053 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-19 23:45:52:4552 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-19 23:45:52:4552 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 23:45:52:4552 [37mdebug[39m: [37mQuery completed in 25ms, returned 1 rows[39m
2025-05-19 23:45:52:4552 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-19 23:45:52:4552 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 23:45:52:4552 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 23:45:52:4552 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:45:52:4552 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 23:45:52:4552 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery completed in 54ms, returned 9 rows[39m
2025-05-19 23:45:58:4558 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery completed in 31ms, returned 9 rows[39m
2025-05-19 23:45:58:4558 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery completed in 42ms, returned 3 rows[39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-19 23:45:58:4558 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-19 23:46:01:461 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-19 23:46:01:461 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-19 23:46:01:461 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-19 23:46:01:461 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-19 23:46:01:461 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-19 23:46:01:461 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-19 23:46:12:4612 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-19 23:46:12:4612 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:46:12:4612 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-19 23:46:20:4620 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:46:20:4620 [37mdebug[39m: [37mQuery params: ["11"][39m
2025-05-19 23:46:20:4620 [37mdebug[39m: [37mQuery completed in 43ms, returned 1 rows[39m
2025-05-19 23:46:20:4620 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:46:20:4620 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 23:46:20:4620 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:46:20:4620 [37mdebug[39m: [37mQuery params: ["12"][39m
2025-05-19 23:46:20:4620 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-19 23:46:20:4620 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-19 23:46:52:4652 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 23:46:52:4652 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 23:46:52:4652 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:46:52:4652 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:46:52:4652 [37mdebug[39m: [37mQuery completed in 13ms, returned 3 rows[39m
2025-05-19 23:46:52:4652 [37mdebug[39m: [37mQuery completed in 17ms, returned 3 rows[39m
2025-05-19 23:46:52:4652 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:46:52:4652 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:46:52:4652 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 23:46:52:4652 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 23:46:52:4652 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-19 23:46:52:4652 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-19 23:46:55:4655 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:46:55:4655 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 23:46:55:4655 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-19 23:47:08:478 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:47:08:478 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 23:47:08:478 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-19 23:47:15:4715 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 23:47:15:4715 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 23:47:15:4715 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 23:47:15:4715 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 23:47:15:4715 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 23:47:15:4715 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 23:47:23:4723 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-19 23:47:23:4723 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-19 23:47:23:4723 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-19 23:47:26:4726 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:47:26:4726 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:47:26:4726 [37mdebug[39m: [37mQuery completed in 14ms, returned 3 rows[39m
2025-05-19 23:47:26:4726 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:47:26:4726 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:47:26:4726 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 23:47:26:4726 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 23:47:26:4726 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 23:47:26:4726 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 23:47:26:4726 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 23:47:26:4726 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 23:47:26:4726 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 23:47:31:4731 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 23:47:31:4731 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 23:47:31:4731 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-19 23:47:31:4731 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 23:47:31:4731 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 23:47:31:4731 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 23:47:32:4732 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:47:32:4732 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:47:32:4732 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 23:47:32:4732 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 23:47:32:4732 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 23:47:32:4732 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-19 23:47:32:4732 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-19 23:47:32:4732 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-19 23:47:32:4732 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:47:32:4732 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:47:32:4732 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 23:47:32:4732 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-19 23:47:38:4738 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mQuery completed in 11ms, returned 9 rows[39m
2025-05-19 23:47:38:4738 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-19 23:47:38:4738 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-19 23:50:46:5046 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-19 23:50:46:5046 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 23:50:46:5046 [37mdebug[39m: [37mQuery completed in 20ms, returned 1 rows[39m
2025-05-19 23:50:46:5046 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-19 23:50:46:5046 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-19 23:50:46:5046 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-19 23:50:51:5051 [31merror[39m: [31mError in createAppointment: Invalid time value[39m
2025-05-20 01:27:13:2713 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 01:27:13:2713 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 01:27:13:2713 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 01:27:13:2713 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 01:27:13:2713 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 01:27:32:2732 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 01:27:32:2732 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-20 01:27:32:2732 [37mdebug[39m: [37mQuery completed in 47ms, returned 1 rows[39m
2025-05-20 01:27:32:2732 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 01:27:32:2732 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 01:27:32:2732 [37mdebug[39m: [37mQuery completed in 26ms, returned 1 rows[39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery completed in 43ms, returned 6 rows[39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery completed in 33ms, returned 9 rows[39m
2025-05-20 01:27:33:2733 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery completed in 14ms, returned 9 rows[39m
2025-05-20 01:27:33:2733 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery completed in 66ms, returned 3 rows[39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-20 01:27:33:2733 [37mdebug[39m: [37mQuery completed in 10ms, returned 1 rows[39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mQuery completed in 25ms, returned 3 rows[39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 01:27:36:2736 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 01:27:38:2738 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 01:27:38:2738 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 01:27:38:2738 [37mdebug[39m: [37mQuery completed in 8ms, returned 3 rows[39m
2025-05-20 01:27:38:2738 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 01:27:38:2738 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 01:27:38:2738 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mQuery completed in 17ms, returned 6 rows[39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mQuery completed in 14ms, returned 9 rows[39m
2025-05-20 01:27:43:2743 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-20 01:27:43:2743 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 01:27:43:2743 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 01:27:45:2745 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 01:27:45:2745 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 01:27:45:2745 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 01:27:45:2745 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 01:27:45:2745 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 01:27:45:2745 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-20 01:27:50:2750 [31merror[39m: [31mError in createAppointment: Invalid time value[39m
2025-05-20 07:25:37:2537 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 07:25:37:2537 [37mdebug[39m: [37mQuery completed in 34ms, returned 6 rows[39m
2025-05-20 07:25:37:2537 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 07:25:37:2537 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-20 07:25:37:2537 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 07:25:37:2537 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 07:25:37:2537 [37mdebug[39m: [37mQuery completed in 47ms, returned 9 rows[39m
2025-05-20 07:25:37:2537 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 07:25:37:2537 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 07:25:37:2537 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 07:25:37:2537 [37mdebug[39m: [37mQuery completed in 89ms, returned 9 rows[39m
2025-05-20 07:25:37:2537 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 07:25:38:2538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 07:25:38:2538 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 07:25:38:2538 [37mdebug[39m: [37mQuery completed in 92ms, returned 3 rows[39m
2025-05-20 07:25:38:2538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 07:25:38:2538 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 07:25:38:2538 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 07:25:39:2539 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 07:25:39:2539 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 07:25:39:2539 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 07:25:39:2539 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 07:25:39:2539 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 07:25:39:2539 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 07:25:44:2544 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT COUNT(*) as count[39m
[37m      FROM appointments[39m
[37m      WHERE doctor_id = $1[39m
[37m        AND status NOT IN ('CANCELLED', 'NO_SHOW')[39m
[37m        AND ([39m
[37m          (appointment_datetime <= $2 AND end_datetime > $2)[39m
[37m          OR[39m
[37m          (appointment_datetime < $3 AND end_datetime >= $3)[39m
[37m          OR[39m
[37m          (appointment_datetime >= $2 AND end_datetime <= $3)[39m
[37m        )[39m
[37m    [39m
2025-05-20 07:25:44:2544 [37mdebug[39m: [37mQuery params: [3,"2025-05-21T10:00:00","2025-05-21T02:30:00.000Z"][39m
2025-05-20 07:25:44:2544 [31merror[39m: [31mQuery error: invalid input value for enum appointment_status: "CANCELLED"[39m
2025-05-20 07:25:44:2544 [31merror[39m: [31mError in createAppointment: invalid input value for enum appointment_status: "CANCELLED"[39m
2025-05-20 07:30:47:3047 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 07:30:48:3048 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 07:30:48:3048 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 07:30:48:3048 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 07:30:48:3048 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 07:31:07:317 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 07:31:07:317 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 07:31:07:317 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 07:31:07:317 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 07:31:07:317 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 07:31:21:3121 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 07:31:22:3122 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 07:31:22:3122 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 07:31:22:3122 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 07:31:22:3122 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 07:31:39:3139 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 07:31:39:3139 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 07:31:39:3139 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 07:31:39:3139 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 07:31:39:3139 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 07:31:53:3153 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 07:31:54:3154 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 07:31:54:3154 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 07:31:54:3154 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 07:31:54:3154 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 07:32:12:3212 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 07:32:12:3212 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 07:32:12:3212 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 07:32:12:3212 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 07:32:12:3212 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mQuery completed in 15ms, returned 6 rows[39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mQuery completed in 19ms, returned 9 rows[39m
2025-05-20 07:33:17:3317 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mQuery completed in 18ms, returned 9 rows[39m
2025-05-20 07:33:17:3317 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mQuery completed in 11ms, returned 3 rows[39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 07:33:17:3317 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 07:33:18:3318 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 07:33:18:3318 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 07:33:18:3318 [37mdebug[39m: [37mQuery completed in 10ms, returned 1 rows[39m
2025-05-20 07:33:18:3318 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 07:33:18:3318 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 07:33:18:3318 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 07:33:23:3323 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT COUNT(*) as count[39m
[37m      FROM appointments[39m
[37m      WHERE doctor_id = $1[39m
[37m        AND status NOT IN ('cancelled', 'no_show')[39m
[37m        AND ([39m
[37m          (appointment_datetime <= $2 AND end_datetime > $2)[39m
[37m          OR[39m
[37m          (appointment_datetime < $3 AND end_datetime >= $3)[39m
[37m          OR[39m
[37m          (appointment_datetime >= $2 AND end_datetime <= $3)[39m
[37m        )[39m
[37m    [39m
2025-05-20 07:33:23:3323 [37mdebug[39m: [37mQuery params: [3,"2025-05-20T09:00:00","2025-05-20T01:30:00.000Z"][39m
2025-05-20 07:33:23:3323 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 07:33:23:3323 [37mdebug[39m: [37mExecuting query: [39m
[37m      INSERT INTO appointments ([39m
[37m        patient_id,[39m
[37m        doctor_id,[39m
[37m        appointment_datetime,[39m
[37m        end_datetime,[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at,[39m
[37m        updated_at[39m
[37m      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, NOW(), NOW())[39m
[37m      RETURNING [39m
[37m        appointment_id as id,[39m
[37m        patient_id as "patientId",[39m
[37m        doctor_id as "doctorId",[39m
[37m        appointment_datetime as "appointmentDateTime",[39m
[37m        end_datetime as "endDateTime",[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-20 07:33:23:3323 [37mdebug[39m: [37mQuery params: [13,3,"2025-05-20T09:00:00","2025-05-20T01:30:00.000Z","scheduled","REGULAR","n m","[]"][39m
2025-05-20 07:33:23:3323 [31merror[39m: [31mQuery error: malformed array literal: "[]"[39m
2025-05-20 07:33:23:3323 [31merror[39m: [31mError in createAppointment: malformed array literal: "[]"[39m
2025-05-20 07:33:53:3353 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 07:33:53:3353 [37mdebug[39m: [37mQuery completed in 15ms, returned 6 rows[39m
2025-05-20 07:33:53:3353 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 07:33:53:3353 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-20 07:33:53:3353 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 07:33:53:3353 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 07:33:53:3353 [37mdebug[39m: [37mQuery completed in 23ms, returned 9 rows[39m
2025-05-20 07:33:53:3353 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 07:33:54:3354 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 07:33:54:3354 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 07:33:54:3354 [37mdebug[39m: [37mQuery completed in 8ms, returned 9 rows[39m
2025-05-20 07:33:54:3354 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 07:33:54:3354 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 07:33:54:3354 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 07:33:54:3354 [37mdebug[39m: [37mQuery completed in 11ms, returned 3 rows[39m
2025-05-20 07:33:54:3354 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 07:33:54:3354 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 07:33:54:3354 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 07:33:55:3355 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 07:33:55:3355 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 07:33:55:3355 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 07:33:55:3355 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 07:33:55:3355 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 07:33:55:3355 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 07:34:02:342 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT COUNT(*) as count[39m
[37m      FROM appointments[39m
[37m      WHERE doctor_id = $1[39m
[37m        AND status NOT IN ('cancelled', 'no_show')[39m
[37m        AND ([39m
[37m          (appointment_datetime <= $2 AND end_datetime > $2)[39m
[37m          OR[39m
[37m          (appointment_datetime < $3 AND end_datetime >= $3)[39m
[37m          OR[39m
[37m          (appointment_datetime >= $2 AND end_datetime <= $3)[39m
[37m        )[39m
[37m    [39m
2025-05-20 07:34:02:342 [37mdebug[39m: [37mQuery params: [3,"2025-05-20T09:00:00","2025-05-20T01:30:00.000Z"][39m
2025-05-20 07:34:02:342 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 07:34:02:342 [37mdebug[39m: [37mExecuting query: [39m
[37m      INSERT INTO appointments ([39m
[37m        patient_id,[39m
[37m        doctor_id,[39m
[37m        appointment_datetime,[39m
[37m        end_datetime,[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at,[39m
[37m        updated_at[39m
[37m      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, NOW(), NOW())[39m
[37m      RETURNING [39m
[37m        appointment_id as id,[39m
[37m        patient_id as "patientId",[39m
[37m        doctor_id as "doctorId",[39m
[37m        appointment_datetime as "appointmentDateTime",[39m
[37m        end_datetime as "endDateTime",[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-20 07:34:02:342 [37mdebug[39m: [37mQuery params: [13,3,"2025-05-20T09:00:00","2025-05-20T01:30:00.000Z","scheduled","REGULAR","dss","[\"d s s\"]"][39m
2025-05-20 07:34:02:342 [31merror[39m: [31mQuery error: malformed array literal: "["d s s"]"[39m
2025-05-20 07:34:02:342 [31merror[39m: [31mError in createAppointment: malformed array literal: "["d s s"]"[39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mQuery completed in 11ms, returned 9 rows[39m
2025-05-20 07:34:23:3423 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mQuery completed in 9ms, returned 9 rows[39m
2025-05-20 07:34:23:3423 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 07:34:23:3423 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-20 07:34:25:3425 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 07:34:25:3425 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 07:34:25:3425 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 07:34:25:3425 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 07:34:25:3425 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 07:34:25:3425 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 07:58:41:5841 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT COUNT(*) as count[39m
[37m      FROM appointments[39m
[37m      WHERE doctor_id = $1[39m
[37m        AND status NOT IN ('cancelled', 'no_show')[39m
[37m        AND ([39m
[37m          (appointment_datetime <= $2 AND end_datetime > $2)[39m
[37m          OR[39m
[37m          (appointment_datetime < $3 AND end_datetime >= $3)[39m
[37m          OR[39m
[37m          (appointment_datetime >= $2 AND end_datetime <= $3)[39m
[37m        )[39m
[37m    [39m
2025-05-20 07:58:41:5841 [37mdebug[39m: [37mQuery params: [3,"2025-05-21T15:00:00","2025-05-21T07:30:00.000Z"][39m
2025-05-20 07:58:41:5841 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-20 07:58:41:5841 [37mdebug[39m: [37mExecuting query: [39m
[37m      INSERT INTO appointments ([39m
[37m        patient_id,[39m
[37m        doctor_id,[39m
[37m        appointment_datetime,[39m
[37m        end_datetime,[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at,[39m
[37m        updated_at[39m
[37m      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, NOW(), NOW())[39m
[37m      RETURNING [39m
[37m        appointment_id as id,[39m
[37m        patient_id as "patientId",[39m
[37m        doctor_id as "doctorId",[39m
[37m        appointment_datetime as "appointmentDateTime",[39m
[37m        end_datetime as "endDateTime",[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-20 07:58:41:5841 [37mdebug[39m: [37mQuery params: [13,3,"2025-05-21T15:00:00","2025-05-21T07:30:00.000Z","scheduled","REGULAR","No reason","[\"Fever\"]"][39m
2025-05-20 07:58:41:5841 [31merror[39m: [31mQuery error: malformed array literal: "["Fever"]"[39m
2025-05-20 07:58:41:5841 [31merror[39m: [31mError in createAppointment: malformed array literal: "["Fever"]"[39m
2025-05-20 08:09:08:98 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 08:09:09:99 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 08:09:09:99 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 08:09:09:99 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 08:09:09:99 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 08:11:36:1136 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 08:11:36:1136 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 08:11:36:1136 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 08:11:36:1136 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 08:11:36:1136 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 08:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 08:11:50:1150 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-20 08:11:51:1151 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-20 08:11:51:1151 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 08:11:51:1151 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 08:11:51:1151 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-20 08:11:51:1151 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery completed in 32ms, returned 6 rows[39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery completed in 3ms, returned 6 rows[39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery completed in 34ms, returned 9 rows[39m
2025-05-20 08:11:52:1152 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery completed in 56ms, returned 9 rows[39m
2025-05-20 08:11:52:1152 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-20 08:11:52:1152 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-20 08:11:56:1156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 08:11:56:1156 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 08:11:56:1156 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-20 08:11:56:1156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 08:11:56:1156 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 08:11:56:1156 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 08:12:03:123 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT COUNT(*) as count[39m
[37m      FROM appointments[39m
[37m      WHERE doctor_id = $1[39m
[37m        AND status NOT IN ('cancelled', 'no_show')[39m
[37m        AND ([39m
[37m          (appointment_datetime <= $2 AND end_datetime > $2)[39m
[37m          OR[39m
[37m          (appointment_datetime < $3 AND end_datetime >= $3)[39m
[37m          OR[39m
[37m          (appointment_datetime >= $2 AND end_datetime <= $3)[39m
[37m        )[39m
[37m    [39m
2025-05-20 08:12:03:123 [37mdebug[39m: [37mQuery params: [3,"2025-05-21T10:00:00","2025-05-21T02:30:00.000Z"][39m
2025-05-20 08:12:03:123 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-20 08:12:03:123 [37mdebug[39m: [37mExecuting query: [39m
[37m      INSERT INTO appointments ([39m
[37m        patient_id,[39m
[37m        doctor_id,[39m
[37m        appointment_datetime,[39m
[37m        end_datetime,[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at,[39m
[37m        updated_at[39m
[37m      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, NOW(), NOW())[39m
[37m      RETURNING [39m
[37m        appointment_id as id,[39m
[37m        patient_id as "patientId",[39m
[37m        doctor_id as "doctorId",[39m
[37m        appointment_datetime as "appointmentDateTime",[39m
[37m        end_datetime as "endDateTime",[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-20 08:12:03:123 [37mdebug[39m: [37mQuery params: [13,3,"2025-05-21T10:00:00","2025-05-21T02:30:00.000Z","scheduled","REGULAR","No",["No"]][39m
2025-05-20 08:12:04:124 [31merror[39m: [31mQuery error: null value in column "created_by" of relation "appointments" violates not-null constraint[39m
2025-05-20 08:12:04:124 [31merror[39m: [31mError in createAppointment: null value in column "created_by" of relation "appointments" violates not-null constraint[39m
2025-05-20 08:35:32:3532 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 08:35:32:3532 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 08:35:32:3532 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 08:35:32:3532 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 08:35:32:3532 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 08:35:48:3548 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 08:35:48:3548 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-20 08:35:48:3548 [37mdebug[39m: [37mQuery completed in 24ms, returned 1 rows[39m
2025-05-20 08:35:48:3548 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 08:35:48:3548 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 08:35:48:3548 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery completed in 41ms, returned 6 rows[39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery completed in 35ms, returned 9 rows[39m
2025-05-20 08:35:49:3549 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery completed in 10ms, returned 9 rows[39m
2025-05-20 08:35:49:3549 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery completed in 15ms, returned 3 rows[39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-20 08:35:49:3549 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-20 08:35:54:3554 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 08:35:54:3554 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 08:35:54:3554 [37mdebug[39m: [37mQuery completed in 18ms, returned 1 rows[39m
2025-05-20 08:35:54:3554 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 08:35:54:3554 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 08:35:54:3554 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 08:35:59:3559 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT COUNT(*) as count[39m
[37m      FROM appointments[39m
[37m      WHERE doctor_id = $1[39m
[37m        AND status NOT IN ('cancelled', 'no_show')[39m
[37m        AND ([39m
[37m          (appointment_datetime <= $2 AND end_datetime > $2)[39m
[37m          OR[39m
[37m          (appointment_datetime < $3 AND end_datetime >= $3)[39m
[37m          OR[39m
[37m          (appointment_datetime >= $2 AND end_datetime <= $3)[39m
[37m        )[39m
[37m    [39m
2025-05-20 08:35:59:3559 [37mdebug[39m: [37mQuery params: [3,"2025-05-23T15:00:00","2025-05-23T07:30:00.000Z"][39m
2025-05-20 08:35:59:3559 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-20 08:35:59:3559 [37mdebug[39m: [37mExecuting query: [39m
[37m      INSERT INTO appointments ([39m
[37m        patient_id,[39m
[37m        doctor_id,[39m
[37m        appointment_datetime,[39m
[37m        end_datetime,[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at,[39m
[37m        updated_at[39m
[37m      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, NOW(), NOW())[39m
[37m      RETURNING [39m
[37m        appointment_id as id,[39m
[37m        patient_id as "patientId",[39m
[37m        doctor_id as "doctorId",[39m
[37m        appointment_datetime as "appointmentDateTime",[39m
[37m        end_datetime as "endDateTime",[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-20 08:35:59:3559 [37mdebug[39m: [37mQuery params: [13,3,"2025-05-23T15:00:00","2025-05-23T07:30:00.000Z","scheduled","REGULAR","dasd",["dsa"]][39m
2025-05-20 08:35:59:3559 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-20 08:35:59:3559 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone[39m
[37m      FROM doctors d[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE d.doctor_id = $1[39m
[37m    [39m
2025-05-20 08:35:59:3559 [37mdebug[39m: [37mQuery params: [3][39m
2025-05-20 08:35:59:3559 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 08:38:27:3827 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 08:38:28:3828 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 08:38:28:3828 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 08:38:28:3828 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 08:38:28:3828 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 08:42:07:427 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 08:42:07:427 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 08:42:07:427 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 08:42:07:427 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 08:42:07:427 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 08:42:20:4220 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 08:42:20:4220 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-20 08:42:20:4220 [37mdebug[39m: [37mQuery completed in 11ms, returned 1 rows[39m
2025-05-20 08:42:20:4220 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 08:42:20:4220 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 08:42:20:4220 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery completed in 27ms, returned 6 rows[39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery completed in 4ms, returned 6 rows[39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery completed in 96ms, returned 9 rows[39m
2025-05-20 08:42:21:4221 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery completed in 16ms, returned 9 rows[39m
2025-05-20 08:42:21:4221 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery completed in 20ms, returned 4 rows[39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery completed in 4ms, returned 4 rows[39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 08:42:21:4221 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-20 08:42:25:4225 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 08:42:25:4225 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 08:42:25:4225 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-20 08:42:25:4225 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 08:42:25:4225 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 08:42:25:4225 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-20 08:42:38:4238 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT COUNT(*) as count[39m
[37m      FROM appointments[39m
[37m      WHERE doctor_id = $1[39m
[37m        AND status NOT IN ('cancelled', 'no_show')[39m
[37m        AND ([39m
[37m          (appointment_datetime <= $2 AND end_datetime > $2)[39m
[37m          OR[39m
[37m          (appointment_datetime < $3 AND end_datetime >= $3)[39m
[37m          OR[39m
[37m          (appointment_datetime >= $2 AND end_datetime <= $3)[39m
[37m        )[39m
[37m    [39m
2025-05-20 08:42:38:4238 [37mdebug[39m: [37mQuery params: [3,"2025-05-23T10:00:00","2025-05-23T02:30:00.000Z"][39m
2025-05-20 08:42:38:4238 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-20 08:42:38:4238 [37mdebug[39m: [37mExecuting query: [39m
[37m      INSERT INTO appointments ([39m
[37m        patient_id,[39m
[37m        doctor_id,[39m
[37m        appointment_datetime,[39m
[37m        end_datetime,[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at,[39m
[37m        updated_at[39m
[37m      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, NOW(), NOW())[39m
[37m      RETURNING [39m
[37m        appointment_id as id,[39m
[37m        patient_id as "patientId",[39m
[37m        doctor_id as "doctorId",[39m
[37m        appointment_datetime as "appointmentDateTime",[39m
[37m        end_datetime as "endDateTime",[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-20 08:42:38:4238 [37mdebug[39m: [37mQuery params: [13,3,"2025-05-23T10:00:00","2025-05-23T02:30:00.000Z","scheduled","regular","dood",["Fever"]][39m
2025-05-20 08:42:38:4238 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-20 08:42:38:4238 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone[39m
[37m      FROM doctors d[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE d.doctor_id = $1[39m
[37m    [39m
2025-05-20 08:42:38:4238 [37mdebug[39m: [37mQuery params: [3][39m
2025-05-20 08:42:38:4238 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 10:56:57:5657 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 10:56:58:5658 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 10:56:58:5658 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 10:56:58:5658 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 10:56:58:5658 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 10:57:07:577 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 10:57:07:577 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-20 10:57:07:577 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-20 10:57:07:577 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 10:57:07:577 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 10:57:07:577 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery completed in 43ms, returned 6 rows[39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery completed in 25ms, returned 9 rows[39m
2025-05-20 10:57:08:578 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery completed in 72ms, returned 9 rows[39m
2025-05-20 10:57:08:578 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery completed in 34ms, returned 5 rows[39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery completed in 2ms, returned 5 rows[39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-20 10:57:08:578 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-20 10:57:13:5713 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 10:57:13:5713 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 10:57:13:5713 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-20 10:57:13:5713 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 10:57:13:5713 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 10:57:13:5713 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-20 10:57:19:5719 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT COUNT(*) as count[39m
[37m      FROM appointments[39m
[37m      WHERE doctor_id = $1[39m
[37m        AND status NOT IN ('cancelled', 'no_show')[39m
[37m        AND ([39m
[37m          (appointment_datetime <= $2 AND end_datetime > $2)[39m
[37m          OR[39m
[37m          (appointment_datetime < $3 AND end_datetime >= $3)[39m
[37m          OR[39m
[37m          (appointment_datetime >= $2 AND end_datetime <= $3)[39m
[37m        )[39m
[37m    [39m
2025-05-20 10:57:19:5719 [37mdebug[39m: [37mQuery params: [3,"2025-05-21T10:00:00","2025-05-21T02:30:00.000Z"][39m
2025-05-20 10:57:19:5719 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 10:57:19:5719 [37mdebug[39m: [37mExecuting query: [39m
[37m      INSERT INTO appointments ([39m
[37m        patient_id,[39m
[37m        doctor_id,[39m
[37m        appointment_datetime,[39m
[37m        end_datetime,[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at,[39m
[37m        updated_at[39m
[37m      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, NOW(), NOW())[39m
[37m      RETURNING [39m
[37m        appointment_id as id,[39m
[37m        patient_id as "patientId",[39m
[37m        doctor_id as "doctorId",[39m
[37m        appointment_datetime as "appointmentDateTime",[39m
[37m        end_datetime as "endDateTime",[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-20 10:57:19:5719 [37mdebug[39m: [37mQuery params: [13,3,"2025-05-21T10:00:00","2025-05-21T02:30:00.000Z","scheduled","regular","ssa",["sasa"]][39m
2025-05-20 10:57:19:5719 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-20 10:57:19:5719 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone[39m
[37m      FROM doctors d[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE d.doctor_id = $1[39m
[37m    [39m
2025-05-20 10:57:19:5719 [37mdebug[39m: [37mQuery params: [3][39m
2025-05-20 10:57:19:5719 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mQuery completed in 12ms, returned 6 rows[39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mQuery completed in 7ms, returned 6 rows[39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 10:57:22:5722 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 11:01:19:119 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:01:19:119 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:01:19:119 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-20 11:01:19:119 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:01:19:119 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:01:19:119 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 11:01:26:126 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:01:26:126 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:01:26:126 [37mdebug[39m: [37mQuery completed in 16ms, returned 6 rows[39m
2025-05-20 11:01:26:126 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:01:26:126 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:01:26:126 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:01:26:126 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:01:26:126 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-20 11:01:26:126 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-20 11:01:26:126 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:01:26:126 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:01:26:126 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 11:03:29:329 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:03:29:329 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:03:29:329 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:03:29:329 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:03:29:329 [37mdebug[39m: [37mQuery completed in 110ms, returned 3 rows[39m
2025-05-20 11:03:29:329 [37mdebug[39m: [37mQuery completed in 111ms, returned 6 rows[39m
2025-05-20 11:03:29:329 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:03:29:329 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:03:29:329 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:03:29:329 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:03:29:329 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 11:03:29:329 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-20 11:08:49:849 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:08:49:849 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:08:49:849 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:08:49:849 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:08:49:849 [37mdebug[39m: [37mQuery completed in 16ms, returned 2 rows[39m
2025-05-20 11:08:49:849 [37mdebug[39m: [37mQuery completed in 18ms, returned 6 rows[39m
2025-05-20 11:08:49:849 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:08:49:849 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:08:49:849 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:08:49:849 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:08:49:849 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 11:08:49:849 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-20 11:14:27:1427 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:14:27:1427 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:14:27:1427 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:14:27:1427 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:14:27:1427 [37mdebug[39m: [37mQuery completed in 21ms, returned 2 rows[39m
2025-05-20 11:14:27:1427 [37mdebug[39m: [37mQuery completed in 19ms, returned 3 rows[39m
2025-05-20 11:14:27:1427 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:14:27:1427 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:14:27:1427 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:14:27:1427 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:14:27:1427 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:14:27:1427 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:15:32:1532 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:15:32:1532 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:15:32:1532 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:15:32:1532 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:15:32:1532 [37mdebug[39m: [37mQuery completed in 4ms, returned 2 rows[39m
2025-05-20 11:15:32:1532 [37mdebug[39m: [37mQuery completed in 7ms, returned 3 rows[39m
2025-05-20 11:15:32:1532 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:15:32:1532 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:15:32:1532 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:15:32:1532 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:15:32:1532 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-20 11:15:32:1532 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          a.appointment_id as id,[39m
[37m          a.patient_id as "patientId",[39m
[37m          a.doctor_id as "doctorId",[39m
[37m          a.appointment_datetime as "appointmentDateTime",[39m
[37m          a.end_datetime as "endDateTime",[39m
[37m          a.status,[39m
[37m          a.type,[39m
[37m          a.reason,[39m
[37m          a.symptoms,[39m
[37m          a.notes,[39m
[37m          a.cancellation_reason as "cancellationReason",[39m
[37m          a.created_at as "createdAt",[39m
[37m          a.updated_at as "updatedAt",[39m
[37m          d.department_id as "departmentId",[39m
[37m          dep.name as "departmentName",[39m
[37m          u.first_name as "doctorFirstName",[39m
[37m          u.last_name as "doctorLastName",[39m
[37m          u.email as "doctorEmail",[39m
[37m          u.phone as "doctorPhone"[39m
[37m        FROM appointments a[39m
[37m        JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m        JOIN departments dep ON d.department_id = dep.department_id[39m
[37m        JOIN users u ON d.doctor_id = u.user_id[39m
[37m        WHERE a.appointment_id = $1 AND a.patient_id = $2[39m
[37m      [39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mQuery params: ["3",13][39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        mr.medical_record_id as id,[39m
[37m        mr.diagnosis,[39m
[37m        mr.prescription,[39m
[37m        mr.notes,[39m
[37m        mr.attachments,[39m
[37m        mr.created_at as "createdAt"[39m
[37m      FROM medical_records mr[39m
[37m      WHERE mr.appointment_id = $1[39m
[37m    [39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mQuery completed in 22ms, returned 1 rows[39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 11:15:49:1549 [31merror[39m: [31mQuery error: column mr.medical_record_id does not exist[39m
2025-05-20 11:15:49:1549 [31merror[39m: [31mError in getAppointmentById: column mr.medical_record_id does not exist[39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          a.appointment_id as id,[39m
[37m          a.patient_id as "patientId",[39m
[37m          a.doctor_id as "doctorId",[39m
[37m          a.appointment_datetime as "appointmentDateTime",[39m
[37m          a.end_datetime as "endDateTime",[39m
[37m          a.status,[39m
[37m          a.type,[39m
[37m          a.reason,[39m
[37m          a.symptoms,[39m
[37m          a.notes,[39m
[37m          a.cancellation_reason as "cancellationReason",[39m
[37m          a.created_at as "createdAt",[39m
[37m          a.updated_at as "updatedAt",[39m
[37m          d.department_id as "departmentId",[39m
[37m          dep.name as "departmentName",[39m
[37m          u.first_name as "doctorFirstName",[39m
[37m          u.last_name as "doctorLastName",[39m
[37m          u.email as "doctorEmail",[39m
[37m          u.phone as "doctorPhone"[39m
[37m        FROM appointments a[39m
[37m        JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m        JOIN departments dep ON d.department_id = dep.department_id[39m
[37m        JOIN users u ON d.doctor_id = u.user_id[39m
[37m        WHERE a.appointment_id = $1 AND a.patient_id = $2[39m
[37m      [39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mQuery params: ["3",13][39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        mr.medical_record_id as id,[39m
[37m        mr.diagnosis,[39m
[37m        mr.prescription,[39m
[37m        mr.notes,[39m
[37m        mr.attachments,[39m
[37m        mr.created_at as "createdAt"[39m
[37m      FROM medical_records mr[39m
[37m      WHERE mr.appointment_id = $1[39m
[37m    [39m
2025-05-20 11:15:49:1549 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:15:49:1549 [31merror[39m: [31mQuery error: column mr.medical_record_id does not exist[39m
2025-05-20 11:15:49:1549 [31merror[39m: [31mError in getAppointmentById: column mr.medical_record_id does not exist[39m
2025-05-20 11:15:51:1551 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:15:51:1551 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:15:51:1551 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:15:51:1551 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:15:51:1551 [37mdebug[39m: [37mQuery completed in 11ms, returned 3 rows[39m
2025-05-20 11:15:51:1551 [37mdebug[39m: [37mQuery completed in 10ms, returned 2 rows[39m
2025-05-20 11:15:51:1551 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:15:51:1551 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:15:51:1551 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:15:51:1551 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:15:51:1551 [37mdebug[39m: [37mQuery completed in 0ms, returned 2 rows[39m
2025-05-20 11:15:51:1551 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 11:15:53:1553 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT * FROM appointments WHERE appointment_id = $1 AND patient_id = $2[39m
[37m      [39m
2025-05-20 11:15:53:1553 [37mdebug[39m: [37mQuery params: ["3",13][39m
2025-05-20 11:15:53:1553 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:15:53:1553 [37mdebug[39m: [37mExecuting query: [39m
[37m      UPDATE appointments[39m
[37m      SET [39m
[37m        status = 'cancelled',[39m
[37m        cancellation_reason = $1,[39m
[37m        updated_at = NOW()[39m
[37m      WHERE appointment_id = $2[39m
[37m      RETURNING [39m
[37m        appointment_id as id,[39m
[37m        patient_id as "patientId",[39m
[37m        doctor_id as "doctorId",[39m
[37m        appointment_datetime as "appointmentDateTime",[39m
[37m        end_datetime as "endDateTime",[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        notes,[39m
[37m        cancellation_reason as "cancellationReason",[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-20 11:15:53:1553 [37mdebug[39m: [37mQuery params: ["User cancelled","3"][39m
2025-05-20 11:15:53:1553 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-20 11:15:54:1554 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:15:54:1554 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:15:54:1554 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:15:54:1554 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:15:54:1554 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-20 11:15:54:1554 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 11:15:54:1554 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:15:54:1554 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:15:54:1554 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:15:54:1554 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:15:54:1554 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:15:54:1554 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-20 11:16:04:164 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:16:04:164 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:16:04:164 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-20 11:18:32:1832 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:18:32:1832 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:18:32:1832 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:18:32:1832 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:18:32:1832 [37mdebug[39m: [37mQuery completed in 3ms, returned 2 rows[39m
2025-05-20 11:18:32:1832 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-20 11:18:32:1832 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:18:32:1832 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:18:32:1832 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:18:32:1832 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:18:32:1832 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-20 11:18:32:1832 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-20 11:18:45:1845 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:18:45:1845 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:18:45:1845 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:18:45:1845 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:18:45:1845 [37mdebug[39m: [37mQuery completed in 6ms, returned 2 rows[39m
2025-05-20 11:18:45:1845 [37mdebug[39m: [37mQuery completed in 7ms, returned 3 rows[39m
2025-05-20 11:18:45:1845 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:18:45:1845 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:18:45:1845 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:18:45:1845 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:18:45:1845 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:18:45:1845 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 11:18:57:1857 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:18:57:1857 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:18:57:1857 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:18:57:1857 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:18:57:1857 [37mdebug[39m: [37mQuery completed in 5ms, returned 2 rows[39m
2025-05-20 11:18:57:1857 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-20 11:18:57:1857 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:18:57:1857 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:18:57:1857 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:18:57:1857 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:18:57:1857 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-20 11:18:57:1857 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:20:04:204 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:20:04:204 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:20:04:204 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:20:04:204 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:20:04:204 [37mdebug[39m: [37mQuery completed in 318ms, returned 2 rows[39m
2025-05-20 11:20:04:204 [37mdebug[39m: [37mQuery completed in 324ms, returned 3 rows[39m
2025-05-20 11:20:04:204 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:20:04:204 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:20:04:204 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:20:04:204 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:20:04:204 [37mdebug[39m: [37mQuery completed in 4ms, returned 2 rows[39m
2025-05-20 11:20:04:204 [37mdebug[39m: [37mQuery completed in 8ms, returned 3 rows[39m
2025-05-20 11:21:23:2123 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:21:23:2123 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:21:23:2123 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:21:23:2123 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:21:24:2124 [37mdebug[39m: [37mQuery completed in 270ms, returned 2 rows[39m
2025-05-20 11:21:24:2124 [37mdebug[39m: [37mQuery completed in 272ms, returned 3 rows[39m
2025-05-20 11:21:24:2124 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:21:24:2124 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:21:24:2124 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:21:24:2124 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:21:24:2124 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 11:21:24:2124 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-20 11:21:39:2139 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 11:21:40:2140 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 11:21:40:2140 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 11:21:40:2140 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 11:21:40:2140 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 11:21:48:2148 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 11:21:48:2148 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-20 11:21:48:2148 [37mdebug[39m: [37mQuery completed in 20ms, returned 1 rows[39m
2025-05-20 11:21:48:2148 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:21:48:2148 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:21:48:2148 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery completed in 44ms, returned 6 rows[39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery completed in 22ms, returned 6 rows[39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery completed in 43ms, returned 9 rows[39m
2025-05-20 11:21:49:2149 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery completed in 16ms, returned 9 rows[39m
2025-05-20 11:21:49:2149 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-20 11:21:49:2149 [37mdebug[39m: [37mQuery completed in 10ms, returned 1 rows[39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mQuery completed in 4ms, returned 2 rows[39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mQuery completed in 7ms, returned 3 rows[39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mQuery completed in 3ms, returned 2 rows[39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mQuery completed in 0ms, returned 1 rows[39m
2025-05-20 11:21:54:2154 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          a.appointment_id as id,[39m
[37m          a.patient_id as "patientId",[39m
[37m          a.doctor_id as "doctorId",[39m
[37m          a.appointment_datetime as "appointmentDateTime",[39m
[37m          a.end_datetime as "endDateTime",[39m
[37m          a.status,[39m
[37m          a.type,[39m
[37m          a.reason,[39m
[37m          a.symptoms,[39m
[37m          a.notes,[39m
[37m          a.cancellation_reason as "cancellationReason",[39m
[37m          a.created_at as "createdAt",[39m
[37m          a.updated_at as "updatedAt",[39m
[37m          d.department_id as "departmentId",[39m
[37m          dep.name as "departmentName",[39m
[37m          u.first_name as "doctorFirstName",[39m
[37m          u.last_name as "doctorLastName",[39m
[37m          u.email as "doctorEmail",[39m
[37m          u.phone as "doctorPhone"[39m
[37m        FROM appointments a[39m
[37m        JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m        JOIN departments dep ON d.department_id = dep.department_id[39m
[37m        JOIN users u ON d.doctor_id = u.user_id[39m
[37m        WHERE a.appointment_id = $1 AND a.patient_id = $2[39m
[37m      [39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mQuery params: ["3",13][39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        mr.medical_record_id as id,[39m
[37m        mr.diagnosis,[39m
[37m        mr.prescription,[39m
[37m        mr.notes,[39m
[37m        mr.attachments,[39m
[37m        mr.created_at as "createdAt"[39m
[37m      FROM medical_records mr[39m
[37m      WHERE mr.appointment_id = $1[39m
[37m    [39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-20 11:21:56:2156 [31merror[39m: [31mQuery error: column mr.medical_record_id does not exist[39m
2025-05-20 11:21:56:2156 [31merror[39m: [31mError in getAppointmentById: column mr.medical_record_id does not exist[39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          a.appointment_id as id,[39m
[37m          a.patient_id as "patientId",[39m
[37m          a.doctor_id as "doctorId",[39m
[37m          a.appointment_datetime as "appointmentDateTime",[39m
[37m          a.end_datetime as "endDateTime",[39m
[37m          a.status,[39m
[37m          a.type,[39m
[37m          a.reason,[39m
[37m          a.symptoms,[39m
[37m          a.notes,[39m
[37m          a.cancellation_reason as "cancellationReason",[39m
[37m          a.created_at as "createdAt",[39m
[37m          a.updated_at as "updatedAt",[39m
[37m          d.department_id as "departmentId",[39m
[37m          dep.name as "departmentName",[39m
[37m          u.first_name as "doctorFirstName",[39m
[37m          u.last_name as "doctorLastName",[39m
[37m          u.email as "doctorEmail",[39m
[37m          u.phone as "doctorPhone"[39m
[37m        FROM appointments a[39m
[37m        JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m        JOIN departments dep ON d.department_id = dep.department_id[39m
[37m        JOIN users u ON d.doctor_id = u.user_id[39m
[37m        WHERE a.appointment_id = $1 AND a.patient_id = $2[39m
[37m      [39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mQuery params: ["3",13][39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        mr.medical_record_id as id,[39m
[37m        mr.diagnosis,[39m
[37m        mr.prescription,[39m
[37m        mr.notes,[39m
[37m        mr.attachments,[39m
[37m        mr.created_at as "createdAt"[39m
[37m      FROM medical_records mr[39m
[37m      WHERE mr.appointment_id = $1[39m
[37m    [39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:21:56:2156 [31merror[39m: [31mQuery error: column mr.medical_record_id does not exist[39m
2025-05-20 11:21:56:2156 [31merror[39m: [31mError in getAppointmentById: column mr.medical_record_id does not exist[39m
2025-05-20 11:21:56:2156 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mQuery completed in 6ms, returned 2 rows[39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 11:22:42:2242 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:22:52:2252 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT * FROM appointments WHERE appointment_id = $1 AND patient_id = $2[39m
[37m      [39m
2025-05-20 11:22:52:2252 [37mdebug[39m: [37mQuery params: ["3",13][39m
2025-05-20 11:22:52:2252 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:22:52:2252 [37mdebug[39m: [37mExecuting query: [39m
[37m      UPDATE appointments[39m
[37m      SET [39m
[37m        status = 'cancelled',[39m
[37m        cancellation_reason = $1,[39m
[37m        updated_at = NOW()[39m
[37m      WHERE appointment_id = $2[39m
[37m      RETURNING [39m
[37m        appointment_id as id,[39m
[37m        patient_id as "patientId",[39m
[37m        doctor_id as "doctorId",[39m
[37m        appointment_datetime as "appointmentDateTime",[39m
[37m        end_datetime as "endDateTime",[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        notes,[39m
[37m        cancellation_reason as "cancellationReason",[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-20 11:22:52:2252 [37mdebug[39m: [37mQuery params: ["No reason\n","3"][39m
2025-05-20 11:22:52:2252 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-20 11:22:53:2253 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:22:53:2253 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:22:53:2253 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-20 11:22:53:2253 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:22:53:2253 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:22:53:2253 [37mdebug[39m: [37mQuery completed in 3ms, returned 2 rows[39m
2025-05-20 11:22:53:2253 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:22:53:2253 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:22:53:2253 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:22:53:2253 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:22:53:2253 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:22:53:2253 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:24:49:2449 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:24:49:2449 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:24:49:2449 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:24:49:2449 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:24:49:2449 [37mdebug[39m: [37mQuery completed in 11ms, returned 2 rows[39m
2025-05-20 11:24:49:2449 [37mdebug[39m: [37mQuery completed in 11ms, returned 3 rows[39m
2025-05-20 11:24:49:2449 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:24:49:2449 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:24:49:2449 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:24:49:2449 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:24:49:2449 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 11:24:49:2449 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-20 11:26:03:263 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 11:26:04:264 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 11:26:04:264 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 11:26:04:264 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 11:26:04:264 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 11:29:48:2948 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 11:29:48:2948 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 11:29:48:2948 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 11:29:48:2948 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 11:29:48:2948 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 11:29:54:2954 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:29:54:2954 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:29:54:2954 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:29:54:2954 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:29:54:2954 [37mdebug[39m: [37mQuery completed in 16ms, returned 2 rows[39m
2025-05-20 11:29:54:2954 [37mdebug[39m: [37mQuery completed in 24ms, returned 3 rows[39m
2025-05-20 11:29:54:2954 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:29:54:2954 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:29:54:2954 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:29:54:2954 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:29:54:2954 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:29:54:2954 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery completed in 106ms, returned 1 rows[39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery completed in 47ms, returned 1 rows[39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery completed in 34ms, returned 6 rows[39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery completed in 16ms, returned 9 rows[39m
2025-05-20 11:30:02:302 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery completed in 11ms, returned 9 rows[39m
2025-05-20 11:30:02:302 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery completed in 4ms, returned 3 rows[39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 11:30:02:302 [37mdebug[39m: [37mQuery completed in 18ms, returned 1 rows[39m
2025-05-20 11:30:09:309 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:30:09:309 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:30:09:309 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:30:09:309 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:30:09:309 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-20 11:30:09:309 [37mdebug[39m: [37mQuery completed in 4ms, returned 2 rows[39m
2025-05-20 11:30:09:309 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:30:09:309 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:30:09:309 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:30:09:309 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:30:09:309 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 11:30:09:309 [37mdebug[39m: [37mQuery completed in 3ms, returned 2 rows[39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mQuery completed in 6ms, returned 6 rows[39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mQuery completed in 2ms, returned 6 rows[39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mQuery completed in 13ms, returned 9 rows[39m
2025-05-20 11:30:15:3015 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mQuery completed in 8ms, returned 9 rows[39m
2025-05-20 11:30:15:3015 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:30:15:3015 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-20 11:30:17:3017 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 11:30:17:3017 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:30:17:3017 [37mdebug[39m: [37mQuery completed in 7ms, returned 1 rows[39m
2025-05-20 11:30:17:3017 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 11:30:17:3017 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:30:17:3017 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:30:26:3026 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT COUNT(*) as count[39m
[37m      FROM appointments[39m
[37m      WHERE doctor_id = $1[39m
[37m        AND status NOT IN ('cancelled', 'no_show')[39m
[37m        AND ([39m
[37m          (appointment_datetime <= $2 AND end_datetime > $2)[39m
[37m          OR[39m
[37m          (appointment_datetime < $3 AND end_datetime >= $3)[39m
[37m          OR[39m
[37m          (appointment_datetime >= $2 AND end_datetime <= $3)[39m
[37m        )[39m
[37m    [39m
2025-05-20 11:30:26:3026 [37mdebug[39m: [37mQuery params: [3,"2025-05-24T10:00:00","2025-05-24T02:30:00.000Z"][39m
2025-05-20 11:30:26:3026 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-20 11:30:26:3026 [37mdebug[39m: [37mExecuting query: [39m
[37m      INSERT INTO appointments ([39m
[37m        patient_id,[39m
[37m        doctor_id,[39m
[37m        appointment_datetime,[39m
[37m        end_datetime,[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at,[39m
[37m        updated_at[39m
[37m      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, NOW(), NOW())[39m
[37m      RETURNING [39m
[37m        appointment_id as id,[39m
[37m        patient_id as "patientId",[39m
[37m        doctor_id as "doctorId",[39m
[37m        appointment_datetime as "appointmentDateTime",[39m
[37m        end_datetime as "endDateTime",[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-20 11:30:26:3026 [37mdebug[39m: [37mQuery params: [13,3,"2025-05-24T10:00:00","2025-05-24T02:30:00.000Z","scheduled","regular","Fever",["Fever"]][39m
2025-05-20 11:30:26:3026 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-20 11:30:26:3026 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone[39m
[37m      FROM doctors d[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE d.doctor_id = $1[39m
[37m    [39m
2025-05-20 11:30:26:3026 [37mdebug[39m: [37mQuery params: [3][39m
2025-05-20 11:30:26:3026 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:30:28:3028 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:30:28:3028 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:30:28:3028 [37mdebug[39m: [37mQuery completed in 11ms, returned 2 rows[39m
2025-05-20 11:30:28:3028 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:30:28:3028 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:30:28:3028 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-20 11:30:28:3028 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:30:28:3028 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:30:28:3028 [37mdebug[39m: [37mQuery completed in 23ms, returned 4 rows[39m
2025-05-20 11:30:28:3028 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:30:28:3028 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:30:28:3028 [37mdebug[39m: [37mQuery completed in 5ms, returned 4 rows[39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          a.appointment_id as id,[39m
[37m          a.patient_id as "patientId",[39m
[37m          a.doctor_id as "doctorId",[39m
[37m          a.appointment_datetime as "appointmentDateTime",[39m
[37m          a.end_datetime as "endDateTime",[39m
[37m          a.status,[39m
[37m          a.type,[39m
[37m          a.reason,[39m
[37m          a.symptoms,[39m
[37m          a.notes,[39m
[37m          a.cancellation_reason as "cancellationReason",[39m
[37m          a.created_at as "createdAt",[39m
[37m          a.updated_at as "updatedAt",[39m
[37m          d.department_id as "departmentId",[39m
[37m          dep.name as "departmentName",[39m
[37m          u.first_name as "doctorFirstName",[39m
[37m          u.last_name as "doctorLastName",[39m
[37m          u.email as "doctorEmail",[39m
[37m          u.phone as "doctorPhone"[39m
[37m        FROM appointments a[39m
[37m        JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m        JOIN departments dep ON d.department_id = dep.department_id[39m
[37m        JOIN users u ON d.doctor_id = u.user_id[39m
[37m        WHERE a.appointment_id = $1 AND a.patient_id = $2[39m
[37m      [39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mQuery params: ["10",13][39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        mr.record_id as id,[39m
[37m        mr.diagnosis,[39m
[37m        mr.prescription,[39m
[37m        mr.notes,[39m
[37m        mr.attachments,[39m
[37m        mr.created_at as "createdAt"[39m
[37m      FROM medical_records mr[39m
[37m      WHERE mr.appointment_id = $1[39m
[37m    [39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 11:30:33:3033 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-20 11:30:33:3033 [31merror[39m: [31mError in getAppointmentById: column mr.attachments does not exist[39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          a.appointment_id as id,[39m
[37m          a.patient_id as "patientId",[39m
[37m          a.doctor_id as "doctorId",[39m
[37m          a.appointment_datetime as "appointmentDateTime",[39m
[37m          a.end_datetime as "endDateTime",[39m
[37m          a.status,[39m
[37m          a.type,[39m
[37m          a.reason,[39m
[37m          a.symptoms,[39m
[37m          a.notes,[39m
[37m          a.cancellation_reason as "cancellationReason",[39m
[37m          a.created_at as "createdAt",[39m
[37m          a.updated_at as "updatedAt",[39m
[37m          d.department_id as "departmentId",[39m
[37m          dep.name as "departmentName",[39m
[37m          u.first_name as "doctorFirstName",[39m
[37m          u.last_name as "doctorLastName",[39m
[37m          u.email as "doctorEmail",[39m
[37m          u.phone as "doctorPhone"[39m
[37m        FROM appointments a[39m
[37m        JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m        JOIN departments dep ON d.department_id = dep.department_id[39m
[37m        JOIN users u ON d.doctor_id = u.user_id[39m
[37m        WHERE a.appointment_id = $1 AND a.patient_id = $2[39m
[37m      [39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mQuery params: ["10",13][39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        mr.record_id as id,[39m
[37m        mr.diagnosis,[39m
[37m        mr.prescription,[39m
[37m        mr.notes,[39m
[37m        mr.attachments,[39m
[37m        mr.created_at as "createdAt"[39m
[37m      FROM medical_records mr[39m
[37m      WHERE mr.appointment_id = $1[39m
[37m    [39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:30:33:3033 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-20 11:30:33:3033 [31merror[39m: [31mQuery error: column mr.attachments does not exist[39m
2025-05-20 11:30:33:3033 [31merror[39m: [31mError in getAppointmentById: column mr.attachments does not exist[39m
2025-05-20 11:31:08:318 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 11:31:08:318 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 11:31:08:318 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 11:31:08:318 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 11:31:08:318 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 11:31:26:3126 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:31:26:3126 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:31:26:3126 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:31:26:3126 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:31:26:3126 [37mdebug[39m: [37mQuery completed in 9ms, returned 2 rows[39m
2025-05-20 11:31:26:3126 [37mdebug[39m: [37mQuery completed in 11ms, returned 4 rows[39m
2025-05-20 11:31:26:3126 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:31:26:3126 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:31:26:3126 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:31:26:3126 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:31:26:3126 [37mdebug[39m: [37mQuery completed in 2ms, returned 2 rows[39m
2025-05-20 11:31:26:3126 [37mdebug[39m: [37mQuery completed in 3ms, returned 4 rows[39m
2025-05-20 11:31:47:3147 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT * FROM appointments WHERE appointment_id = $1 AND patient_id = $2[39m
[37m      [39m
2025-05-20 11:31:47:3147 [37mdebug[39m: [37mQuery params: ["10",13][39m
2025-05-20 11:31:47:3147 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:31:47:3147 [37mdebug[39m: [37mExecuting query: [39m
[37m      UPDATE appointments[39m
[37m      SET [39m
[37m        status = 'cancelled',[39m
[37m        cancellation_reason = $1,[39m
[37m        cancelled_by = $3,[39m
[37m        updated_at = NOW()[39m
[37m      WHERE appointment_id = $2[39m
[37m      RETURNING [39m
[37m        appointment_id as id,[39m
[37m        patient_id as "patientId",[39m
[37m        doctor_id as "doctorId",[39m
[37m        appointment_datetime as "appointmentDateTime",[39m
[37m        end_datetime as "endDateTime",[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        notes,[39m
[37m        cancellation_reason as "cancellationReason",[39m
[37m        cancelled_by as "cancelledBy",[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-20 11:31:47:3147 [37mdebug[39m: [37mQuery params: ["no reason\n","10",13][39m
2025-05-20 11:31:47:3147 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-20 11:31:48:3148 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:31:48:3148 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:31:48:3148 [37mdebug[39m: [37mQuery completed in 4ms, returned 4 rows[39m
2025-05-20 11:31:48:3148 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:31:48:3148 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:31:48:3148 [37mdebug[39m: [37mQuery completed in 4ms, returned 2 rows[39m
2025-05-20 11:31:48:3148 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:31:48:3148 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:31:48:3148 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:31:48:3148 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:31:48:3148 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 11:31:48:3148 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:34:02:342 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:34:02:342 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:34:02:342 [37mdebug[39m: [37mQuery completed in 8ms, returned 2 rows[39m
2025-05-20 11:34:02:342 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:34:02:342 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:34:02:342 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-20 11:34:03:343 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:34:03:343 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:34:03:343 [37mdebug[39m: [37mQuery completed in 3ms, returned 2 rows[39m
2025-05-20 11:34:03:343 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:34:03:343 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:34:03:343 [37mdebug[39m: [37mQuery completed in 1ms, returned 2 rows[39m
2025-05-20 11:34:03:343 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:34:03:343 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:34:03:343 [37mdebug[39m: [37mQuery completed in 9ms, returned 4 rows[39m
2025-05-20 11:34:03:343 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:34:03:343 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:34:03:343 [37mdebug[39m: [37mQuery completed in 2ms, returned 4 rows[39m
2025-05-20 11:39:19:3919 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 11:39:20:3920 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 11:39:20:3920 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 11:39:20:3920 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 11:39:20:3920 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 11:51:39:5139 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 11:51:39:5139 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 11:51:39:5139 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 11:51:39:5139 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 11:51:39:5139 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 11:52:02:522 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 11:52:02:522 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-20 11:52:02:522 [37mdebug[39m: [37mQuery completed in 20ms, returned 1 rows[39m
2025-05-20 11:52:02:522 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:52:02:522 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:52:02:522 [37mdebug[39m: [37mQuery completed in 14ms, returned 1 rows[39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery completed in 26ms, returned 6 rows[39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery completed in 19ms, returned 9 rows[39m
2025-05-20 11:52:03:523 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery completed in 19ms, returned 9 rows[39m
2025-05-20 11:52:03:523 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery completed in 7ms, returned 4 rows[39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery completed in 5ms, returned 4 rows[39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:52:03:523 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mQuery completed in 8ms, returned 4 rows[39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mQuery completed in 2ms, returned 4 rows[39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mQuery completed in 35ms, returned 2 rows[39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mQuery completed in 2ms, returned 2 rows[39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-20 11:52:07:527 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          a.appointment_id as id,[39m
[37m          a.patient_id as "patientId",[39m
[37m          a.doctor_id as "doctorId",[39m
[37m          a.appointment_datetime as "appointmentDateTime",[39m
[37m          a.end_datetime as "endDateTime",[39m
[37m          a.status,[39m
[37m          a.type,[39m
[37m          a.reason,[39m
[37m          a.symptoms,[39m
[37m          a.notes,[39m
[37m          a.cancellation_reason as "cancellationReason",[39m
[37m          a.created_at as "createdAt",[39m
[37m          a.updated_at as "updatedAt",[39m
[37m          d.department_id as "departmentId",[39m
[37m          dep.name as "departmentName",[39m
[37m          u.first_name as "doctorFirstName",[39m
[37m          u.last_name as "doctorLastName",[39m
[37m          u.email as "doctorEmail",[39m
[37m          u.phone as "doctorPhone"[39m
[37m        FROM appointments a[39m
[37m        JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m        JOIN departments dep ON d.department_id = dep.department_id[39m
[37m        JOIN users u ON d.doctor_id = u.user_id[39m
[37m        WHERE a.appointment_id = $1 AND a.patient_id = $2[39m
[37m      [39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mQuery params: ["3",13][39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        mr.record_id as id,[39m
[37m        mr.diagnosis,[39m
[37m        mr.prescription,[39m
[37m        mr.notes,[39m
[37m        mr.created_at as "createdAt"[39m
[37m      FROM medical_records mr[39m
[37m      WHERE mr.appointment_id = $1[39m
[37m    [39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mQuery completed in 12ms, returned 1 rows[39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mQuery completed in 3ms, returned 0 rows[39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active' AND d.doctor_id = $1[39m
[37m      LIMIT 1[39m
[37m    [39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          a.appointment_id as id,[39m
[37m          a.patient_id as "patientId",[39m
[37m          a.doctor_id as "doctorId",[39m
[37m          a.appointment_datetime as "appointmentDateTime",[39m
[37m          a.end_datetime as "endDateTime",[39m
[37m          a.status,[39m
[37m          a.type,[39m
[37m          a.reason,[39m
[37m          a.symptoms,[39m
[37m          a.notes,[39m
[37m          a.cancellation_reason as "cancellationReason",[39m
[37m          a.created_at as "createdAt",[39m
[37m          a.updated_at as "updatedAt",[39m
[37m          d.department_id as "departmentId",[39m
[37m          dep.name as "departmentName",[39m
[37m          u.first_name as "doctorFirstName",[39m
[37m          u.last_name as "doctorLastName",[39m
[37m          u.email as "doctorEmail",[39m
[37m          u.phone as "doctorPhone"[39m
[37m        FROM appointments a[39m
[37m        JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m        JOIN departments dep ON d.department_id = dep.department_id[39m
[37m        JOIN users u ON d.doctor_id = u.user_id[39m
[37m        WHERE a.appointment_id = $1 AND a.patient_id = $2[39m
[37m      [39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mQuery params: ["3",13][39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        mr.record_id as id,[39m
[37m        mr.diagnosis,[39m
[37m        mr.prescription,[39m
[37m        mr.notes,[39m
[37m        mr.created_at as "createdAt"[39m
[37m      FROM medical_records mr[39m
[37m      WHERE mr.appointment_id = $1[39m
[37m    [39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:52:13:5213 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-20 11:56:17:5617 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT * FROM appointments WHERE appointment_id = $1 AND patient_id = $2[39m
[37m      [39m
2025-05-20 11:56:17:5617 [37mdebug[39m: [37mQuery params: ["3",13][39m
2025-05-20 11:56:17:5617 [37mdebug[39m: [37mQuery completed in 8ms, returned 1 rows[39m
2025-05-20 11:56:17:5617 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT COUNT(*) as count[39m
[37m      FROM appointments[39m
[37m      WHERE doctor_id = $1[39m
[37m        AND appointment_id != $2[39m
[37m        AND status NOT IN ('cancelled', 'no_show')[39m
[37m        AND ([39m
[37m          (appointment_datetime <= $3 AND end_datetime > $3)[39m
[37m          OR[39m
[37m          (appointment_datetime < $4 AND end_datetime >= $4)[39m
[37m          OR[39m
[37m          (appointment_datetime >= $3 AND end_datetime <= $4)[39m
[37m        )[39m
[37m    [39m
2025-05-20 11:56:17:5617 [37mdebug[39m: [37mQuery params: [10,"3","2025-05-22T13:30:00","2025-05-22T06:00:00.000Z"][39m
2025-05-20 11:56:17:5617 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 11:56:17:5617 [37mdebug[39m: [37mExecuting query: [39m
[37m      UPDATE appointments[39m
[37m      SET [39m
[37m        appointment_datetime = $1,[39m
[37m        end_datetime = $2,[39m
[37m        status = 'scheduled',[39m
[37m        updated_at = NOW()[39m
[37m      WHERE appointment_id = $3[39m
[37m      RETURNING [39m
[37m        appointment_id as id,[39m
[37m        patient_id as "patientId",[39m
[37m        doctor_id as "doctorId",[39m
[37m        appointment_datetime as "appointmentDateTime",[39m
[37m        end_datetime as "endDateTime",[39m
[37m        status,[39m
[37m        type,[39m
[37m        reason,[39m
[37m        symptoms,[39m
[37m        notes,[39m
[37m        cancellation_reason as "cancellationReason",[39m
[37m        created_at as "createdAt",[39m
[37m        updated_at as "updatedAt"[39m
[37m    [39m
2025-05-20 11:56:17:5617 [37mdebug[39m: [37mQuery params: ["2025-05-22T13:30:00","2025-05-22T06:00:00.000Z","3"][39m
2025-05-20 11:56:17:5617 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mQuery completed in 8ms, returned 2 rows[39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mQuery completed in 19ms, returned 4 rows[39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mQuery completed in 2ms, returned 2 rows[39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mQuery completed in 3ms, returned 4 rows[39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:56:19:5619 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 11:56:43:5643 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          mr.record_id as id,[39m
[37m          mr.patient_id as "patientId",[39m
[37m          mr.doctor_id as "doctorId",[39m
[37m          mr.appointment_id as "appointmentId",[39m
[37m          mr.diagnosis,[39m
[37m          mr.prescription,[39m
[37m          mr.notes,[39m
[37m          mr.created_at as "createdAt",[39m
[37m          mr.updated_at as "updatedAt",[39m
[37m          d.first_name as "doctorFirstName",[39m
[37m          d.last_name as "doctorLastName"[39m
[37m        FROM medical_records mr[39m
[37m        JOIN users d ON mr.doctor_id = d.user_id[39m
[37m        WHERE mr.patient_id = $1[39m
[37m        ORDER BY mr.created_at DESC[39m
[37m      [39m
2025-05-20 11:56:43:5643 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 11:56:43:5643 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 11:56:43:5643 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 11:56:43:5643 [37mdebug[39m: [37mQuery completed in 4ms, returned 2 rows[39m
2025-05-20 11:56:43:5643 [37mdebug[39m: [37mQuery completed in 9ms, returned 4 rows[39m
2025-05-20 11:56:43:5643 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:56:43:5643 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 11:56:43:5643 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 11:56:43:5643 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 11:56:43:5643 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 11:56:43:5643 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery completed in 27ms, returned 6 rows[39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery completed in 10ms, returned 6 rows[39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery completed in 36ms, returned 9 rows[39m
2025-05-20 12:41:46:4146 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery completed in 6ms, returned 9 rows[39m
2025-05-20 12:41:46:4146 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery completed in 11ms, returned 4 rows[39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery completed in 1ms, returned 4 rows[39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 12:41:46:4146 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-20 12:42:03:423 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 12:42:03:423 [37mdebug[39m: [37mQuery params: ["robert.johnson@healthclinic.com"][39m
2025-05-20 12:42:03:423 [37mdebug[39m: [37mQuery completed in 35ms, returned 1 rows[39m
2025-05-20 12:42:03:423 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 12:42:03:423 [37mdebug[39m: [37mQuery params: [12][39m
2025-05-20 12:42:03:423 [37mdebug[39m: [37mQuery completed in 23ms, returned 1 rows[39m
2025-05-20 14:13:28:1328 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 14:13:29:1329 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 14:13:29:1329 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 14:13:29:1329 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 14:13:29:1329 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 14:13:32:1332 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 14:13:32:1332 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 14:13:32:1332 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 14:13:32:1332 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 14:13:32:1332 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 14:14:24:1424 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 14:14:25:1425 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 14:14:25:1425 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 14:14:25:1425 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 14:14:25:1425 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 14:14:36:1436 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 14:14:37:1437 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 14:14:37:1437 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 14:14:37:1437 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 14:14:37:1437 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 14:14:41:1441 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 14:14:41:1441 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 14:14:41:1441 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 14:14:41:1441 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 14:14:41:1441 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 14:43:13:4313 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 14:43:13:4313 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 14:43:13:4313 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 14:43:13:4313 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 14:43:13:4313 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 14:43:16:4316 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 14:43:16:4316 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 14:43:16:4316 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 14:43:16:4316 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 14:43:16:4316 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 14:43:40:4340 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 14:43:41:4341 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 14:43:41:4341 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 14:43:41:4341 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-20 14:43:41:4341 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 14:43:41:4341 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 15:11:30:1130 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 15:11:30:1130 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 15:11:30:1130 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 15:11:30:1130 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-20 15:11:30:1130 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 15:11:30:1130 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 15:11:49:1149 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 15:11:49:1149 [37mdebug[39m: [37mQuery params: ["john.doe@example.com"][39m
2025-05-20 15:11:49:1149 [37mdebug[39m: [37mQuery completed in 28ms, returned 1 rows[39m
2025-05-20 15:11:49:1149 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 15:11:49:1149 [37mdebug[39m: [37mQuery params: [13][39m
2025-05-20 15:11:49:1149 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery completed in 19ms, returned 6 rows[39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.department_id as id, [39m
[37m        d.name, [39m
[37m        d.description, [39m
[37m        d.emoji_icon as "emojiIcon",[39m
[37m        (SELECT COUNT(*) FROM doctors WHERE department_id = d.department_id) as "doctorCount"[39m
[37m      FROM departments d[39m
[37m      ORDER BY d.name[39m
[37m    [39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery completed in 1ms, returned 6 rows[39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery completed in 37ms, returned 9 rows[39m
2025-05-20 15:11:50:1150 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        d.doctor_id as id,[39m
[37m        d.doctor_id as "userId",[39m
[37m        d.department_id as "departmentId",[39m
[37m        d.specialty as "specialty",[39m
[37m        d.qualification as "qualifications",[39m
[37m        d.experience as "experienceYears",[39m
[37m        d.consultation_fee as "consultationFee",[39m
[37m        d.bio as about,[39m
[37m        u.first_name as "firstName",[39m
[37m        u.last_name as "lastName",[39m
[37m        u.email,[39m
[37m        u.phone,[39m
[37m        u.profile_image_blob as "profilePicture",[39m
[37m        dep.name as "departmentName",[39m
[37m        COALESCE(r.avg_rating, 0) as "averageRating",[39m
[37m        COALESCE(r.review_count, 0) as "reviewCount"[39m
[37m      FROM doctors d[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      LEFT JOIN ([39m
[37m        SELECT [39m
[37m          doctor_id, [39m
[37m          AVG(rating) as avg_rating, [39m
[37m          COUNT(*) as review_count [39m
[37m        FROM reviews [39m
[37m        WHERE status = 'approved' [39m
[37m        GROUP BY doctor_id[39m
[37m      ) r ON d.doctor_id = r.doctor_id[39m
[37m      WHERE u.status = 'active'[39m
[37m     [39m
[37m      ORDER BY r.avg_rating DESC NULLS LAST[39m
[37m      LIMIT $1 OFFSET $2[39m
[37m    [39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery params: [10,0][39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery completed in 20ms, returned 9 rows[39m
2025-05-20 15:11:50:1150 [32minfo[39m: [32mRetrieved 9 doctors[39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery completed in 5ms, returned 4 rows[39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        d.department_id as "departmentId",[39m
[37m        dep.name as "departmentName",[39m
[37m        u.first_name as "doctorFirstName",[39m
[37m        u.last_name as "doctorLastName",[39m
[37m        u.email as "doctorEmail",[39m
[37m        u.phone as "doctorPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN doctors d ON a.doctor_id = d.doctor_id[39m
[37m      JOIN departments dep ON d.department_id = dep.department_id[39m
[37m      JOIN users u ON d.doctor_id = u.user_id[39m
[37m      WHERE a.patient_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery params: [13,10,0][39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery completed in 2ms, returned 4 rows[39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery params: ["6"][39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery completed in 3ms, returned 1 rows[39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery params: ["10"][39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery params: ["7"][39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT profile_image_blob[39m
[37m        FROM users[39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery params: ["3"][39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 15:11:50:1150 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-20 15:12:04:124 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 15:12:04:124 [37mdebug[39m: [37mQuery params: ["robert.johnson@healthclinic.com"][39m
2025-05-20 15:12:04:124 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-20 15:12:04:124 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 15:12:04:124 [37mdebug[39m: [37mQuery params: [12][39m
2025-05-20 15:12:04:124 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-20 17:02:14:214 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 17:02:14:214 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 17:02:14:214 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 17:02:14:214 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-20 17:02:14:214 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 17:02:14:214 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 17:02:18:218 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:02:18:218 [37mdebug[39m: [37mQuery params: [12,10,0][39m
2025-05-20 17:02:18:218 [37mdebug[39m: [37mQuery completed in 44ms, returned 0 rows[39m
2025-05-20 17:02:30:230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:02:30:230 [37mdebug[39m: [37mQuery params: [12,10,0][39m
2025-05-20 17:02:30:230 [37mdebug[39m: [37mQuery completed in 8ms, returned 0 rows[39m
2025-05-20 17:02:30:230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:02:30:230 [37mdebug[39m: [37mQuery params: [12,10,0][39m
2025-05-20 17:02:30:230 [37mdebug[39m: [37mQuery completed in 8ms, returned 0 rows[39m
2025-05-20 17:03:49:349 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 17:03:49:349 [37mdebug[39m: [37mQuery params: ["john.smith@healthclinic.com"][39m
2025-05-20 17:03:49:349 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-20 17:03:50:350 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 17:03:50:350 [37mdebug[39m: [37mQuery params: [3][39m
2025-05-20 17:03:50:350 [37mdebug[39m: [37mQuery completed in 20ms, returned 1 rows[39m
2025-05-20 17:03:54:354 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:03:54:354 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:03:54:354 [37mdebug[39m: [37mQuery completed in 8ms, returned 3 rows[39m
2025-05-20 17:03:54:354 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:03:54:354 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:03:54:354 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-20 17:04:11:411 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:04:11:411 [37mdebug[39m: [37mQuery params: [3,"%n%",10,0][39m
2025-05-20 17:04:11:411 [37mdebug[39m: [37mQuery completed in 21ms, returned 3 rows[39m
2025-05-20 17:04:12:412 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:04:12:412 [37mdebug[39m: [37mQuery params: [3,"%nd%",10,0][39m
2025-05-20 17:04:12:412 [37mdebug[39m: [37mQuery completed in 6ms, returned 0 rows[39m
2025-05-20 17:04:19:419 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.status = 'completed' AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:04:19:419 [37mdebug[39m: [37mQuery params: [3,"%nd%",10,0][39m
2025-05-20 17:04:19:419 [37mdebug[39m: [37mQuery completed in 6ms, returned 0 rows[39m
2025-05-20 17:04:22:422 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.status = 'no_show' AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:04:22:422 [37mdebug[39m: [37mQuery params: [3,"%nd%",10,0][39m
2025-05-20 17:04:22:422 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-20 17:04:24:424 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:04:24:424 [37mdebug[39m: [37mQuery params: [3,"%nd%",10,0][39m
2025-05-20 17:04:24:424 [37mdebug[39m: [37mQuery completed in 15ms, returned 0 rows[39m
2025-05-20 17:04:26:426 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.status = 'completed' AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:04:26:426 [37mdebug[39m: [37mQuery params: [3,"%nd%",10,0][39m
2025-05-20 17:04:26:426 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-20 17:04:28:428 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.status = 'scheduled' AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:04:28:428 [37mdebug[39m: [37mQuery params: [3,"%nd%",10,0][39m
2025-05-20 17:04:28:428 [37mdebug[39m: [37mQuery completed in 13ms, returned 0 rows[39m
2025-05-20 17:05:16:516 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:05:16:516 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:05:16:516 [37mdebug[39m: [37mQuery completed in 24ms, returned 3 rows[39m
2025-05-20 17:07:02:72 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:07:02:72 [37mdebug[39m: [37mQuery params: [3,"%d%",10,0][39m
2025-05-20 17:07:02:72 [37mdebug[39m: [37mQuery completed in 8ms, returned 3 rows[39m
2025-05-20 17:07:04:74 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:07:04:74 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:07:04:74 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:07:05:75 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:07:05:75 [37mdebug[39m: [37mQuery params: [3,"%d%",10,0][39m
2025-05-20 17:07:05:75 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 17:07:07:77 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:07:07:77 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:07:07:77 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 17:07:12:712 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.status = 'completed'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:07:12:712 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:07:12:712 [37mdebug[39m: [37mQuery completed in 2ms, returned 2 rows[39m
2025-05-20 17:07:14:714 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.status = 'cancelled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:07:14:714 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:07:14:714 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 17:07:16:716 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:07:16:716 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:07:16:716 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-20 17:07:18:718 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:07:18:718 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:07:18:718 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:07:52:752 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:07:52:752 [37mdebug[39m: [37mQuery params: [3,"regular",10,0][39m
2025-05-20 17:07:52:752 [37mdebug[39m: [37mQuery completed in 6ms, returned 1 rows[39m
2025-05-20 17:07:54:754 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:07:54:754 [37mdebug[39m: [37mQuery params: [3,"all",10,0][39m
2025-05-20 17:07:54:754 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-20 17:08:35:835 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:08:35:835 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:08:35:835 [37mdebug[39m: [37mQuery completed in 7ms, returned 3 rows[39m
2025-05-20 17:08:37:837 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:08:37:837 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:08:37:837 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-20 17:08:38:838 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:08:38:838 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:08:38:838 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:08:48:848 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:08:48:848 [37mdebug[39m: [37mQuery params: [3,"0002-05-24",10,0][39m
2025-05-20 17:08:48:848 [37mdebug[39m: [37mQuery completed in 8ms, returned 3 rows[39m
2025-05-20 17:08:50:850 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:08:50:850 [37mdebug[39m: [37mQuery params: [3,"0020-05-24",10,0][39m
2025-05-20 17:08:50:850 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:08:52:852 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:08:52:852 [37mdebug[39m: [37mQuery params: [3,"0002-05-24",10,0][39m
2025-05-20 17:08:52:852 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 17:08:54:854 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:08:54:854 [37mdebug[39m: [37mQuery params: [3,"0020-05-24",10,0][39m
2025-05-20 17:08:54:854 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 17:08:56:856 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:08:56:856 [37mdebug[39m: [37mQuery params: [3,"0002-05-24",10,0][39m
2025-05-20 17:08:56:856 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:09:30:930 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:09:30:930 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:09:30:930 [37mdebug[39m: [37mQuery completed in 7ms, returned 3 rows[39m
2025-05-20 17:09:37:937 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:09:37:937 [37mdebug[39m: [37mQuery params: [3,"%d%",10,0][39m
2025-05-20 17:09:37:937 [37mdebug[39m: [37mQuery completed in 12ms, returned 3 rows[39m
2025-05-20 17:09:38:938 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:09:38:938 [37mdebug[39m: [37mQuery params: [3,"%dd%",10,0][39m
2025-05-20 17:09:38:938 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-20 17:09:40:940 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:09:40:940 [37mdebug[39m: [37mQuery params: [3,"%ddd%",10,0][39m
2025-05-20 17:09:40:940 [37mdebug[39m: [37mQuery completed in 4ms, returned 0 rows[39m
2025-05-20 17:09:41:941 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:09:41:941 [37mdebug[39m: [37mQuery params: [3,"%dddd%",10,0][39m
2025-05-20 17:09:41:941 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-20 17:09:58:958 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:09:58:958 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:09:58:958 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-20 17:09:58:958 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:09:58:958 [37mdebug[39m: [37mQuery params: [3,"%d%",10,0][39m
2025-05-20 17:09:58:958 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:11:38:1138 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:11:38:1138 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:11:38:1138 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-20 17:11:43:1143 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:11:43:1143 [37mdebug[39m: [37mQuery params: [3,"0002-03-03",10,0][39m
2025-05-20 17:11:43:1143 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:11:48:1148 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:11:48:1148 [37mdebug[39m: [37mQuery params: [3,"0002-03-14",10,0][39m
2025-05-20 17:11:48:1148 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-20 17:11:53:1153 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:11:53:1153 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:11:53:1153 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-20 17:12:01:121 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:12:01:121 [37mdebug[39m: [37mQuery params: [3,"0002-05-24",10,0][39m
2025-05-20 17:12:01:121 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:12:03:123 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:12:03:123 [37mdebug[39m: [37mQuery params: [3,"0020-05-24",10,0][39m
2025-05-20 17:12:03:123 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 17:12:05:125 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:12:05:125 [37mdebug[39m: [37mQuery params: [3,"0002-05-24",10,0][39m
2025-05-20 17:12:05:125 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:12:06:126 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:12:06:126 [37mdebug[39m: [37mQuery params: [3,"0003-05-24",10,0][39m
2025-05-20 17:12:06:126 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:12:10:1210 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:12:10:1210 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:12:10:1210 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:12:16:1216 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:12:16:1216 [37mdebug[39m: [37mQuery params: [3,"2025-05-02",10,0][39m
2025-05-20 17:12:16:1216 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 17:12:18:1218 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:12:18:1218 [37mdebug[39m: [37mQuery params: [3,"2025-05-24",10,0][39m
2025-05-20 17:12:18:1218 [37mdebug[39m: [37mQuery completed in 1ms, returned 1 rows[39m
2025-05-20 17:12:30:1230 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:12:30:1230 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:12:30:1230 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-20 17:12:38:1238 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:12:38:1238 [37mdebug[39m: [37mQuery params: [3,"follow_up",10,0][39m
2025-05-20 17:12:38:1238 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 17:12:40:1240 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:12:40:1240 [37mdebug[39m: [37mQuery params: [3,"all",10,0][39m
2025-05-20 17:12:40:1240 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-20 17:15:30:1530 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:15:30:1530 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:15:30:1530 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-20 17:15:32:1532 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:15:32:1532 [37mdebug[39m: [37mQuery params: [3,"regular",10,0][39m
2025-05-20 17:15:32:1532 [37mdebug[39m: [37mQuery completed in 4ms, returned 1 rows[39m
2025-05-20 17:15:33:1533 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:15:33:1533 [37mdebug[39m: [37mQuery params: [3,"all",10,0][39m
2025-05-20 17:15:33:1533 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-20 17:15:38:1538 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:15:38:1538 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:15:38:1538 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 17:15:55:1555 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.status = 'scheduled'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:15:55:1555 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:15:55:1555 [37mdebug[39m: [37mQuery completed in 5ms, returned 0 rows[39m
2025-05-20 17:15:57:1557 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.status = 'completed'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:15:57:1557 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:15:57:1557 [37mdebug[39m: [37mQuery completed in 4ms, returned 2 rows[39m
2025-05-20 17:15:58:1558 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:15:58:1558 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:15:58:1558 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 17:16:01:161 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:16:01:161 [37mdebug[39m: [37mQuery params: [3,"regular",10,0][39m
2025-05-20 17:16:01:161 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 17:16:02:162 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:16:02:162 [37mdebug[39m: [37mQuery params: [3,"all",10,0][39m
2025-05-20 17:16:02:162 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-20 17:16:26:1626 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:16:26:1626 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:16:26:1626 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-20 17:17:20:1720 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:17:20:1720 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:17:20:1720 [37mdebug[39m: [37mQuery completed in 8ms, returned 3 rows[39m
2025-05-20 17:17:23:1723 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:17:23:1723 [37mdebug[39m: [37mQuery params: [3,"%w%",10,0][39m
2025-05-20 17:17:23:1723 [37mdebug[39m: [37mQuery completed in 5ms, returned 0 rows[39m
2025-05-20 17:17:23:1723 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:17:23:1723 [37mdebug[39m: [37mQuery params: [3,"%ww%",10,0][39m
2025-05-20 17:17:23:1723 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-20 17:17:24:1724 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:17:24:1724 [37mdebug[39m: [37mQuery params: [3,"%www%",10,0][39m
2025-05-20 17:17:24:1724 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-20 17:17:32:1732 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 17:17:33:1733 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 17:17:33:1733 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 17:17:33:1733 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-20 17:17:33:1733 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 17:17:33:1733 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 17:17:38:1738 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:17:38:1738 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:17:38:1738 [37mdebug[39m: [37mQuery completed in 9ms, returned 3 rows[39m
2025-05-20 17:17:40:1740 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:17:40:1740 [37mdebug[39m: [37mQuery params: [3,"%w%",10,0][39m
2025-05-20 17:17:40:1740 [37mdebug[39m: [37mQuery completed in 8ms, returned 0 rows[39m
2025-05-20 17:17:41:1741 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:17:41:1741 [37mdebug[39m: [37mQuery params: [3,"%ww%",10,0][39m
2025-05-20 17:17:41:1741 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-20 17:17:42:1742 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:17:42:1742 [37mdebug[39m: [37mQuery params: [3,"%ww4%",10,0][39m
2025-05-20 17:17:42:1742 [37mdebug[39m: [37mQuery completed in 6ms, returned 0 rows[39m
2025-05-20 17:17:43:1743 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:17:43:1743 [37mdebug[39m: [37mQuery params: [3,"%ww43%",10,0][39m
2025-05-20 17:17:43:1743 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-20 17:18:48:1848 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:18:48:1848 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:18:48:1848 [37mdebug[39m: [37mQuery completed in 9ms, returned 3 rows[39m
2025-05-20 17:18:52:1852 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:18:52:1852 [37mdebug[39m: [37mQuery params: [3,"follow_up",10,0][39m
2025-05-20 17:18:52:1852 [37mdebug[39m: [37mQuery completed in 5ms, returned 1 rows[39m
2025-05-20 17:18:53:1853 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:18:53:1853 [37mdebug[39m: [37mQuery params: [3,"all",10,0][39m
2025-05-20 17:18:53:1853 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-20 17:18:54:1854 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2 AND ([39m
[37m        u.first_name ILIKE $3 OR [39m
[37m        u.last_name ILIKE $3 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $3 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $3[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $4 OFFSET $5[39m
[37m    [39m
2025-05-20 17:18:54:1854 [37mdebug[39m: [37mQuery params: [3,"all","%s%",10,0][39m
2025-05-20 17:18:54:1854 [37mdebug[39m: [37mQuery completed in 3ms, returned 0 rows[39m
2025-05-20 17:42:11:4211 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:42:11:4211 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:42:11:4211 [37mdebug[39m: [37mQuery completed in 48ms, returned 3 rows[39m
2025-05-20 17:42:11:4211 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:42:11:4211 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:42:11:4211 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 17:42:13:4213 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:42:13:4213 [37mdebug[39m: [37mQuery params: [3,"%d%",10,0][39m
2025-05-20 17:42:13:4213 [37mdebug[39m: [37mQuery completed in 9ms, returned 3 rows[39m
2025-05-20 17:42:14:4214 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:42:14:4214 [37mdebug[39m: [37mQuery params: [3,"%dd%",10,0][39m
2025-05-20 17:42:14:4214 [37mdebug[39m: [37mQuery completed in 2ms, returned 0 rows[39m
2025-05-20 17:42:16:4216 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:42:16:4216 [37mdebug[39m: [37mQuery params: [3,"%d%",10,0][39m
2025-05-20 17:42:16:4216 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:42:17:4217 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:42:17:4217 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:42:17:4217 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 17:42:21:4221 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:42:21:4221 [37mdebug[39m: [37mQuery params: [3,"regular",10,0][39m
2025-05-20 17:42:21:4221 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 17:42:22:4222 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:42:22:4222 [37mdebug[39m: [37mQuery params: [3,"all",10,0][39m
2025-05-20 17:42:22:4222 [37mdebug[39m: [37mQuery completed in 8ms, returned 0 rows[39m
2025-05-20 17:42:53:4253 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:42:53:4253 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:42:53:4253 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-20 17:42:55:4255 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:42:55:4255 [37mdebug[39m: [37mQuery params: [3,"%d%",10,0][39m
2025-05-20 17:42:55:4255 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-20 17:42:55:4255 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND ([39m
[37m        u.first_name ILIKE $2 OR [39m
[37m        u.last_name ILIKE $2 OR [39m
[37m        CONCAT(u.first_name, ' ', u.last_name) ILIKE $2 OR[39m
[37m        CAST(a.patient_id AS TEXT) LIKE $2[39m
[37m      )[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:42:55:4255 [37mdebug[39m: [37mQuery params: [3,"%dd%",10,0][39m
2025-05-20 17:42:55:4255 [37mdebug[39m: [37mQuery completed in 9ms, returned 0 rows[39m
2025-05-20 17:42:59:4259 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:42:59:4259 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:42:59:4259 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 17:43:01:431 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:43:01:431 [37mdebug[39m: [37mQuery params: [3,"regular",10,0][39m
2025-05-20 17:43:01:431 [37mdebug[39m: [37mQuery completed in 2ms, returned 1 rows[39m
2025-05-20 17:43:02:432 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.type = $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:43:02:432 [37mdebug[39m: [37mQuery params: [3,"all",10,0][39m
2025-05-20 17:43:02:432 [37mdebug[39m: [37mQuery completed in 1ms, returned 0 rows[39m
2025-05-20 17:43:52:4352 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:43:52:4352 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:43:52:4352 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-20 17:43:54:4354 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.status = 'completed'[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:43:54:4354 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:43:54:4354 [37mdebug[39m: [37mQuery completed in 2ms, returned 2 rows[39m
2025-05-20 17:43:55:4355 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:43:55:4355 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:43:55:4355 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-20 17:44:06:446 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m     AND a.appointment_datetime >= $2[39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $3 OFFSET $4[39m
[37m    [39m
2025-05-20 17:44:06:446 [37mdebug[39m: [37mQuery params: [3,"0002-03-03",10,0][39m
2025-05-20 17:44:06:446 [37mdebug[39m: [37mQuery completed in 5ms, returned 3 rows[39m
2025-05-20 17:44:09:449 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:44:09:449 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:44:09:449 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:46:10:4610 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:46:10:4610 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:46:10:4610 [37mdebug[39m: [37mQuery completed in 8ms, returned 3 rows[39m
2025-05-20 17:46:10:4610 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:46:10:4610 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:46:10:4610 [37mdebug[39m: [37mQuery completed in 3ms, returned 3 rows[39m
2025-05-20 17:46:33:4633 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:46:33:4633 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:46:33:4633 [37mdebug[39m: [37mQuery completed in 10ms, returned 3 rows[39m
2025-05-20 17:46:33:4633 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:46:33:4633 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:46:33:4633 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 17:48:42:4842 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:48:42:4842 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:48:42:4842 [37mdebug[39m: [37mQuery completed in 6ms, returned 3 rows[39m
2025-05-20 17:48:42:4842 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:48:42:4842 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:48:42:4842 [37mdebug[39m: [37mQuery completed in 1ms, returned 3 rows[39m
2025-05-20 17:52:54:5254 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:52:54:5254 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:52:54:5254 [37mdebug[39m: [37mQuery completed in 135ms, returned 3 rows[39m
2025-05-20 17:52:54:5254 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 17:52:54:5254 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 17:52:54:5254 [37mdebug[39m: [37mQuery completed in 13ms, returned 3 rows[39m
2025-05-20 22:50:17:5017 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 22:50:18:5018 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 22:50:18:5018 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 22:50:18:5018 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-20 22:50:18:5018 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 22:50:18:5018 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 22:51:14:5114 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 22:51:14:5114 [37mdebug[39m: [37mQuery params: ["john.smith@healthclinic.com"][39m
2025-05-20 22:51:14:5114 [37mdebug[39m: [37mQuery completed in 13ms, returned 1 rows[39m
2025-05-20 22:51:14:5114 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 22:51:14:5114 [37mdebug[39m: [37mQuery params: [3][39m
2025-05-20 22:51:14:5114 [37mdebug[39m: [37mQuery completed in 25ms, returned 1 rows[39m
2025-05-20 22:51:21:5121 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 22:51:21:5121 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 22:51:21:5121 [37mdebug[39m: [37mQuery completed in 15ms, returned 3 rows[39m
2025-05-20 22:51:21:5121 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-20 22:51:21:5121 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-20 22:51:21:5121 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
2025-05-20 23:22:57:2257 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 23:22:57:2257 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 23:22:57:2257 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 23:22:57:2257 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-20 23:22:57:2257 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 23:22:57:2257 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 23:23:01:231 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 23:23:02:232 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 23:23:02:232 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 23:23:02:232 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-20 23:23:02:232 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 23:23:02:232 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 23:23:03:233 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 23:23:03:233 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 23:23:03:233 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 23:23:03:233 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-20 23:23:03:233 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 23:23:03:233 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 23:23:07:237 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 23:23:07:237 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 23:23:07:237 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 23:23:07:237 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-20 23:23:07:237 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 23:23:07:237 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 23:27:23:2723 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 23:27:24:2724 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 23:27:24:2724 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 23:27:24:2724 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-20 23:27:24:2724 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 23:27:24:2724 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 23:47:45:4745 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-20 23:47:46:4746 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-20 23:47:46:4746 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-20 23:47:46:4746 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-20 23:47:46:4746 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-20 23:47:46:4746 [32minfo[39m: [32mEnvironment: development[39m
2025-05-20 23:48:02:482 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-20 23:48:02:482 [37mdebug[39m: [37mQuery params: ["john.smith@healthclinic.com"][39m
2025-05-20 23:48:02:482 [37mdebug[39m: [37mQuery completed in 15ms, returned 1 rows[39m
2025-05-20 23:48:02:482 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-20 23:48:02:482 [37mdebug[39m: [37mQuery params: [3][39m
2025-05-20 23:48:02:482 [37mdebug[39m: [37mQuery completed in 16ms, returned 1 rows[39m
2025-05-21 00:00:02:02 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-21 00:00:03:03 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-21 00:00:03:03 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-21 00:00:03:03 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-21 00:00:03:03 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-21 00:00:03:03 [32minfo[39m: [32mEnvironment: development[39m
2025-05-21 07:29:30:2930 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-21 07:29:31:2931 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-21 07:29:31:2931 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-21 07:29:31:2931 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-21 07:29:31:2931 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-21 07:29:31:2931 [32minfo[39m: [32mEnvironment: development[39m
2025-05-21 07:29:50:2950 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-21 07:29:50:2950 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-21 07:29:50:2950 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-21 07:29:50:2950 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-21 07:29:50:2950 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-21 07:29:50:2950 [32minfo[39m: [32mEnvironment: development[39m
2025-05-21 07:30:12:3012 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-21 07:30:12:3012 [37mdebug[39m: [37mQuery params: ["john.smith@healthclinic.com"][39m
2025-05-21 07:30:12:3012 [37mdebug[39m: [37mQuery completed in 23ms, returned 1 rows[39m
2025-05-21 07:30:12:3012 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-21 07:30:12:3012 [37mdebug[39m: [37mQuery params: [3][39m
2025-05-21 07:30:12:3012 [37mdebug[39m: [37mQuery completed in 19ms, returned 1 rows[39m
2025-05-21 10:55:21:5521 [32minfo[39m: [32mDatabase client initialized[39m
2025-05-21 10:55:21:5521 [32minfo[39m: [32m注册患者个人设置路由: /patient-setting[39m
2025-05-21 10:55:21:5521 [32minfo[39m: [32m注册医疗记录路由: /medical-records[39m
2025-05-21 10:55:21:5521 [32minfo[39m: [32m注册医生预约管理路由: /doctors/appointments[39m
2025-05-21 10:55:21:5521 [32minfo[39m: [32mServer is running on port 3001[39m
2025-05-21 10:55:21:5521 [32minfo[39m: [32mEnvironment: development[39m
2025-05-21 10:55:58:5558 [37mdebug[39m: [37mExecuting query: [39m
[37m        SELECT [39m
[37m          u.user_id as id, [39m
[37m          u.email, [39m
[37m          u.password_hash as "passwordHash", [39m
[37m          u.first_name as "firstName", [39m
[37m          u.last_name as "lastName",[39m
[37m          u.status,[39m
[37m          r.role_name[39m
[37m        FROM users u[39m
[37m        JOIN roles r ON u.role_id = r.role_id[39m
[37m        WHERE u.email = $1[39m
[37m      [39m
2025-05-21 10:55:58:5558 [37mdebug[39m: [37mQuery params: ["john.smith@healthclinic.com"][39m
2025-05-21 10:55:58:5558 [37mdebug[39m: [37mQuery completed in 9ms, returned 1 rows[39m
2025-05-21 10:55:58:5558 [37mdebug[39m: [37mExecuting query: [39m
[37m        UPDATE users [39m
[37m        SET last_login_at = NOW() [39m
[37m        WHERE user_id = $1[39m
[37m      [39m
2025-05-21 10:55:58:5558 [37mdebug[39m: [37mQuery params: [3][39m
2025-05-21 10:55:58:5558 [37mdebug[39m: [37mQuery completed in 65ms, returned 1 rows[39m
2025-05-21 10:56:04:564 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-21 10:56:04:564 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-21 10:56:04:564 [37mdebug[39m: [37mQuery completed in 12ms, returned 3 rows[39m
2025-05-21 10:56:04:564 [37mdebug[39m: [37mExecuting query: [39m
[37m      SELECT [39m
[37m        a.appointment_id as id,[39m
[37m        a.patient_id as "patientId",[39m
[37m        a.doctor_id as "doctorId",[39m
[37m        a.appointment_datetime as "appointmentDateTime",[39m
[37m        a.end_datetime as "endDateTime",[39m
[37m        a.status,[39m
[37m        a.type,[39m
[37m        a.reason,[39m
[37m        a.symptoms,[39m
[37m        a.notes,[39m
[37m        a.cancellation_reason as "cancellationReason",[39m
[37m        a.created_at as "createdAt",[39m
[37m        a.updated_at as "updatedAt",[39m
[37m        p.patient_id as "patientUserId",[39m
[37m        u.first_name as "patientFirstName",[39m
[37m        u.last_name as "patientLastName",[39m
[37m        u.email as "patientEmail",[39m
[37m        u.phone as "patientPhone"[39m
[37m      FROM appointments a[39m
[37m      JOIN patients p ON a.patient_id = p.patient_id[39m
[37m      JOIN users u ON p.patient_id = u.user_id[39m
[37m      WHERE a.doctor_id = $1[39m
[37m    [39m
[37m      ORDER BY a.appointment_datetime DESC[39m
[37m      LIMIT $2 OFFSET $3[39m
[37m    [39m
2025-05-21 10:56:04:564 [37mdebug[39m: [37mQuery params: [3,10,0][39m
2025-05-21 10:56:04:564 [37mdebug[39m: [37mQuery completed in 2ms, returned 3 rows[39m
